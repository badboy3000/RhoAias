exports.ids=[36],exports.modules={171:function(t,e){},172:function(t,e,n){t.exports=n.p+"img/aa8b45a.png"},173:function(t,e,n){"use strict";var r=n(4),o={name:"FlowState",props:{auto:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},noMore:{type:Boolean,default:!1},nothing:{type:Boolean,default:!1},error:{type:Boolean,default:!1},fetch:{type:Function,required:!0},displayNoMore:{type:Boolean,default:!0}},mounted(){this.auto&&this.onScroll()},methods:{getTarget(){let t=this.$el;for(;"HTML"!==t.tagName&&"BOYD"!==t.tagName&&1===t.nodeType;){const e=window.getComputedStyle(t).overflowY;if("scroll"===e||"auto"===e)return t;t=t.parentNode}return document},onScroll(){if(this.error)return;r.a.checkInView(this.$el)&&this.fetch();const t=r.a.on(this.getTarget(),["scroll"],this.$utils.throttle(()=>{this.error||(!this.noMore&&this.auto?r.a.checkInView(this.$el)&&this.fetch():r.a.off(t))},200))}}},c=n(1);var component=Object(c.a)(o,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"flow-state-wrap"},[t.error?t._ssrNode("<div>","</div>",[t._t("error",[r("div",{staticClass:"state-error"},[r("span",[t._v("出错了，点击重试")])])])],2):t.nothing?t._ssrNode("<div>","</div>",[t._t("nothing",[r("div",{staticClass:"state-nothing"},[r("img",{attrs:{src:n(172),alt:"no-content"}}),t._v(" "),r("span",[t._v("这里什么都没有")])])])],2):t.noMore?t._ssrNode("<div>","</div>",[t._t("no-more",[t.displayNoMore?r("div",{staticClass:"state-no-more"},[r("span",[t._v("没有更多了")])]):t._e()])],2):t.loading?t._ssrNode("<div>","</div>",[t._t("loading",[r("div",{staticClass:"state-loading"},[r("i"),t._v(" "),r("span",[t._v("加载中…")])])])],2):t.auto?t._ssrNode('<div class="state-shim"></div>'):t._ssrNode("<button>","</button>",[t._t("load-btn",[r("div",{staticClass:"state-fetch-btn-text"},[r("span",[t._v("点击加载更多")])])])],2)])},[],!1,function(t){var e=n(175);e.__inject__&&e.__inject__(t)},null,"16540fb2");e.a=component.exports},174:function(t,e){},175:function(t,e,n){"use strict";n.r(e);var r=n(171),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},176:function(t,e){},177:function(t,e,n){"use strict";var r=n(173),o={props:{func:{required:!0,type:String},type:{required:!0,type:String},id:{type:[Number,String],default:""},sort:{type:String,default:""},auto:{type:Boolean,default:!0},count:{type:[String,Number],default:12},changing:{type:String,default:"id"},displayNoMore:{type:Boolean,default:!0}}},c={name:"FlowList",components:{FlowState:r.a},mixins:[o],computed:{source(){return this.$store.getters["flow/getFlow"](this.func,this.sort,this.id)}},methods:{loadMore(){this.$store.dispatch("flow/loadMore",{type:this.type,sort:this.sort,func:this.func,id:this.id,count:this.count,changing:this.changing,_extra:this.extra})}}},l=n(1),component=Object(l.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.source?n("div",[t._t("header",null,{source:t.source}),t._ssrNode(" "),t._t("default",null,{flow:t.source.list}),t._ssrNode(" "),n("FlowState",{attrs:{auto:t.auto,loading:t.source.loading,"no-more":t.source.noMore,nothing:t.source.nothing,error:t.source.error,"display-no-more":t.displayNoMore,fetch:t.loadMore}},[t._t("error",null,{slot:"error"}),t._v(" "),t._t("nothing",null,{slot:"nothing"}),t._v(" "),t._t("no-more",null,{slot:"no-more"}),t._v(" "),t._t("loading",null,{slot:"loading"}),t._v(" "),t._t("load-btn",null,{slot:"load-btn"})],2)],2):t._e()},[],!1,null,null,"0bee53e6");e.a=component.exports},178:function(t,e){},179:function(t,e,n){"use strict";var r={name:"UserAvatar",props:{user:{type:Object,required:!0},size:{type:Number,default:40}},methods:{toUser(){this.$router.push(this.$alias.user(this.user.zone))}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"user-avatar",style:{width:t.$px2vw(t.size),height:t.$px2vw(t.size)},on:{click:function(e){return e.stopPropagation(),t.toUser(e)}}},[t._ssrNode("<img"+t._ssrAttr("src",t.$resize(t.user.avatar,{width:2*t.size}))+">")])},[],!1,function(t){var e=n(181);e.__inject__&&e.__inject__(t)},null,"16ffe9a8");e.a=component.exports},180:function(t,e){},181:function(t,e,n){"use strict";n.r(e);var r=n(174),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},182:function(t,e){},183:function(t,e){t.exports={tag:"tag-14",rolling:"rolling-aq"}},184:function(t,e){},185:function(t,e){},186:function(t,e){},187:function(t,e){t.exports={item:"item-1M","in-detail":"in-detail-3X",inDetail:"in-detail-3X",avatar:"avatar-1i",main:"main-1x",header:"header-1Z",nickname:"nickname-JF","to-user":"to-user-2r",toUser:"to-user-2r",content:"content-1g",rolling:"rolling-1u"}},188:function(t,e){},189:function(t,e){},190:function(t,e){},191:function(t,e){},192:function(t,e,n){"use strict";var r={name:"UserNickname",props:{user:{type:Object,required:!0},isMaster:{type:Boolean,default:!1}},methods:{toUser(){this.$router.push(this.$alias.user(this.user.zone))}}},o=n(1);var component=Object(o.a)(r,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"user-nickname"},[this._ssrNode('<div class="nickname"><p class="oneline">'+this._ssrEscape(this._s(this.user.nickname))+"</p></div> "+(this.isMaster?'<span class="badge master-badge"><span>楼主</span></span>':"\x3c!----\x3e"))])},[],!1,function(t){var e=n(195);e.__inject__&&e.__inject__(t)},null,"0ad68c7d");e.a=component.exports},193:function(t,e,n){"use strict";n.d(e,"i",function(){return r}),n.d(e,"r",function(){return o}),n.d(e,"h",function(){return c}),n.d(e,"c",function(){return l}),n.d(e,"o",function(){return d}),n.d(e,"f",function(){return m}),n.d(e,"m",function(){return _}),n.d(e,"e",function(){return h}),n.d(e,"p",function(){return f}),n.d(e,"a",function(){return v}),n.d(e,"n",function(){return y}),n.d(e,"j",function(){return C}),n.d(e,"d",function(){return $}),n.d(e,"b",function(){return w}),n.d(e,"g",function(){return x}),n.d(e,"q",function(){return k}),n.d(e,"l",function(){return N}),n.d(e,"k",function(){return I});const r=(t,{id:e})=>t.$axios.$get(`cartoon_role/${e}/stock_show`),o=(t,{id:e,amount:n})=>t.$axios.$post(`cartoon_role/${e}/buy_stock`,{amount:n}),c=(t,{id:e})=>t.$axios.$get(`cartoon_role/${e}/get_idol_deal`),l=(t,form)=>t.$axios.$post("cartoon_role/create_deal",form),d=(t,form)=>t.$axios.$post("cartoon_role/make_deal",form),m=(t,{id:e})=>t.$axios.$post("cartoon_role/delete_deal",{id:e}),_=t=>t.$axios.$get("cartoon_role/stock_meta"),h=(t,form)=>t.$axios.$post("cartoon_role/create_market_price_draft",form),f=(t,{is_agree:e,idol_id:n,draft_id:r})=>t.$axios.$post("cartoon_role/vote_market_price_draft",{is_agree:e,idol_id:n,draft_id:r}),v=(t,{idol_id:e,qq_group:n,lover_words:r,manager_id:o})=>t.$axios.$post("cartoon_role/change_idol_profile",{idol_id:e,qq_group:n,lover_words:r,manager_id:o}),y=t=>t.$axios.$get("cartoon_role/user_draft_work"),C=t=>t.$axios.$get("cartoon_role/can_use_income"),$=(t,{product_id:e,product_type:n,amount:r})=>t.$axios.$post("cartoon_role/create_buy_request",{product_id:e,product_type:n,amount:r}),w=(t,{order_id:e,result:n})=>t.$axios.$post("cartoon_role/check_product_request",{order_id:e,result:n}),x=(t,{order_id:e})=>t.$axios.$post("cartoon_role/delete_buy_request",{order_id:e}),k=(t,{order_id:e})=>t.$axios.$post("cartoon_role/over_buy_request",{order_id:e}),N=t=>t.$axios.$get("cartoon_role/get_mine_product_orders"),I=(t,{idol_id:e,days:n})=>t.$axios.$get("cartoon_role/get_idol_days_chart",{params:{idol_id:e,days:n}})},194:function(t,e,n){"use strict";e.a=((t,e,n,r)=>{let o=0;const element=n?[n]:[document.getElementsByTagName("html")[0],document.body],c=n?n.scrollTop:window.scrollY,l=t||0,d=e||2e3,m=r||"easeOutSine",time=Math.max(.1,Math.min(Math.abs(c-l)/d,.8)),_={easeOutSine:t=>Math.sin(t*(Math.PI/2)),easeInOutSine:t=>-.5*(Math.cos(Math.PI*t)-1),easeInOutQuint:t=>(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)};element.forEach(t=>{t.requestAnimFrame||(t.requestAnimFrame=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}).bind(window))}),function t(){const p=(o+=1/60)/time,e=_[m](p);element.forEach(n=>{p<1?(n.requestAnimFrame(t),n.scrollTop=c+(l-c)*e):n.scrollTop=l})}()})},195:function(t,e,n){"use strict";n.r(e);var r=n(176),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},196:function(t,e,n){t.exports=n.p+"img/1727dbb.png"},197:function(t,e){},198:function(t,e,n){"use strict";n.r(e);var r=n(178),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},201:function(t,e){t.exports={"bangumi-panel":"bangumi-panel-b5",bangumiPanel:"bangumi-panel-b5",avatar:"avatar-2K",content:"content-2m",name:"name-5O",summary:"summary-3v",controls:"controls-1p",rolling:"rolling-nc"}},202:function(t,e){},203:function(t,e,n){"use strict";var r=n(179),o=n(192),c={name:"FlowHeaderUser",components:{UserAvatar:r.a,UserNickname:o.a},props:{user:{type:Object,required:!0},time:{type:String,required:!0}}},l=n(1);var component=Object(l.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user-panel"},[n("UserAvatar",{attrs:{user:t.user}}),t._ssrNode(" "),t._ssrNode('<div class="slot">',"</div>",[t._t("default")],2),t._ssrNode(" "),t._ssrNode('<div class="user-info">',"</div>",[n("UserNickname",{attrs:{user:t.user}}),t._ssrNode(" "),n("VTime",{model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],2)],2)},[],!1,function(t){var e=n(198);e.__inject__&&e.__inject__(t)},null,"7d79de9c");e.a=component.exports},204:function(t,e,n){"use strict";var r={name:"FlowImages",props:{images:{type:Array,required:!0}},data:()=>({}),computed:{},watch:{},created(){},mounted(){},methods:{}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.images.length?n("div",{staticClass:"flow-images"},[t.images.length>=3?t._ssrNode('<div class="three-images">',"</div>",[t._ssrNode('<div class="item">',"</div>",[n("v-img",{attrs:{src:t.images[0].url,width:"100%",height:"120"}})],1),t._ssrNode(' <div class="h-shim"></div> '),t._ssrNode('<div class="wrap">',"</div>",[n("v-img",{attrs:{src:t.images[1].url,width:"100%",height:"58"}}),t._ssrNode(' <div class="w-shim"></div> '),n("v-img",{attrs:{src:t.images[2].url,width:"100%",height:"58"}})],2)],2):2===t.images.length?t._ssrNode('<div class="two-images">',"</div>",[t._ssrNode('<div class="item">',"</div>",[n("v-img",{attrs:{src:t.images[0].url,width:"100%",height:"120"}})],1),t._ssrNode(' <div class="h-shim"></div> '),t._ssrNode('<div class="item">',"</div>",[n("v-img",{attrs:{src:t.images[1].url,width:"100%",height:"120"}})],1)],2):n("v-img",{attrs:{src:t.images[0].url,width:"100%",height:"120"}})],1):t._e()},[],!1,function(t){var e=n(205);e.__inject__&&e.__inject__(t)},null,"6f6b1127");e.a=component.exports},205:function(t,e,n){"use strict";n.r(e);var r=n(180),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},206:function(t,e,n){"use strict";var r=n(194),o={name:"CommentCreateForm",props:{type:{required:!0,type:String},id:{required:!0,type:[Number,String]},masterId:{required:!0,type:Number}},data:()=>({content:""}),computed:{isGuest(){return!this.$store.state.login},submitting(){return this.$store.state.comment.submitting}},methods:{async submit(){if(this.isGuest)this.$channel.$emit("sign-in");else if(this.content){if(!this.submitting){this.$store.commit("comment/SET_SUBMITTING",{result:!0});try{const t=await this.$store.dispatch("comment/createMainComment",{content:this.content,images:[],type:this.type,id:this.id,ctx:this});this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp),this.$emit("submit"),this.content="",setTimeout(()=>{const e=document.getElementById(`comment-${t.data.id}`);e&&Object(r.a)(this.$utils.getOffsetTop(e)-100,600)},400)}finally{this.$store.commit("comment/SET_SUBMITTING",{result:!1})}}}else this.$emit("close")},handleAreaFocus(){document.body.scrollTop=0}}},c=n(1);var l=Object(c.a)(o,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"comment-create-form"},[this._ssrNode('<textarea placeholder="来吧，尽情的（在1000字以内）发挥吧" maxlength="1000" class="content"></textarea> '),e("el-button",{staticClass:"submit-btn",attrs:{loading:this.submitting,type:"primary"},on:{click:this.submit}},[this._v("\n    发布\n  ")])],2)},[],!1,function(t){var e=n(213);e.__inject__&&e.__inject__(t)},null,"8222d2d8").exports,d={name:"SubCommentItem",props:{comment:{required:!0,type:Object},parentUserId:{required:!0,type:Number},parentCommentId:{required:!0,type:Number},type:{required:!0,type:String}},data:()=>({deleting:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isMine(){return this.currentUserId===this.comment.from_user_id},showToUser(){return this.comment.to_user_id&&this.comment.to_user_id!==this.parentUserId},canDelete(){return this.isMine||this.currentUserId===this.parentUserId}},methods:{handleSubCommentClick(){if(this.isMine)return this.deleteComment(),void this.$nextTick(()=>{document.getElementById("reply-comment-textarea").style.display="none"});this.currentUserId&&this.$channel.$emit("reply-comment",{id:this.parentCommentId,targetUserId:this.comment.from_user_id,targetUserName:this.comment.from_user_name})},deleteComment(){this.canDelete&&(this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteSubComment",{ctx:this,type:this.type,id:this.comment.id,parentId:this.comment.parent_id})}).catch(()=>{this.deleting=!1})))}}};var m={name:"PostSubCommentList",components:{SubCommentItem:Object(c.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.item},[n("nuxt-link",{class:t.$style.avatar,attrs:{to:t.$alias.user(t.comment.from_user_zone),tag:"div"}},[n("VImg",{attrs:{src:t.comment.from_user_avatar,width:22,height:22,avatar:!0}})],1),t._ssrNode(" "),t._ssrNode("<div"+t._ssrClass(null,t.$style.main)+">","</div>",[t._ssrNode("<div"+t._ssrClass("oneline",t.$style.header)+">","</div>",[t.showToUser?[n("nuxt-link",{class:t.$style.nickname,attrs:{to:t.$alias.user(t.comment.from_user_zone),tag:"span"}},[t._v("\n          "+t._s(t.comment.from_user_name)+":\n        ")]),t._ssrNode(" "),n("nuxt-link",{class:t.$style.toUser,attrs:{to:t.$alias.user(t.comment.to_user_zone),tag:"span"}},[t._v("\n          @"+t._s(t.comment.to_user_name)+"\n        ")])]:n("nuxt-link",{class:t.$style.nickname,attrs:{to:t.$alias.user(t.comment.from_user_zone),tag:"span"},domProps:{textContent:t._s(t.comment.from_user_name)}})],2),t._ssrNode(" <p"+t._ssrClass(null,t.$style.content)+">"+t._ssrEscape(t._s(t.comment.content))+"</p>")],2)],2)},[],!1,function(t){var e=n(215);e.__inject__&&e.__inject__(t);var r=n(216);r.__inject__&&r.__inject__(t),this.$style=r.locals||r},null,"40f00e8d").exports},props:{parentComment:{required:!0,type:Object},type:{required:!0,type:String}},computed:{comments(){return this.parentComment.comments},authorId(){return this.parentComment.from_user_id},hasComment(){return!!this.comments.list.length},filterComments(){const data=this.comments,t=data.list,e=t.slice(0,2);if(t.every(t=>t.id<=data.maxId))return e;const n=e.map(t=>t.id);return e.concat(t.filter(t=>t.id>data.maxId&&-1===n.indexOf(t.id)))}},methods:{loadAllComment(){this.$channel.$emit("load-all-sub-comment",{id:this.parentComment.id})}}};var _=Object(c.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.hasComment?n("div",{staticClass:"sub-comment-list-wrap"},[t._ssrNode('<div class="sub-comment-list">',"</div>",[t._l(t.filterComments,function(e){return n("SubCommentItem",{key:e.id,attrs:{comment:e,"parent-user-id":t.authorId,"parent-comment-id":t.parentComment.id,type:t.type}})}),t._ssrNode(" "+(!t.comments.noMore||t.comments.list.length>2?'<button class="load-all-comment">'+t._ssrEscape("\n      全部"+t._s(t.comments.total)+"条回复\n    ")+"</button>":"\x3c!----\x3e"))],2)]):t._e()},[],!1,function(t){var e=n(217);e.__inject__&&e.__inject__(t)},null,"4af58698").exports,h=n(179),f=n(192),v={name:"CommentCommentItem",components:{SubCommentList:_,UserAvatar:h.a,UserNickname:f.a},props:{comment:{required:!0,type:Object},masterId:{required:!0,type:Number},type:{required:!0,type:String}},data:()=>({deleting:!1,liking:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isMine(){return this.currentUserId===this.comment.from_user_id},canDelete(){return this.isMine||this.currentUserId===this.masterId},computeFromUser(){return{id:this.comment.from_user_id,avatar:this.comment.from_user_avatar,nickname:this.comment.from_user_name,zone:this.comment.from_user_zone}},imageCount(){return this.comment.images.length},filterImages(){return this.inDetail?this.comment.images:this.comment.images.slice(0,3)}},methods:{async toggleLike(){if(this.currentUserId){if(!this.liking){this.liking=!0;try{await this.$store.dispatch("comment/toggleLikeMainComment",{ctx:this,type:this.type,id:this.comment.id})}finally{this.liking=!1}}}else this.$channel.$emit("sign-in")},deleteComment(){this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteMainComment",{ctx:this,type:this.type,id:this.comment.id}),this.$emit("delete")}).catch(()=>{this.deleting=!1}))},handleCommentBtnClick(){this.$channel.$emit("reply-comment",{id:this.comment.id,targetUserId:this.computeFromUser.id,targetUserName:this.computeFromUser.nickname})}}};var y={name:"VCommentMain",components:{CommentCreateForm:l,CommentItem:Object(c.a)(v,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"comment-item"},[t._ssrNode('<div class="avatar">',"</div>",[r("UserAvatar",{attrs:{size:35,user:t.computeFromUser}})],1),t._ssrNode(" "),t._ssrNode('<div class="content">',"</div>",[t._ssrNode('<div class="header">',"</div>",[t._ssrNode('<div class="right-btn">'+(t.canDelete?'<div class="tool-btn-wrap"><button><img'+t._ssrAttr("src",n(214))+"></button></div>":"\x3c!----\x3e")+"</div> "),r("UserNickname",{attrs:{user:t.computeFromUser,"is-master":t.comment.is_owner}})],2),t._ssrNode(" "),t._ssrNode('<div class="main">',"</div>",[t._ssrNode('<div class="text-area">'+t._s(t.comment.content)+"</div> "),t.imageCount?t._ssrNode('<div class="image-area">',"</div>",[1===t.imageCount?t._ssrNode("<div>","</div>",t._l(t.comment.images,function(t,e){return r("VImg",{key:e,staticClass:"image",attrs:{src:t.url,size:t.size,type:t.type,blur:!0,height:98,width:"auto"}})}),1):t._ssrNode("<div>","</div>",[t._ssrNode("<div>","</div>",t._l(t.filterImages,function(t,e){return r("VImg",{key:e,staticClass:"image",attrs:{src:t.url,size:t.size,type:t.type,blur:!0,width:"32%"}})}),1),t._ssrNode(" "+(t.imageCount>3?'<div class="mask"><span>'+t._ssrEscape("共"+t._s(t.imageCount)+"张图片")+"</span></div>":"\x3c!----\x3e"))],2)]):t._e()],2),t._ssrNode(" "),t._t("extra"),t._ssrNode(" "),t._ssrNode('<div class="footer">',"</div>",[t._ssrNode('<div class="info">',"</div>",[t._ssrNode("<span>"+t._ssrEscape(t._s(t.comment.floor_count)+"楼")+"</span> "),r("VTime",{model:{value:t.comment.created_at,callback:function(e){t.$set(t.comment,"created_at",e)},expression:"comment.created_at"}})],2),t._ssrNode(' <div class="social"><button'+t._ssrClass(null,{"is-active":t.comment.liked})+">"+(t.comment.like_count?"<span>"+t._ssrEscape(t._s(t.$utils.shortenNumber(t.comment.like_count)))+"</span>":"\x3c!----\x3e")+' <i class="iconfont icon-icon_good"></i></button></div>')],2),t._ssrNode(" "),r("SubCommentList",{attrs:{"parent-comment":t.comment,type:t.type}})],2)],2)},[],!1,function(t){var e=n(218);e.__inject__&&e.__inject__(t)},null,"6daa4147").exports,FlowState:n(173).a},props:{id:{required:!0,type:[Number,String]},type:{required:!0,type:String,validator:t=>~["post","video","image","score","question","answer","role"].indexOf(t)},onlySeeMaster:{type:Boolean,default:!1},masterId:{required:!0,type:Number},bottomAppendComment:{type:Boolean,default:!0},auto:{type:Boolean,default:!1},lazy:{type:Boolean,default:!0}},data:()=>({loadingMainComment:!1,focusCommentId:0,openFocusCommentDrawer:!1,loadingSubComment:!1,replyForm:{id:"",content:"",targetUserId:0,targetUserName:"",open:!1,replying:!1,liking:!1},openCreateCommentDrawer:!1,lastScroll:0,isScrollTop:!0}),computed:{store(){return this.$store.state.comment},list(){return this.store.list},noMore(){return this.store.noMore},total(){return this.store.total},focusComment(){return this.focusCommentId?this.list.filter(t=>t.id===this.focusCommentId)[0]:null},currentUserId(){return this.$store.state.login?this.$store.state.user.id:0}},mounted(){this.auto?this.$channel.$on(`fire-load-comment-${this.type}-${this.id}`,()=>{this.loadMoreMainComment(!0),this.$channel.$off(`fire-load-comment-${this.type}-${this.id}`)}):this.lazyLoadComment(),this.$channel.$on("load-all-sub-comment",({id:t})=>{this.focusCommentId=t,this.openFocusCommentDrawer=!0}),this.$channel.$on(`open-create-comment-drawer-${this.type}-${this.id}`,()=>{this.currentUserId?this.openCreateCommentDrawer=!0:this.$channel.$emit("sign-in")}),this.$channel.$on("reply-comment",({id:t,targetUserId:e,targetUserName:n})=>{this.handleSubCommentReply({id:t,targetUserId:e,targetUserName:n})}),window.addEventListener("scroll",this.$utils.throttle(()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;this.isScrollTop=this.lastScroll>t,this.lastScroll=t},200))},methods:{async lazyLoadComment(){if(!this.lazy)return void this.$nextTick(()=>{this.scrollToReply()});const{query:t}=this.$route;await this.$store.dispatch("comment/getMainComments",{id:this.id,type:this.type,seeReplyId:t["comment-id"],onlySeeMaster:t.only&&parseInt(t.only,10)?1:0}),this.$nextTick(()=>{this.scrollToReply()})},autoLoadMoreMainComment(){this.loadMoreMainComment(!1)},async loadMoreMainComment(t=!1){if(!this.loadingMainComment){this.loadingMainComment=!0;try{await this.$store.dispatch("comment/getMainComments",{ctx:this,type:this.type,id:this.id,onlySeeMaster:this.onlySeeMaster?1:0,firstRequest:t})}finally{this.loadingMainComment=!1}}},async loadMoreSubComment(){if(!this.loadingSubComment){this.loadingSubComment=!0;try{await this.$store.dispatch("comment/getSubComments",{ctx:this,type:this.type,id:this.focusCommentId})}finally{this.loadingSubComment=!1}}},commentToComment(data){this.handleSubCommentReply({id:data.parent_id,targetUserId:data.from_user_id,targetUserName:data.from_user_name})},handleCommentBtnClick(){this.handleSubCommentReply({id:this.focusComment.id,targetUserId:this.focusComment.from_user_id,targetUserName:this.focusComment.from_user_name})},handleSubCommentReply({id:t,targetUserId:e,targetUserName:n}){this.currentUserId?(this.replyForm.id=t,this.replyForm.targetUserId=e,this.replyForm.targetUserName=n,this.replyForm.open=!0,setTimeout(()=>{document.body.scrollTop=0},200)):this.$channel.$emit("sign-in")},async toggleFocusCommentLike(){if(this.currentUserId){if(!this.replyForm.liking){this.replyForm.liking=!0;try{await this.$store.dispatch("comment/toggleLikeMainComment",{ctx:this,type:this.type,id:this.focusCommentId})}finally{this.replyForm.liking=!1}}}else this.$channel.$emit("sign-in")},async handleReplySubmit(){if(this.currentUserId){if(this.replyForm.content&&!this.replyForm.replying){this.replyForm.replying=!0;try{const t=await this.$store.dispatch("comment/createSubComment",{ctx:this,id:this.replyForm.id,type:this.type,content:this.replyForm.content,targetUserId:this.replyForm.targetUserId});this.replyForm.open=!1,this.replyForm.content="",this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp)}finally{this.replyForm.replying=!1}}}else this.$channel.$emit("sign-in")},writeComment(){this.$channel.$emit(`open-create-comment-drawer-${this.type}-${this.id}`)},closeCommentDrawer(){this.openCreateCommentDrawer=!1},submitCommentCallback(){this.openCreateCommentDrawer=!1,this.$emit("create-main-comment")},deleteCommentCallback(){this.$emit("delete-main-comment")},scrollToReply(){const t=this.$route.query["comment-id"];if(!t)return;const e=document.getElementById(`comment-${t}`);e&&setTimeout(()=>{Object(r.a)(this.$utils.getOffsetTop(e)-100,600)},400)}}};var C=Object(c.a)(y,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"comment-wrap"}},[t._ssrNode('<h3 class="title">\n    评论 '+(t.total?"<span>"+t._ssrEscape(t._s(t.total))+"</span>":"\x3c!----\x3e")+"</h3> "),t.list.length?[t._ssrNode('<div id="comment-list-wrap">',"</div>",t._l(t.list,function(e){return t._ssrNode('<div class="comment-item-wrap">',"</div>",[t._t("comment-item",[r("CommentItem",{attrs:{type:t.type,comment:e,"master-id":t.masterId},on:{delete:t.deleteCommentCallback}})],{comment:e,reply:t.handleSubCommentReply})],2)}),0),t._ssrNode(" "),r("FlowState",{attrs:{"no-more":t.noMore,loading:t.loadingMainComment,auto:!0,fetch:t.autoLoadMoreMainComment}}),t._ssrNode(" <button"+t._ssrClass("comment-fixed-btn",{isScrollTop:t.isScrollTop})+'><i class="iconfont icon-talk"></i> <span>回复</span></button>')]:t._ssrNode('<div class="comment-nothing"><img'+t._ssrAttr("src",n(212))+"> <p>还没有人发言呢！</p> <button>\n      抢沙发\n    </button></div>"),t._ssrNode(" "),r("v-drawer",{staticClass:"focus-comment-drawer",attrs:{"header-text":"评论列表"+(t.focusComment&&t.focusComment.floor_count?" - "+t.focusComment.floor_count+" 楼":""),backdrop:!1,from:"bottom",size:"100%"},model:{value:t.openFocusCommentDrawer,callback:function(e){t.openFocusCommentDrawer=e},expression:"openFocusCommentDrawer"}},[t.focusComment?[r("div",{staticClass:"container"},[r("div",{staticClass:"reply"},[r("div",{staticClass:"user clearfix"},[r("nuxt-link",{staticClass:"avatar",attrs:{to:t.$alias.user(t.focusComment.from_user_zone)}},[r("v-img",{attrs:{src:t.focusComment.from_user_avatar,avatar:!0,width:"35"}})],1),t._v(" "),r("div",{staticClass:"summary"},[r("nuxt-link",{staticClass:"nickname",attrs:{to:t.$alias.user(t.focusComment.from_user_zone)},domProps:{textContent:t._s(t.focusComment.from_user_name)}}),t._v(" "),r("div",{staticClass:"info"},[r("v-time",{model:{value:t.focusComment.created_at,callback:function(e){t.$set(t.focusComment,"created_at",e)},expression:"focusComment.created_at"}})],1)],1)],1),t._v(" "),r("div",{staticClass:"content"},[r("div",{staticClass:"text-area",domProps:{innerHTML:t._s(t.focusComment.content)}}),t._v(" "),r("div",{staticClass:"image-area"},t._l(t.focusComment.images,function(img,t){return r("div",{key:t,staticClass:"image-package"},[r("v-img",{attrs:{src:img.url,width:img.width,height:img.height,full:!0}})],1)}),0)]),t._v(" "),r("div",{staticClass:"social"},[r("button",{class:[t.focusComment.liked?"reply-liked-btn":"reply-like-btn"],on:{click:t.toggleFocusCommentLike}},[r("i",{staticClass:"iconfont icon-icon_good"}),t._v(" "),r("span",[t._v(t._s(t.focusComment.liked?"已赞":"赞"))]),t._v(" "),t.focusComment.like_count?r("span",[t._v("("+t._s(t.focusComment.like_count)+")")]):t._e()]),t._v(" "),r("button",{staticClass:"reply-btn fr",on:{click:t.handleCommentBtnClick}},[t._v("\n              回复\n            ")])])]),t._v(" "),r("div",{staticClass:"hr"}),t._v(" "),r("p",{staticClass:"total"},[t._v("\n          "+t._s(t.focusComment.comments.total)+"条回复\n        ")]),t._v(" "),r("ul",{staticClass:"comments"},t._l(t.focusComment.comments.list,function(e){return r("li",{key:e.id},[r("div",{staticClass:"from-user"},[r("nuxt-link",{staticClass:"avatar",attrs:{to:t.$alias.user(e.from_user_zone)}},[r("v-img",{attrs:{src:e.from_user_avatar,avatar:!0,width:"35"}})],1),t._v(" "),r("div",{staticClass:"summary"},[r("div",{staticClass:"users oneline"},[r("nuxt-link",{staticClass:"nickname",attrs:{to:t.$alias.user(e.from_user_zone)},domProps:{textContent:t._s(e.from_user_name)}}),t._v(" "),e.to_user_zone?[t._v("\n                    回复\n                    "),r("nuxt-link",{staticClass:"nickname",attrs:{to:t.$alias.user(e.to_user_zone)},domProps:{textContent:t._s(e.to_user_name)}})]:t._e(),t._v("\n                  :\n                ")],2),t._v(" "),r("div",{staticClass:"info"},[r("v-time",{model:{value:e.created_at,callback:function(n){t.$set(e,"created_at",n)},expression:"item.created_at"}})],1)])],1),t._v(" "),r("div",{staticClass:"main"},[r("div",{staticClass:"content reply-btn",domProps:{textContent:t._s(e.content)},on:{click:function(n){return t.commentToComment(e)}}})])])}),0)]),t._v(" "),r("FlowState",{attrs:{"no-more":t.focusComment.comments.noMore,loading:t.loadingSubComment,fetch:t.loadMoreSubComment}})]:t._e()],2),t._ssrNode(" "),t._ssrNode('<div class="reply-comment-drawer-wrap">',"</div>",[r("v-drawer",{attrs:{"header-text":t.currentUserId===t.replyForm.targetUserId?"回复":"回复："+t.replyForm.targetUserName,backdrop:!1,from:"right",size:"100%","submit-text":"发送"},on:{submit:t.handleReplySubmit},model:{value:t.replyForm.open,callback:function(e){t.$set(t.replyForm,"open",e)},expression:"replyForm.open"}},[r("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.replyForm.content,expression:"replyForm.content",modifiers:{trim:!0}}],attrs:{placeholder:"100字以内任意发挥",maxlength:"100"},domProps:{value:t.replyForm.content},on:{input:function(e){e.target.composing||t.$set(t.replyForm,"content",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])],1),t._ssrNode(" "),r("v-drawer",{attrs:{from:"right",size:"100%","header-text":"发表评论"},model:{value:t.openCreateCommentDrawer,callback:function(e){t.openCreateCommentDrawer=e},expression:"openCreateCommentDrawer"}},[t.openCreateCommentDrawer?r("div",{staticClass:"container"},[t._t("reply-form",[t.openCreateCommentDrawer?r("CommentCreateForm",{attrs:{id:t.id,type:t.type,"master-id":t.masterId},on:{close:t.closeCommentDrawer,submit:t.submitCommentCallback}}):t._e()],{close:t.closeCommentDrawer})],2):t._e()])],2)},[],!1,function(t){var e=n(219);e.__inject__&&e.__inject__(t)},null,"26fa08ed");e.a=C.exports},207:function(t,e,n){"use strict";n.r(e);var r=n(182),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},208:function(t,e,n){"use strict";n.r(e);var r=n(183),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},209:function(t,e,n){"use strict";n.r(e);var r=n(184),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},211:function(t,e){},212:function(t,e,n){t.exports=n.p+"img/e82d3e7.png"},213:function(t,e,n){"use strict";n.r(e);var r=n(185),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},214:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAxElEQVRYR+2UMQ7CMAxFbYmyw9E6ZGlnrgATAxO9AnO7ZOjRYKdIQdkQ8lL9Wkqkn9k/enr+skrhTwvnEwKiG6JBGkQNoHl2kAZRA2ieHaRB1ACar7ODMcb9suxuKckpG1CVR9N8riGEt2XEc940OE3zPSU5/8KoytB17cUC9Jw3AcdxforI4Q/m1fft0QL0nK8T0HNleQNr/jcNepY+A675v84zgx7XLfM0iNqkQRpEDaB5dpAGUQNonh2kQdQAmi++g1+Jsoopr5i4FgAAAABJRU5ErkJggg=="},215:function(t,e,n){"use strict";n.r(e);var r=n(186),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},216:function(t,e,n){"use strict";n.r(e);var r=n(187),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},217:function(t,e,n){"use strict";n.r(e);var r=n(188),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},218:function(t,e,n){"use strict";n.r(e);var r=n(189),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},219:function(t,e,n){"use strict";n.r(e);var r=n(190),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},221:function(t,e,n){"use strict";n.r(e);var r=n(191),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},223:function(t,e,n){"use strict";var r={name:"BubbleTag",props:{icon:{type:String,default:""},text:{type:String,required:!0}}},o=n(1);var c={name:"FlowTags",components:{BubbleTag:Object(o.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("button",{class:t.$style.tag,on:{click:function(e){return t.$emit("click")}}},[t._t("icon"),t._ssrNode(" <span>"+t._ssrEscape(t._s(t.text))+"</span>")],2)},[],!1,function(t){var e=n(208);e.__inject__&&e.__inject__(t),this.$style=e.locals||e},null,"1c233d9a").exports},props:{bangumi:{type:Object,default:null},idol:{type:Object,default:null},tags:{type:Array,default:()=>[]}}};var l=Object(o.a)(c,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"flow-tags"},[t.bangumi?r("BubbleTag",{attrs:{text:t.bangumi.name}},[r("img",{attrs:{slot:"icon",src:n(196)},slot:"icon"})]):t._e(),t._ssrNode(" "),t.idol?r("BubbleTag",{attrs:{text:t.idol.name}},[r("img",{attrs:{slot:"icon",src:n(196)},slot:"icon"})]):t._l(t.tags,function(t){return r("BubbleTag",{key:t.id,attrs:{text:t.name}})})],2)},[],!1,function(t){var e=n(209);e.__inject__&&e.__inject__(t)},null,"7d582408");e.a=l.exports},224:function(t,e,n){"use strict";var r={props:{type:{required:!0,type:String,validator:t=>~["bangumi","user","question"].indexOf(t)},id:{required:!0,type:Number}},computed:{source(){return this.$store.getters["social/getState"](this.type,this.id)}},methods:{toggleFollow(){this.$store.state.login?this.$store.dispatch("social/toggleAction",{id:this.id,type:this.type,action:"follow"}):this.$channel.$emit("sign-in")}}},o=n(1);var component=Object(o.a)(r,function(){var t=this.$createElement;return(this._self._c||t)("button",{staticClass:"follow-button",on:{click:this.toggleFollow}},[this._ssrNode('<i class="iconfont icon-like"></i> <span>'+this._ssrEscape(this._s(this.source.follow?"已关注":"关注"))+"</span>")])},[],!1,function(t){var e=n(221);e.__inject__&&e.__inject__(t)},null,"bf8ea772");e.a=component.exports},225:function(t,e,n){"use strict";var r={name:"TabContainer",props:{headers:{required:!0,type:Array},defIndex:{type:[Number,String],default:"0"},router:{type:Boolean,default:!1}},data(){let t;return{focusIndex:t=this.router?this.headers.map(t=>t.route).indexOf(this.$route.name):+this.defIndex}},watch:{$route(t){this.focusIndex=this.headers.map(t=>t.route).indexOf(t.name)},headers(t){this.focusIndex=t.map(t=>t.route).indexOf(this.$route.name)}},methods:{computeItemText:t=>"string"==typeof t?t:t.label||t.name||t.text,computeItemIcon:t=>!("string"==typeof t||!t.icon)&&`iconfont ic-${t.replace("ic-","")}`,handleTabSwitch(t){this.focusIndex!==t&&(this.router&&this.$router.push({name:this.headers[t].route,params:this.$route.params}),this.focusIndex=t,this.$emit("change",t))}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("section",{staticClass:"tab-container"},[t._ssrNode("<header>"+t._ssrList(t.headers,function(e,n){return"<div"+t._ssrClass(null,{"is-active":n===t.focusIndex})+t._ssrStyle(null,{width:100/t.headers.length+"%"},null)+">"+(t.computeItemIcon(e)?"<i"+t._ssrClass(null,t.computeItemIcon(e))+"></i>":"\x3c!----\x3e")+" <span>"+t._ssrEscape(t._s(t.computeItemText(e)))+"</span></div>"})+"</header> "),t.router?t._e():t._ssrNode("<main>","</main>",t._l(t.headers,function(e,n){return t._ssrNode("<div"+t._ssrStyle(null,null,{display:n===t.focusIndex?"":"none"})+">","</div>",[t._t(n)],2)}),0)],2)},[],!1,function(t){var e=n(207);e.__inject__&&e.__inject__(t)},null,"2697cdf0");e.a=component.exports},226:function(t,e,n){"use strict";n.r(e);var r=n(197),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},238:function(t,e,n){"use strict";var r=n(203),o=n(204),c=n(223),l={name:"PostFlowItem",components:{FlowHeaderUser:r.a,FlowImages:o.a,FlowTags:c.a},props:{item:{required:!0,type:Object},bangumiId:{type:[Number,String],default:0},userZone:{type:String,default:""}},methods:{imageFilter:t=>t.slice(0,3)}},d=n(1);var component=Object(d.a)(l,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",{staticClass:"post-flow-item"},[n("nuxt-link",{attrs:{to:t.$alias.post(t.item.id),tag:"div"}},[n("div",{staticClass:"header"},[t.userZone?[n("router-link",{staticClass:"bangumi-avatar",attrs:{to:t.$alias.bangumi(t.item.bangumi.id)}},[n("v-img",{attrs:{src:t.item.bangumi.avatar,width:"35",height:"35"}})],1),t._v(" "),n("div",{staticClass:"info"},[n("router-link",{staticClass:"name oneline",attrs:{to:t.$alias.bangumi(t.item.bangumi.id)},domProps:{textContent:t._s(t.item.bangumi.name)}}),t._v(" "),n("v-time",{model:{value:t.item.created_at,callback:function(e){t.$set(t.item,"created_at",e)},expression:"item.created_at"}})],1)]:[n("FlowHeaderUser",{attrs:{user:t.item.user,time:t.item.created_at}})]],2),t._v(" "),n("div",{staticClass:"body"},[n("div",{staticClass:"title"},[t.item.top_at&&t.bangumiId?n("div",{staticClass:"top_badge"},[t._v("\n          置顶\n        ")]):t._e(),t._v(" "),t.item.is_nice?n("div",{staticClass:"nice_badge"},[t._v("\n          精\n        ")]):t._e(),t._v(" "),t.item.is_creator?n("div",{staticClass:"creator_badge"},[t._v("\n          原创\n        ")]):t._e(),t._v(" "),n("p",{staticClass:"oneline",domProps:{textContent:t._s(t.item.title)}})]),t._v(" "),n("p",{staticClass:"content",domProps:{textContent:t._s(t.item.desc)}}),t._v(" "),n("FlowImages",{attrs:{images:t.item.images}}),t._v(" "),n("FlowTags",{attrs:{bangumi:t.item.bangumi,idol:t.item.idol,tags:t.item.tags}})],1),t._v(" "),n("div",{staticClass:"footer"},[t.item.is_creator?n("div",[n("i",{staticClass:"iconfont icon-fantuan"}),t._v(" "),n("span",[t._v(t._s(t.$utils.shortenNumber(t.item.reward_count)))])]):n("div",[n("i",{staticClass:"iconfont icon-like"}),t._v(" "),n("span",[t._v(t._s(t.$utils.shortenNumber(t.item.like_count)))])]),t._v(" "),n("div",[n("i",{staticClass:"iconfont icon-mark"}),t._v(" "),n("span",[t._v(t._s(t.$utils.shortenNumber(t.item.mark_count)))])]),t._v(" "),n("div",[n("i",{staticClass:"iconfont icon-talk"}),t._v(" "),n("span",[t._v(t._s(t.$utils.shortenNumber(t.item.comment_count)))])])])]),t._ssrNode(' <div class="hr"></div>')],2)},[],!1,function(t){var e=n(226);e.__inject__&&e.__inject__(t)},null,"9b8d58e8");e.a=component.exports},244:function(t,e,n){"use strict";n.r(e);var r=n(201),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},245:function(t,e,n){"use strict";n.r(e);var r=n(202),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},247:function(t,e,n){"use strict";var r={name:"ShareBtn",props:{shareData:{type:Object,required:!0}},data:()=>({showModal:!1,backdropId:0,display:!0}),computed:{login(){return this.$store.state.login},shareLink(){return this.shareData?this.shareData.link:`https://m.calibur.tv${this.route.path}`}},methods:{showIntroModal(){this.showModal=!0,this.backdropId=this.$backdrop.show({ele:this.$el,click:()=>{this.showModal=!1,this.$backdrop.hide(this.backdropId)}})},abort(){this.display=!1,this.$backdrop.hide(this.backdropId),this.$toast.success("好吧...orz")},handleCopyOK(){this.showModal=!1,this.$backdrop.hide(this.backdropId),this.$toast.success("复制成功~快去分享给其他人吧！")}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.login&&t.display?n("div",{staticClass:"fenxiao-btn-container"},[t.showModal?t._ssrNode('<div class="modal-content">',"</div>",[t._ssrNode('<div class="tips"><p>这是你的专属邀请码</p> <p>把它分享给其他人，只要有人注册，那么你将会获得5个团子</p> <p>通过你的邀请码注册的人，将会获得2个团子</p> <p>团子可以用来看视频，为偶像应援等</p> <p>或经过转化之后提现，1团子相当于1人民币</p> <p>更重要的是，calibur 的发展需要你的支持，感谢</p></div> '),n("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.shareLink,expression:"shareLink"}],staticClass:"join",on:{success:t.handleCopyOK}},[t._ssrNode("\n      获取分享链接\n    ")]),t._ssrNode(' <button class="abort">\n      但是，我拒绝\n    </button>')],2):t._e(),t._ssrNode(' <button class="fenxiao-btn">\n    分享\n  </button>')],2):t._e()},[],!1,function(t){var e=n(245);e.__inject__&&e.__inject__(t)},null,"1e594501");e.a=component.exports},248:function(t,e,n){"use strict";var r={name:"BangumiPanel",components:{FollowButton:n(224).a},props:{bangumi:{type:Object,required:!0}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.bangumiPanel},[n("nuxt-link",{class:t.$style.avatar,attrs:{to:t.$alias.bangumi(t.bangumi.id)}},[n("v-img",{attrs:{src:t.bangumi.avatar,width:"80",height:"92"}})],1),t._ssrNode(" "),t._ssrNode("<div"+t._ssrClass(null,t.$style.content)+">","</div>",[n("nuxt-link",{attrs:{to:t.$alias.bangumi(t.bangumi.id)}},[n("h5",{staticClass:"oneline",class:t.$style.name,domProps:{textContent:t._s(t.bangumi.name)}})]),t._ssrNode(" <p"+t._ssrClass(null,t.$style.summary)+">"+t._ssrEscape(t._s(t.bangumi.summary))+"</p> "),t._ssrNode("<div"+t._ssrClass(null,t.$style.controls)+">","</div>",[n("FollowButton",{attrs:{id:t.bangumi.id,type:"bangumi"}})],1)],2)],2)},[],!1,function(t){var e=n(244);e.__inject__&&e.__inject__(t),this.$style=e.locals||e},null,"adeff4b4");e.a=component.exports},249:function(t,e){},250:function(t,e){},256:function(t,e){},257:function(t,e){},258:function(t,e){},259:function(t,e){},260:function(t,e){},310:function(t,e,n){"use strict";n.r(e);var r=n(256),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},311:function(t,e,n){"use strict";n.r(e);var r=n(257),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},312:function(t,e,n){"use strict";n.r(e);var r=n(258),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},313:function(t,e,n){"use strict";n.r(e);var r=n(259),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},314:function(t,e){},315:function(t,e){},316:function(t,e,n){"use strict";n.r(e);var r=n(260),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},358:function(t,e){},359:function(t,e){},360:function(t,e){},361:function(t,e){},362:function(t,e){},372:function(t,e,n){"use strict";n(249),n(2);var r=n(149),o=n.n(r),c=(n(250),n(150)),l=n.n(c),d=n(193),m={name:"ChangeIdolProfile",props:{idol:{type:Object,required:!0}},data(){return{qq_group:this.idol.qq_group,lover_words:this.idol.lover_words,manager_id:this.idol.manager?this.idol.manager.id:"",submitting:!1}},methods:{beforeSubmit(){this.submitting||(this.lover_words.length>20?this.$toast.error("留言给我缩减至20字以内重说！"):this.lover_words||this.qq_group?!this.qq_group||/^\d+$/.test(this.qq_group)?(this.manager_id&&!/^\d+$/.test(this.manager_id)&&this.$toast.error("经纪人的id是数字"),!this.qq_group||this.idol.qq_group?this.doSubmit():this.$confirm("QQ群号设置之后不能再修改，确认要设置吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.doSubmit()}).catch(()=>{})):this.$toast.error("QQ群号必须是数字"):this.$toast.error("内容不能为空"))},async doSubmit(){this.submitting=!0;try{await Object(d.a)(this,{idol_id:this.idol.id,qq_group:this.qq_group,manager_id:this.manager_id,lover_words:this.lover_words}),this.$toast.success("修改成功"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){this.submitting=!1}}}},_=n(1);var h=Object(_.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"change-idol-profile"}},[t._ssrNode('<p class="tips">\n    修改特殊留言（一周只能修改一次，20字以内）：\n  </p> '),n("el-input",{attrs:{rows:3,type:"textarea",placeholder:"用简单的文字表达你的爱吧！"},model:{value:t.lover_words,callback:function(e){t.lover_words="string"==typeof e?e.trim():e},expression:"lover_words"}}),t._ssrNode(' <p class="tips">\n    修改QQ群号<span class="warn">（设置之后不能修改）</span>：\n  </p> '),n("el-input",{attrs:{placeholder:"填写QQ群号码"},model:{value:t.qq_group,callback:function(e){t.qq_group=e},expression:"qq_group"}}),t._ssrNode(' <div class="tips">\n    修改经纪人\n  </div> '),n("el-input",{attrs:{placeholder:"填写要任命的经纪人的邀请码"},model:{value:t.manager_id,callback:function(e){t.manager_id=e},expression:"manager_id"}}),t._ssrNode(" "),n("el-button",{attrs:{loading:t.submitting,type:"primary"},on:{click:t.beforeSubmit}},[t._v("\n    确认提交\n  ")])],2)},[],!1,function(t){var e=n(312);e.__inject__&&e.__inject__(t)},null,"761c648c").exports,f=(n(86),n(43)),v={name:"CreateChangeMarketPriceDraft",components:{"el-input-number":n.n(f).a},props:{idol:{type:Object,required:!0}},data:()=>({minLevel:500,stock_form:{submitting:!1,new_price:0,add_stock_count:0}}),computed:{minAddPrice(){let t;return(t=this.idol.star_count<4e3?.25*this.idol.market_price:.1*this.idol.market_price)<this.minLevel?parseFloat(this.minLevel).toFixed(2):parseFloat(t).toFixed(2)},curAddPrice(){return parseFloat(this.stock_form.new_price*this.stock_form.add_stock_count).toFixed(2)},totalMarketPrice(){return parseFloat(+this.idol.market_price+ +this.curAddPrice).toFixed(2)}},methods:{async submitAddStock(){if(!this.stock_form.submitting){this.stock_form.submitting=!0;try{await Object(d.e)(this,{idol_id:this.idol.id,add_stock_count:this.stock_form.add_stock_count,stock_price:this.stock_form.new_price}),this.$toast.success("修改成功"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){this.stock_form.submitting=!1}}}}};var y={name:"IdolSetting",components:{ChangeIdolProfile:h,CreateChangeMarketPriceDraft:Object(_.a)(v,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"create-change-market-price-draft"}},[t._ssrNode("<p>增发规则：</p> <ul><li>"+t._ssrEscape("每次增发的股份，不能小于 "+t._s(t.minLevel)+" 股")+"</li> <li>现阶段，不支持以每股价格低于 1.00 或高于 10.00 的价格进行增发</li></ul> <p>设置股价：</p> "),n("el-input-number",{attrs:{min:1,max:10,step:.01},model:{value:t.stock_form.new_price,callback:function(e){t.$set(t.stock_form,"new_price",e)},expression:"stock_form.new_price"}}),t._ssrNode(" <p>设置份额：</p> "),n("el-input-number",{attrs:{step:1,min:t.minLevel},model:{value:t.stock_form.add_stock_count,callback:function(e){t.$set(t.stock_form,"add_stock_count",e)},expression:"stock_form.add_stock_count"}}),t._ssrNode(" <p>"+t._ssrEscape("当前增发市值：￥"+t._s(t.curAddPrice))+"</p> <p>"+t._ssrEscape("增发后总市值：￥"+t._s(t.totalMarketPrice))+"</p> "),n("el-button",{staticClass:"submit-btn",attrs:{loading:t.stock_form.submitting,type:"primary"},on:{click:t.submitAddStock}},[t._v("\n    确认增发\n  ")])],2)},[],!1,function(t){var e=n(313);e.__inject__&&e.__inject__(t)},null,"05151bf7").exports,"el-collapse":l.a,"el-collapse-item":o.a},props:{idol:{type:Object,required:!0}},data:()=>({activeName:""}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isBoss(){return!!this.idol.boss&&this.idol.boss.id===this.currentUserId}}};var C=Object(_.a)(y,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"idol-setting"}},[t.isBoss?[n("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-collapse-item",{attrs:{name:"0"}},[n("p",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("\n          信息修改\n        ")]),t._v(" "),n("ChangeIdolProfile",{attrs:{idol:t.idol}})],1),t._v(" "),n("el-collapse-item",{attrs:{name:"1"}},[n("p",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("\n          股权变更\n        ")]),t._v(" "),n("CreateChangeMarketPriceDraft",{attrs:{idol:t.idol}})],1)],1)]:t._ssrNode("<p><br> <br>\n    只有大股东可以做数据变更\n    <br> <br> <br></p>")],2)},[],!1,function(t){},null,"3e790571");e.a=C.exports},373:function(t,e,n){"use strict";var r=n(177),o=(n(211),n(2),n(147)),c=n.n(o),l=n(193),d={name:"IdolOrderItem",components:{"el-tag":c.a},props:{item:{type:Object,required:!0}},data(){return{loading:!1,state:this.item.result}},computed:{isMine(){return!!this.$store.state.login&&this.$store.state.user.zone===this.item.buyer.zone},computeTagColor(){const t=this.state;return 0===t?"":1===t?"success":2===t?"danger":3===t?"info":4===t?"warning":5===t?"info":6===t?"danger":""},computedResult(){const t=this.state;return 0===t?"等待作者确认":1===t?"已采购成功":2===t?"作者已拒绝":3===t?"订单已取消":4===t?"作品已出售":5===t?"作品已失效":6===t?"经纪人解约":"未知状态"}},methods:{cancelOrder(t){this.loading||this.$confirm("确认执行该操作吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.loading=!0,await Object(l.g)(this,{order_id:t}),this.$toast.success("订单已取消"),this.state=3}catch(t){this.$toast.error(t)}finally{this.loading=!1}}).catch()},rollbackOrder(t){this.loading||this.$confirm("终止后无法得到收益分成，也不会退还定金，确认要这么做吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.loading=!0,await Object(l.q)(this,{order_id:t}),this.$toast.success("订单已解约"),this.state=6}catch(t){this.$toast.error(t)}finally{this.loading=!1}}).catch()}}},m=n(1);var _=Object(m.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",{staticClass:"idol-order-item"},[t._ssrNode('<div class="header">',"</div>",[n("nuxt-link",{staticClass:"avatar",attrs:{to:t.$alias.user(t.item.buyer.zone)}},[n("img",{attrs:{src:t.$resize(t.item.buyer.avatar,{width:80})}})]),t._ssrNode(" "),t._ssrNode('<div class="info">',"</div>",[n("nuxt-link",{staticClass:"name oneline",attrs:{to:t.$alias.post(t.item.product.id)},domProps:{textContent:t._s(t.item.product.title)}}),t._ssrNode(' <div class="meta"><span>采购帖子</span></div>')],2)],2),t._ssrNode(" "),n("nuxt-link",{staticClass:"body",attrs:{to:t.$alias.post(t.item.product.id)}},[n("p",{staticClass:"intro"},[t._v("\n      订单详情：\n    ")]),t._v(" "),n("p",[t._v("价格：￥"+t._s(t.item.amount))]),t._v(" "),n("p",[t._v("分成：偶像占"+t._s(t.item.income_ratio)+"%")]),t._v(" "),n("p",[t._v("\n      状态："),n("el-tag",{attrs:{size:"mini",type:t.computeTagColor}},[t._v("\n        "+t._s(t.computedResult)+"\n      ")])],1)]),t._ssrNode(' <div class="footer"><span>'+t._ssrEscape("时间："+t._s(t.item.created_at.split(" ")[0]))+"</span> "+(t.isMine?(0===t.state?"<button>\n        取消订单\n      </button>":"\x3c!----\x3e")+" "+(1===t.state?"<button>\n        终止订单\n      </button>":"\x3c!----\x3e"):"\x3c!----\x3e")+"</div>")],2)},[],!1,function(t){var e=n(310);e.__inject__&&e.__inject__(t)},null,"6111d03c").exports,h={name:"IdolProductOrderList",components:{FlowList:r.a,IdolOrderItem:_},props:{idolId:{type:String,required:!0}}};var f=Object(m.a)(h,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"idol-product-order-list"},[n("FlowList",{attrs:{id:t.idolId,func:"getIdolProductOrders",type:"page",sort:"news"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.flow;return n("ul",{},t._l(r,function(t){return n("IdolOrderItem",{key:t.id,attrs:{item:t}})}),1)}}])})],1)},[],!1,function(t){},null,"5ca2de8c");e.a=f.exports},377:function(t,e,n){"use strict";n(314),n(2);var r=n(156),o=n.n(r),c=(n(315),n(157)),l=n.n(c),d=n(193),m={name:"IdolTimeline",components:{"el-steps":l.a,"el-step":o.a},props:{isBoss:{type:Boolean,required:!0},idol:{type:Object,required:!0}},data:()=>({submitting:!1}),computed:{source(){return this.$store.getters["flow/getFlow"]("getIdolDraftList","new",this.idol.id)},draft(){return this.source&&this.source.total?this.source.list[0]:null}},methods:{async submitVote(t){if(this.$store.state.login){if(!this.submitting){this.submitting=!0;try{await Object(d.p)(this,{is_agree:t,idol_id:this.idol.id,draft_id:this.draft.id}),this.$toast.success("投票成功"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){this.$toast.error(t),this.submitting=!1}}}else this.$channel.$emit("sign-in")}}},_=n(1);var component=Object(_.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"idol-market-price-draft"}},[t.draft&&0==t.draft.result?t._ssrNode("<div>","</div>",[n("el-alert",{staticStyle:{"margin-top":"15px","margin-bottom":"10px"},attrs:{closable:!1,type:"warning",title:"提案项在通过/反对占比大于「50%」之后，会由系统自动增发股票/关闭提案（最多延迟5分钟）"}}),t._ssrNode(" "),n("el-alert",{staticStyle:{"margin-bottom":"15px"},attrs:{closable:!1,type:"warning",title:"若股东超过两天仍未投票，则视为弃权，将会用已投票的数据通过或驳回增发提案"}}),t._ssrNode(" "),t._ssrNode('<div class="draft-control">',"</div>",[t._ssrNode('<div class="text-wrap"><p><strong>提案内容：</strong> <span>'+t._ssrEscape("增发"+t._s(t.draft.add_stock_count)+"股，每股￥"+t._s(t.draft.stock_price))+"</span></p> <p><strong>提案董事：</strong> <span>"+t._ssrEscape(t._s(t.draft.user.nickname))+"</span></p> <p><strong>提案时间：</strong> <span>"+t._ssrEscape(t._s(t.draft.created_at))+"</span></p> <p><strong>通过情况：</strong> <span>"+t._ssrEscape(t._s(t.draft.pass_count)+"人投票，占比："+t._s(t.draft.pass_percent)+"%")+"</span></p> <p><strong>反对情况：</strong> <span>"+t._ssrEscape(t._s(t.draft.ban_count)+"人投票，占比："+t._s(t.draft.ban_percent)+"%")+"</span></p> <p><strong>我的选择：</strong> <span>"+t._ssrEscape(t._s(0===t.draft.voted?"未投票":t.draft.voted>0?"赞同票":"反对票"))+"</span></p></div> "),t._ssrNode('<div class="button-wrap">',"</div>",[n("el-button",{attrs:{loading:t.submitting,plain:t.draft.voted>0,type:"success",icon:"el-icon-caret-top"},on:{click:function(e){return t.submitVote(!0)}}},[t._v("\n          赞同\n        ")]),t._ssrNode(" "),n("el-button",{attrs:{loading:t.submitting,plain:t.draft.voted<0,type:"danger"},on:{click:function(e){return t.submitVote(!1)}}},[t._v("\n          反对\n          "),n("i",{staticClass:"el-icon-caret-bottom el-icon--right"})])],2)],2)],2):t._e(),t._ssrNode(" "),t.source&&t.source.noMore?n("el-steps",{attrs:{space:"100px",direction:"vertical"}},[t.idol.ipo_at?t.source.total?[t._l(t.source.list,function(t){return n("el-step",{key:t.id,attrs:{status:0===t.result?"finish":1===t.result?"success":"error",description:t.created_at+" - 本提案由「"+t.user.nickname+"」发起，发行「"+t.add_stock_count+"」股，每股「￥"+t.stock_price+"」，"+(0===t.result?"董事会正在投票":1===t.result?"董事会表决通过":"董事会表决未通过"),title:"增发提案"}})}),t._v(" "),n("el-step",{attrs:{description:t.idol.ipo_at,title:"公司上市",status:"success"}}),t._v(" "),n("el-step",{attrs:{description:t.idol.created_at,title:"公司注册",status:"success"}})]:[n("el-step",{attrs:{title:"增发提案",status:"process",description:"大股东还未发起提案"}}),t._v(" "),n("el-step",{attrs:{description:t.idol.ipo_at,title:"公司上市",status:"success"}}),t._v(" "),n("el-step",{attrs:{description:t.idol.created_at,title:"公司注册",status:"success"}})]:[n("el-step",{attrs:{title:"增发提案",status:"wait",description:"还未选举出大股东"}}),t._v(" "),n("el-step",{attrs:{description:"投资人未满20人，还差"+(20-t.idol.fans_count)+"人",title:"等待上市",status:"process"}}),t._v(" "),n("el-step",{attrs:{description:t.idol.created_at,title:"公司注册",status:"success"}})]],2):t._e()],2)},[],!1,function(t){var e=n(316);e.__inject__&&e.__inject__(t)},null,"6837ba20");e.a=component.exports},378:function(t,e,n){"use strict";var r=n(155),o=n.n(r),c=n(193),l={name:"IdolStockChart",props:{source:{type:Array,required:!0},idolId:{type:[Number,String],required:!0}},data(){return{chart:null,index:0,list:[this.source,[],[]]}},mounted(){this.initF2Animation(),this.drawChart(this.list[this.index]),this.getIdolChartData(7,1),this.getIdolChartData(30,2)},methods:{initF2Animation(){o.a.Animate.registerAnimation("lineUpdate",function(t,e){const n=t.get("cacheShape"),r=n.attrs,o=n.geomType,c=r.points,l=t.attr("points"),d=c.length,m=l.length;let _="area"===o?(d-m)/2:d-m;if(_>0){const t=l[0],e=l[l.length-1];for(let i=0;i<_;i++)l.splice(0,0,t);if("area"===o)for(let t=0;t<_;t++)l.push(e)}else{_=Math.abs(_);const t=c[0],e=c[c.length-1];for(let e=0;e<_;e++)c.splice(0,0,t);if("area"===o)for(let p=0;p<_;p++)c.push(e);r.points=c}t.attr(r),t.animate().to({attrs:{points:l},duration:800,easing:e.easing})})},getIdolChartData(t,e){Object(c.k)(this,{days:t,idol_id:this.idolId}).then(data=>{this.list[e]=data}).catch(()=>{})},switchChart(t){this.chart&&(this.index=t,this.chart.changeData(this.list[t]))},drawChart(t){const data=t.map(t=>({time:1e3*+t.time,value:parseFloat(t.value).toFixed(2)})),e=new o.a.Chart({id:"chart-node",pixelRatio:window.devicePixelRatio,padding:["auto",0,"auto",40]});this.chart=e,e.source(data,{time:{type:"timeCat",tickCount:5,range:[0,1],mask:"HH:mm"},value:{type:"linear",alias:"市值",tickCount:5}}),e.tooltip({showCrosshairs:!0}),e.axis("time",{label:function(text,t,e){const n={textAlign:"center"};return 0===t&&(n.textAlign="start"),t>0&&t===e-1&&(n.textAlign="end"),n}}),e.line({sortable:!1}).position("time*value").shape("smooth").animate({update:{animation:"lineUpdate"}}),e.area({sortable:!1}).position("time*value").shape("smooth").animate({update:{animation:"lineUpdate"}}),e.render()}}},d=n(1);var component=Object(d.a)(l,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{attrs:{id:"idol-stock-chart"}},[t._ssrNode('<canvas id="chart-node"></canvas> <div class="shim"'+t._ssrStyle(null,null,{display:t.list[t.index].length?"none":""})+'>\n    暂无数据\n  </div> <div class="control"><button'+t._ssrClass(null,{active:0===t.index})+">\n      24 小时\n    </button> <button"+t._ssrClass(null,{active:1===t.index})+">\n      近 7 天\n    </button> <button"+t._ssrClass(null,{active:2===t.index})+">\n      近 30 天\n    </button></div>")])},[],!1,function(t){var e=n(311);e.__inject__&&e.__inject__(t)},null,"3d7ff052");e.a=component.exports},441:function(t,e,n){"use strict";n.r(e);var r=n(358),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},442:function(t,e,n){"use strict";n.r(e);var r=n(359),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},443:function(t,e,n){"use strict";n.r(e);var r=n(360),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},444:function(t,e,n){"use strict";n.r(e);var r=n(361),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},445:function(t,e,n){"use strict";n.r(e);var r=n(362),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},461:function(t,e,n){"use strict";n.r(e);n(249),n(2);var r=n(149),o=n.n(r),c=(n(250),n(150)),l=n.n(c),d=n(193),m=n(206),_=n(248),h=n(247),f=(n(86),n(43)),v={name:"StarIdolBtn",components:{"el-input-number":n.n(f).a},props:{idol:{type:Object,required:!0}},data(){return{showDrawer:!1,count:this.idol.company_state?.01:1}},computed:{signed(){return this.$store.state.login},pocket(){return this.signed?+this.$store.state.user.pocket:0},maxCount(){const t=this.idol.max_stock_count&&"0.00"!==this.idol.max_stock_count?this.idol.max_stock_count-this.idol.star_count:-1,e=this.pocket?this.pocket/this.idol.stock_price:0;return-1===t?e:Math.min(e,t)},minCount(){return Math.min(this.idol.company_state?.01:1,this.maxCount)},needPay(){return this.count?parseFloat(this.idol.stock_price*this.count).toFixed(2):"0.00"}},methods:{openStarDrawer(){this.signed?this.idol.is_locked?this.$toast.error("已经停牌了，等待下次挂牌吧"):this.showDrawer=!0:this.$channel.$emit("sign-in")},async submitOrder(){if(this.count<=0)this.$toast.error("未选择份额");else if(!this.submitting){this.submitting=!0,this.$toast.loading("入股中");try{await Object(d.r)(this,{id:this.idol.id,amount:this.count}),this.$store.commit("USE_COIN",this.needPay),this.$emit("success",{count:this.count,amount:this.needPay})}finally{this.submitting=!1}}}}},y=n(1);var C=Object(y.a)(v,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"star-idol-btn-wrap"},[t._ssrNode("<button"+t._ssrClass("star-idol-btn",{locked:t.idol.is_locked})+">"+t._ssrEscape("\n    "+t._s(t.idol.is_locked?"已停牌":"入股")+"\n  ")+"</button> "),n("v-drawer",{attrs:{"header-text":"入股","submit-text":"确认",from:"bottom",size:"70%"},on:{submit:t.submitOrder},model:{value:t.showDrawer,callback:function(e){t.showDrawer=e},expression:"showDrawer"}},[n("div",{staticClass:"buy-idol-stock-drawer container"},[n("p",{staticClass:"intro"},[t._v("\n        每股价格：\n      ")]),t._v(" "),n("p",[t._v("￥"+t._s(t.idol.stock_price))]),t._v(" "),n("p",{staticClass:"intro"},[t._v("\n        购买上限：\n      ")]),t._v(" "),n("p",[t._v(t._s(parseFloat(t.maxCount).toFixed(2))+"股")]),t._v(" "),n("p",{staticClass:"intro"},[t._v("\n        购入份额：\n      ")]),t._v(" "),t.signed?n("el-input-number",{attrs:{min:t.minCount,max:t.maxCount,step:.01},model:{value:t.count,callback:function(e){t.count=e},expression:"count"}}):t._e(),t._v(" "),n("p",{staticClass:"intro"},[t._v("\n        账单计算：\n      ")]),t._v(" "),n("p",[t._v("预计支付："+t._s(t.needPay))]),t._v(" "),n("p",[t._v("购买后钱包余额："+t._s(parseFloat(t.pocket-t.needPay).toFixed(2)))])],1)])],2)},[],!1,function(t){var e=n(441);e.__inject__&&e.__inject__(t)},null,"13dbfdcb").exports,$=n(225),w=n(177),x={name:"IdolOwnerList",components:{FlowList:w.a},props:{id:{type:[Number,String],required:!0},star:{type:[Number,String],required:!0}},data:()=>({active:"按持股数量"}),methods:{handleTabSwitch(label){"按持股数量"===label?this.getBigOwner():this.getNewOwner()},computedPercent(t){return`${parseFloat(t/this.star*100).toFixed(2)}%`},getBigOwner(){this.$store.dispatch("flow/initData",{func:"virtualIdolOwners",type:"seenIds",sort:"biggest",id:this.id})},getNewOwner(){this.$store.dispatch("flow/initData",{func:"virtualIdolOwners",type:"lastId",sort:"newest",id:this.id})}}};var k=Object(y.a)(x,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"idol-owner-list"}},[t._ssrNode('<div class="header">',"</div>",[n("el-radio-group",{attrs:{size:"mini"},on:{change:t.handleTabSwitch},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[n("el-radio-button",{attrs:{label:"按持股数量"}}),t._v(" "),n("el-radio-button",{attrs:{label:"按入股时间"}})],1)],1),t._ssrNode(" "),n("FlowList",{directives:[{name:"show",rawName:"v-show",value:"按持股数量"===t.active,expression:"active === '按持股数量'"}],attrs:{id:t.id,func:"virtualIdolOwners",type:"seenIds",sort:"biggest"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.flow;return n("ul",{staticClass:"owner-list"},t._l(r,function(e){return n("li",{key:e.id},[n("nuxt-link",{attrs:{to:t.$alias.user(e.zone)}},[n("span",{staticClass:"score"},[t._v("持有"+t._s(e.score)+"股，占比"+t._s(t.computedPercent(e.score)))]),t._v(" "),n("div",{staticClass:"user"},[n("img",{staticClass:"avatar",attrs:{src:t.$resize(e.avatar,{width:60})}}),t._v(" "),n("p",{staticClass:"nickname oneline",domProps:{textContent:t._s(e.nickname)}})])])],1)}),0)}}])}),t._ssrNode(" "),n("FlowList",{directives:[{name:"show",rawName:"v-show",value:"按入股时间"===t.active,expression:"active === '按入股时间'"}],attrs:{id:t.id,func:"virtualIdolOwners",type:"lastId",sort:"newest"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.flow;return n("ul",{staticClass:"owner-list"},t._l(r,function(e){return n("li",{key:e.id},[n("nuxt-link",{attrs:{to:t.$alias.user(e.zone)}},[n("v-time",{staticClass:"score",model:{value:e.score,callback:function(n){t.$set(e,"score",n)},expression:"item.score"}}),t._v(" "),n("div",{staticClass:"user"},[n("img",{staticClass:"avatar",attrs:{src:t.$resize(e.avatar,{width:60})}}),t._v(" "),n("p",{staticClass:"nickname oneline",domProps:{textContent:t._s(e.nickname)}})])],1)],1)}),0)}}])})],2)},[],!1,function(t){var e=n(442);e.__inject__&&e.__inject__(t)},null,"5e38735c").exports,N=n(377),I={name:"IdolStockTable",props:{idol:{type:Object,required:!0}},computed:{hasLimited(){return"0.00"!==this.idol.max_stock_count},hasBuyStock(){return"0.00"!==this.idol.has_star},productBalance(){const t=this.idol.total_pay-this.idol.total_income,e=`${parseFloat(t/this.idol.market_price*100).toFixed(2)}%`;return`￥${parseFloat(t).toFixed(2)}（${e}）`}}};var S=Object(y.a)(I,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{attrs:{id:"idol-stock-table"}},[t._ssrNode('<table class="table"><thead><tr><th>当前市值</th> <th>每股价格</th> <th>持股人数</th></tr></thead> <tbody><tr><td>'+t._ssrEscape("\n          "+t._s(t.idol.company_state?"￥"+t.idol.market_price:"未上市")+"\n        ")+"</td> <td>"+t._ssrEscape("￥"+t._s(t.idol.stock_price))+"</td> <td>"+t._ssrEscape(t._s(t.idol.fans_count)+"人")+"</td></tr></tbody> <thead><tr><th>总发行股</th> <th>已认购股</th> <th>我持有股</th></tr></thead> <tbody><tr><td>"+t._ssrEscape(t._s(t.hasLimited?t.idol.max_stock_count:"无上限"))+"</td> <td>"+t._ssrEscape(t._s(t.idol.star_count))+"</td> <td>"+t._ssrEscape(t._s(t.hasBuyStock?t.idol.has_star:"未入股"))+'</td></tr></tbody> <thead><tr><th>产品支出</th> <th>产品收入</th> <th>公司盈利</th></tr></thead> <tbody style="margin-bottom:5px"><tr><td>'+t._ssrEscape(t._s(t.idol.company_state?t.idol.total_pay:"-"))+"</td> <td>"+t._ssrEscape(t._s(t.idol.company_state?t.idol.total_income:"-"))+"</td> <td>"+t._ssrEscape(t._s(t.idol.company_state?t.productBalance:"-"))+"</td></tr></tbody></table>")])},[],!1,function(t){var e=n(443);e.__inject__&&e.__inject__(t)},null,"0c78f3c7").exports,F=n(378),j=n(372),O=n(238),M={name:"IdolProductArea",components:{FlowList:w.a,PostFlowItem:O.a},props:{idolId:{type:String,required:!0},state:{type:Number,required:!0}}};var T=Object(y.a)(M,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"idol-product-area"}},[n("FlowList",{attrs:{id:t.idolId,func:"getIdolProducts",type:"lastId",sort:"news"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.flow;return n("ul",{},t._l(r,function(t){return n("PostFlowItem",{key:t.id,attrs:{item:t,"bangumi-id":"","user-zone":""}})}),1)}}])})],1)},[],!1,function(t){var e=n(444);e.__inject__&&e.__inject__(t)},null,"91327286").exports,E=n(373),U={name:"RoleShow",validate:({params:t})=>/^\d+$/.test(t.id),components:{CommentMain:m.a,BangumiPanel:_.a,ShareBtn:h.a,StarIdolBtn:C,TabContainer:$.a,IdolOwnerList:k,IdolTimeline:N.a,IdolStockTable:S,IdolStockChart:F.a,IdolProductArea:T,IdolSetting:j.a,IdolProductOrderList:E.a,"el-collapse":l.a,"el-collapse-item":o.a},props:{id:{type:String,required:!0}},data:()=>({role:null,bangumi:null,share_data:null,collapsed:!0,activeNames:["1","2","3"]}),computed:{computedHtmlIntro(){return this.role.intro.replace(/\n/g,"<br>")},computedIdolMoney(){const t=+this.role.market_price,e=+this.role.star_count,n=+this.role.total_income,r=+this.role.total_pay;return parseFloat(t-e+n-r).toFixed(2)},currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},tabs:()=>[{label:"产品区"},{label:"留言板"},{label:"投资人"},{label:"大事记"},{label:"采购表"},{label:"变更"}],isBoss(){return!!this.role.boss&&this.role.boss.id===this.currentUserId}},asyncData({app:t,store:e,params:n,error:r}){const{id:o}=n;return Object(d.i)(t,{id:o}).then(data=>{const{bangumi:t}=data;return e.commit("social/SET_STATE",{type:"bangumi",id:t.id,data:{follow:t.followed}}),{...data}}).catch(t=>{r({statusCode:t.statusCode,message:t.message})})},head(){return{title:this.role.name,script:[{hid:"share-data",innerHTML:JSON.stringify(this.share_data),type:"application/json"}]}},methods:{handleStarCallback({count:t,amount:e}){parseFloat(this.role.has_star)||(this.role.fans_count++,20===this.role.fans_count&&(this.role.company_state=1)),this.role.boss&&this.currentUserId===this.role.boss.id&&(this.role.boss.score+=t),this.role.market_price=parseFloat(parseFloat(this.role.market_price)+e).toFixed(2),this.role.has_star=parseFloat(parseFloat(this.role.has_star)+t).toFixed(2),this.role.star_count=parseFloat(parseFloat(this.role.star_count)+t).toFixed(2),this.$toast.success(`当前持股：${this.role.has_star}`)},handleTabSwitch(t){0===t&&this.$store.dispatch("flow/initData",{func:"getIdolProducts",type:"lastId",sort:"news",id:this.id}),2===t&&this.$store.dispatch("flow/initData",{func:"virtualIdolOwners",type:"seenIds",sort:"biggest",id:this.id}),3===t&&this.$store.dispatch("flow/initData",{func:"getIdolDraftList",type:"page",sort:"new",id:this.id}),4===t&&this.$store.dispatch("flow/initData",{func:"getIdolProductOrders",type:"page",sort:"news",id:this.id})}}};var A=Object(y.a)(U,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"role-show",attrs:{id:"role-show"}},[t._ssrNode('<div class="container info-wrap">',"</div>",[n("el-collapse",{model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[n("el-collapse-item",{attrs:{title:"偶像信息",name:"1"}},[t.role.has_market_price_draft?n("div",{staticClass:"notice"},[t.role.market_price_draft_voted?n("el-alert",{attrs:{closable:!1,description:"你已投「"+(t.role.market_price_draft_voted>0?"同意":"反对")+"」票",title:"正在召开股东大会",type:"info"}}):n("el-alert",{attrs:{closable:!1,title:"正在召开股东大会",type:"warning",description:"股东大会召开中，请全体股东到本页面「大事记」一栏进行会议投票"}})],1):t._e(),t._v(" "),n("div",{staticClass:"profile"},[n("div",{staticClass:"clearfix"},[n("v-img",{staticClass:"avatar",attrs:{src:t.role.avatar,width:75,height:75}}),t._v(" "),n("div",{staticClass:"info"},[n("h1",{staticClass:"name",domProps:{textContent:t._s(t.role.name)}}),t._v(" "),n("StarIdolBtn",{attrs:{idol:t.role},on:{success:t.handleStarCallback}})],1)],1),t._v(" "),n("div",{on:{click:function(e){t.collapsed=!t.collapsed}}},[t.collapsed?n("p",{staticClass:"summary collapsed"},[n("strong",[t._v("简介：")]),t._v(t._s(t.role.intro.substr(0,30))+"...\n              "),n("button",[t._v("全文")])]):n("div",{staticClass:"summary"},[n("strong",[t._v("简介：")]),t._v(" "),n("p",{domProps:{innerHTML:t._s(t.computedHtmlIntro)}}),t._v(" "),n("button",[t._v("收起")])])])])]),t._v(" "),n("el-collapse-item",{attrs:{title:"股市详情",name:"2"}},[n("IdolStockTable",{attrs:{idol:t.role}}),t._v(" "),n("IdolStockChart",{attrs:{source:t.role.chart,"idol-id":t.id}})],1),t._v(" "),n("el-collapse-item",{attrs:{title:"组织信息",name:"3"}},[t.role.boss?n("div",[n("h3",{staticClass:"sub-title"},[t._v("\n            大股东\n          ")]),t._v(" "),n("div",{staticClass:"boss"},[n("nuxt-link",{attrs:{to:t.$alias.user(t.role.boss.zone)}},[n("img",{attrs:{src:t.$resize(t.role.boss.avatar,{width:30,height:30})}}),t._v(" "),n("span",[t._v(t._s(t.role.boss.nickname))])]),t._v(" "),n("span",[t._v("："+t._s(t.role.lover_words||"TA还什么都没说"))])],1)]):t._e(),t._v(" "),t.role.manager?n("div",[n("h3",{staticClass:"sub-title"},[t._v("\n            经纪人\n          ")]),t._v(" "),n("div",{staticClass:"boss"},[n("nuxt-link",{attrs:{to:t.$alias.user(t.role.manager.zone)}},[n("img",{attrs:{src:t.$resize(t.role.manager.avatar,{width:30,height:30})}}),t._v(" "),n("span",[t._v(t._s(t.role.manager.nickname))])])],1)]):t._e(),t._v(" "),t.role.company_state?n("div",[n("h3",{staticClass:"sub-title"},[t._v("\n            可支配资产\n          ")]),t._v(" "),n("div",{staticClass:"boss"},[n("span",[t._v("￥"+t._s(t.computedIdolMoney))])])]):t._e(),t._v(" "),n("div",[n("h3",{staticClass:"sub-title"},[t._v("\n            应援群\n          ")]),t._v(" "),n("div",{staticClass:"qq-group"},[n("p",[n("strong",[t._v("QQ群号：")]),t._v(t._s(t.role.qq_group||"106402736"))])])])])],1)],1),t._ssrNode(' <div class="hr"></div> '),t._ssrNode('<div class="container">',"</div>",[n("BangumiPanel",{attrs:{bangumi:t.bangumi}})],1),t._ssrNode(' <div class="hr"></div> '),t._ssrNode('<div class="container tab-wrap">',"</div>",[n("TabContainer",{attrs:{headers:t.tabs,"def-index":"1"},on:{change:t.handleTabSwitch}},[n("template",{slot:"0"},[n("IdolProductArea",{attrs:{"idol-id":t.id,state:t.role.company_state}})],1),t._v(" "),n("template",{slot:"1"},[n("v-lazy",[n("CommentMain",{attrs:{id:t.id,"master-id":1,type:"role"}})],1)],1),t._v(" "),n("template",{slot:"2"},[n("IdolOwnerList",{attrs:{id:t.id,star:t.role.star_count}})],1),t._v(" "),n("template",{slot:"3"},[n("IdolTimeline",{attrs:{"is-boss":t.isBoss,idol:t.role}})],1),t._v(" "),n("template",{slot:"4"},[n("IdolProductOrderList",{attrs:{"idol-id":t.id}})],1),t._v(" "),n("template",{slot:"5"},[n("IdolSetting",{attrs:{idol:t.role}})],1)],2)],1),t._ssrNode(" "),n("ShareBtn",{attrs:{"share-data":t.share_data}})],2)},[],!1,function(t){var e=n(445);e.__inject__&&e.__inject__(t)},null,"92943b76");e.default=A.exports}};
//# sourceMappingURL=_id.chunk.45b57fca.js.map