exports.ids=[39],exports.modules={178:function(t,e){},179:function(t,e,o){"use strict";var r=o(4),n={name:"FlowState",props:{auto:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},noMore:{type:Boolean,default:!1},nothing:{type:Boolean,default:!1},error:{type:Boolean,default:!1},fetch:{type:Function,required:!0},displayNoMore:{type:Boolean,default:!0}},mounted(){this.auto&&this.onScroll()},methods:{getTarget(){let t=this.$el;for(;"HTML"!==t.tagName&&"BOYD"!==t.tagName&&1===t.nodeType;){const e=window.getComputedStyle(t).overflowY;if("scroll"===e||"auto"===e)return t;t=t.parentNode}return document},onScroll(){if(this.error)return;r.a.checkInView(this.$el)&&this.fetch();const t=r.a.on(this.getTarget(),["scroll"],this.$utils.throttle(()=>{this.error||(!this.noMore&&this.auto?r.a.checkInView(this.$el)&&this.fetch():r.a.off(t))},200))}}},l=o(1);var d={name:"FlowList",components:{FlowState:Object(l.a)(n,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"flow-state-wrap"},[t.error?t._ssrNode("<div>","</div>",[t._t("error",[r("div",{staticClass:"state-error"},[r("span",[t._v("出错了，点击重试")])])])],2):t.nothing?t._ssrNode("<div>","</div>",[t._t("nothing",[r("div",{staticClass:"state-nothing"},[r("img",{attrs:{src:o(89),alt:"no-content"}}),t._v(" "),r("span",[t._v("这里什么都没有")])])])],2):t.noMore?t._ssrNode("<div>","</div>",[t._t("no-more",[t.displayNoMore?r("div",{staticClass:"state-no-more"},[r("span",[t._v("没有更多了")])]):t._e()])],2):t.loading?t._ssrNode("<div>","</div>",[t._t("loading",[r("div",{staticClass:"state-loading"},[r("i"),t._v(" "),r("span",[t._v("加载中…")])])])],2):t.auto?t._ssrNode('<div class="state-shim"></div>'):t._ssrNode("<button>","</button>",[t._t("load-btn",[r("div",{staticClass:"state-fetch-btn-text"},[r("span",[t._v("点击加载更多")])])])],2)])},[],!1,function(t){var e=o(180);e.__inject__&&e.__inject__(t)},null,"16540fb2").exports},mixins:[{props:{func:{required:!0,type:String},type:{required:!0,type:String},id:{type:[Number,String],default:""},sort:{type:String,default:""},auto:{type:Boolean,default:!0},count:{type:[String,Number],default:12},changing:{type:String,default:"id"},displayNoMore:{type:Boolean,default:!0}}}],computed:{source(){return this.$store.getters["flow/getFlow"](this.func,this.sort,this.id)}},methods:{loadMore(){this.$store.dispatch("flow/loadMore",{type:this.type,sort:this.sort,func:this.func,id:this.id,count:this.count,changing:this.changing,_extra:this.extra})}}},c=Object(l.a)(d,function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.source?o("div",[t._t("header",null,{source:t.source}),t._ssrNode(" "),t._t("default",null,{flow:t.source.list}),t._ssrNode(" "),o("FlowState",{attrs:{auto:t.auto,loading:t.source.loading,"no-more":t.source.noMore,nothing:t.source.nothing,error:t.source.error,"display-no-more":t.displayNoMore,fetch:t.loadMore}},[t._t("error",null,{slot:"error"}),t._v(" "),t._t("nothing",null,{slot:"nothing"}),t._v(" "),t._t("no-more",null,{slot:"no-more"}),t._v(" "),t._t("loading",null,{slot:"loading"}),t._v(" "),t._t("load-btn",null,{slot:"load-btn"})],2)],2):t._e()},[],!1,null,null,"0bee53e6");e.a=c.exports},180:function(t,e,o){"use strict";o.r(e);var r=o(178),n=o.n(r);for(var l in r)"default"!==l&&function(t){o.d(e,t,function(){return r[t]})}(l);e.default=n.a},198:function(t,e,o){"use strict";o.d(e,"i",function(){return r}),o.d(e,"q",function(){return n}),o.d(e,"h",function(){return l}),o.d(e,"c",function(){return d}),o.d(e,"n",function(){return c}),o.d(e,"f",function(){return _}),o.d(e,"l",function(){return h}),o.d(e,"e",function(){return m}),o.d(e,"o",function(){return f}),o.d(e,"a",function(){return v}),o.d(e,"m",function(){return y}),o.d(e,"j",function(){return $}),o.d(e,"d",function(){return x}),o.d(e,"b",function(){return w}),o.d(e,"g",function(){return k}),o.d(e,"p",function(){return C}),o.d(e,"k",function(){return D});const r=(t,{id:e})=>t.$axios.$get(`cartoon_role/${e}/stock_show`),n=(t,{id:e,amount:o})=>t.$axios.$post(`cartoon_role/${e}/buy_stock`,{amount:o}),l=(t,{id:e})=>t.$axios.$get(`cartoon_role/${e}/get_idol_deal`),d=(t,form)=>t.$axios.$post("cartoon_role/create_deal",form),c=(t,form)=>t.$axios.$post("cartoon_role/make_deal",form),_=(t,{id:e})=>t.$axios.$post("cartoon_role/delete_deal",{id:e}),h=t=>t.$axios.$get("cartoon_role/stock_meta"),m=(t,form)=>t.$axios.$post("cartoon_role/create_market_price_draft",form),f=(t,{is_agree:e,idol_id:o,draft_id:r})=>t.$axios.$post("cartoon_role/vote_market_price_draft",{is_agree:e,idol_id:o,draft_id:r}),v=(t,{idol_id:e,qq_group:o,lover_words:r,manager_id:n})=>t.$axios.$post("cartoon_role/change_idol_profile",{idol_id:e,qq_group:o,lover_words:r,manager_id:n}),y=t=>t.$axios.$get("cartoon_role/user_draft_work"),$=t=>t.$axios.$get("cartoon_role/can_use_income"),x=(t,{product_id:e,product_type:o,amount:r})=>t.$axios.$post("cartoon_role/create_buy_request",{product_id:e,product_type:o,amount:r}),w=(t,{order_id:e,result:o})=>t.$axios.$post("cartoon_role/check_product_request",{order_id:e,result:o}),k=(t,{order_id:e})=>t.$axios.$post("cartoon_role/delete_buy_request",{order_id:e}),C=(t,{order_id:e})=>t.$axios.$post("cartoon_role/over_buy_request",{order_id:e}),D=t=>t.$axios.$get("cartoon_role/get_mine_product_orders")},206:function(t,e){},235:function(t,e){},301:function(t,e,o){"use strict";o.r(e);var r=o(235),n=o.n(r);for(var l in r)"default"!==l&&function(t){o.d(e,t,function(){return r[t]})}(l);e.default=n.a},302:function(t,e){},347:function(t,e,o){"use strict";o(206),o(2);var r=o(153),n={name:"DealIdolItem",components:{"el-tag":o.n(r).a},props:{item:{type:Object,required:!0}},computed:{isMine(){return!!this.$store.state.login&&(!this.item.user||this.$store.state.user.id===this.item.user.id)}},methods:{computePriceText(t){const e=t.product_price-t.idol.stock_price;return e>0?"高于市场价":0===e?"等于市场价":"低于市场价"},computePriceColor(t){const e=t.product_price-t.idol.stock_price;return e>0?"danger":0===e?"info":"success"},makeDeal(){this.$emit("create",this.item)},deleteDeal(){this.$emit("delete",this.item)}}},l=o(1);var component=Object(l.a)(n,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("li",{staticClass:"deal-idol-item"},[t._ssrNode('<div class="header">',"</div>",[o("nuxt-link",{attrs:{to:t.$alias.cartoonRole(t.item.idol.id)}},[o("img",{attrs:{src:t.$resize(t.item.idol.avatar,{width:70,height:70})}})]),t._ssrNode(" "),t._ssrNode('<div class="intro">',"</div>",[o("nuxt-link",{attrs:{to:t.$alias.cartoonRole(t.item.idol.id)}},[o("p",{staticClass:"name oneline",domProps:{textContent:t._s(t.item.idol.name)}})]),t._ssrNode(" "),t.item.user?o("nuxt-link",{attrs:{to:t.$alias.user(t.item.user.zone)}},[o("p",{staticClass:"nickname oneline"},[t._v("\n          交易人："+t._s(t.item.user.nickname)+"\n        ")])]):t._e()],2)],2),t._ssrNode(" "),t._ssrNode('<div class="body">',"</div>",[t._ssrNode('<p class="intro">\n      股价详情：\n    </p> <p>'+t._ssrEscape("当前市值：￥"+t._s(t.item.idol.market_price))+"</p> <p>"+t._ssrEscape("每股股价：￥"+t._s(t.item.idol.stock_price))+"</p> <p>"+t._ssrEscape("发行股数："+t._s(t.item.idol.star_count))+'</p> <p class="intro badge">\n      交易详情：\n    </p> <p>'+t._ssrEscape("交易编号：# "+t._s(t.item.id))+"</p> <p>"+t._ssrEscape("出售股价：￥"+t._s(t.item.product_price))+"</p> <p>"+t._ssrEscape("出售股数："+t._s(t.item.product_count))+"</p> <p>"+t._ssrEscape("\n      已成交数："+t._s(parseFloat(t.item.product_count-t.item.last_count).toFixed(2))+"\n    ")+"</p> "),t._ssrNode('<div class="badge">',"</div>",[o("el-tag",{attrs:{type:t.computePriceColor(t.item),size:"mini"}},[t._v("\n        "+t._s(t.computePriceText(t.item))+"\n      ")]),t._ssrNode(" "),t.item.idol.is_locked?o("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("\n        已停牌\n      ")]):o("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("\n        挂牌中\n      ")]),t._ssrNode(" "),o("el-tag",{attrs:{size:"mini",type:"info"}},[t._v("\n        占比:"+t._s(parseFloat(t.item.product_count/t.item.idol.star_count*100).toFixed(2))+"%\n      ")])],2)],2),t._ssrNode(' <div class="footer"><span>'+t._ssrEscape("发起时间："+t._s(t.item.created_at.split(" ")[0]))+"</span> "+(t.isMine?'<button class="delete">\n      终止交易\n    </button>':'<button class="create">\n      马上交易\n    </button>')+"</div>")],2)},[],!1,function(t){var e=o(301);e.__inject__&&e.__inject__(t)},null,"204e0b4e");e.a=component.exports},388:function(t,e,o){"use strict";o.r(e);var r=o(302),n=o.n(r);for(var l in r)"default"!==l&&function(t){o.d(e,t,function(){return r[t]})}(l);e.default=n.a},451:function(t,e,o){"use strict";o.r(e);o(92),o(2);var r=o(50),n=o.n(r),l=o(179),d=o(347),c=o(198),_={name:"RoleTrendingHall",components:{FlowList:l.a,DealIdolItem:d.a,"el-input-number":n.a},data:()=>({deal:null,loading:!1,showDealDrawer:!1,submitting:!1,buyCount:.01,minBuyCount:0}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},pocket(){return this.$store.state.login?+this.$store.state.user.pocket:0},maxBuyCount(){if(!this.deal)return 0;const t=parseFloat(this.pocket/this.deal.product_price).toFixed(2);return t-this.deal.last_count<0?t:this.deal.last_count},payAmount(){return this.deal&&this.buyCount?parseFloat(this.buyCount*this.deal.product_price).toFixed(2):0}},async asyncData({store:t}){await t.dispatch("flow/initData",{func:"getVirtualIdolDealList",type:"seenIds",sort:"active"})},head:{title:"交易所"},methods:{async refresh(){this.loading||(await this.$store.dispatch("flow/initData",{func:"getVirtualIdolDealList",type:"seenIds",sort:"active",refresh:!0}),this.loading=!1)},openDealDrawer(t){if(!this.currentUserId)return void this.$channel.$emit("sign-in");let e=parseFloat(.01/t.product_price).toFixed(2);const o=t.product_price.toString().split(".")[1];o&&(1===o.length?e=Math.max(e,.1):2===o.length&&(e=Math.max(e,1))),this.minBuyCount=parseFloat(e).toFixed(2),this.deal=t,this.showDealDrawer=!0},async makeDeal(){if(this.payAmount){if(this.pocket<this.payAmount)this.$toast.error("没有足够的虚拟币");else if(!this.submitting){this.submitting=!0,this.$toast.loading("交易中");try{await Object(c.n)(this,{deal_id:this.deal.id,buy_count:this.buyCount,pay_price:this.payAmount}),this.$toast.success("交易成功"),this.refresh()}finally{this.submitting=!1}}}else this.$toast.error("未选择份额")},deleteDeal(t){this.$confirm("确定要终止交易吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Object(c.f)(this,{id:t.id}),this.$toast.success("交易已终止"),this.refresh()}).catch()}}},h=o(1);var component=Object(h.a)(_,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"role-trending-hall"}},[o("FlowList",{attrs:{func:"getVirtualIdolDealList",type:"seenIds",sort:"active"},scopedSlots:t._u([{key:"header",fn:function(e){var source=e.source;return o("div",{staticClass:"role-trending-header"},[o("span",[t._v("总共 "+t._s(source.total)+" 笔交易")]),t._v(" "),o("span",{on:{click:t.refresh}},[o("i",{staticClass:"el-icon-refresh"}),t._v(" 刷新")])])}},{key:"default",fn:function(e){var r=e.flow;return o("ul",{},t._l(r,function(e){return o("DealIdolItem",{key:e.id,attrs:{item:e},on:{create:t.openDealDrawer,delete:t.deleteDeal}})}),1)}}])}),t._ssrNode(" "),o("v-drawer",{attrs:{"header-text":"股份交易","submit-text":"成交",size:"70%",from:"bottom"},on:{submit:t.makeDeal},model:{value:t.showDealDrawer,callback:function(e){t.showDealDrawer=e},expression:"showDealDrawer"}},[t.deal?o("div",{staticClass:"make-idol-deal-form container"},[o("p",{staticClass:"intro"},[t._v("\n        交易信息：\n      ")]),t._v(" "),o("p",[o("strong",[t._v("交易玩家：")]),t._v(t._s(t.deal.user.nickname))]),t._v(" "),o("p",[o("strong",[t._v("交易偶像：")]),t._v(t._s(t.deal.idol.name))]),t._v(" "),o("p",[o("strong",[t._v("每股价格：")]),t._v(t._s(t.deal.product_price))]),t._v(" "),o("p",{staticClass:"intro"},[t._v("\n        购买份额：\n      ")]),t._v(" "),o("el-input-number",{attrs:{step:.01,min:+t.minBuyCount,max:+t.maxBuyCount},model:{value:t.buyCount,callback:function(e){t.buyCount=e},expression:"buyCount"}}),t._v(" "),o("p",{staticClass:"intro"},[t._v("\n        支付金额：\n      ")]),t._v(" "),o("p",[t._v("最多可购买："+t._s(t.maxBuyCount)+"股")]),t._v(" "),o("p",[t._v("待支付金额：￥"+t._s(t.payAmount))])],1):t._e()])],2)},[],!1,function(t){var e=o(388);e.__inject__&&e.__inject__(t)},null,"d225e9a4");e.default=component.exports}};
//# sourceMappingURL=hall.chunk.028333c8.js.map