exports.ids=[32],exports.modules={171:function(t,e){},172:function(t,e,n){t.exports=n.p+"img/aa8b45a.png"},173:function(t,e,n){"use strict";var r=n(4),o={name:"FlowState",props:{auto:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},noMore:{type:Boolean,default:!1},nothing:{type:Boolean,default:!1},error:{type:Boolean,default:!1},fetch:{type:Function,required:!0},displayNoMore:{type:Boolean,default:!0}},mounted(){this.auto&&this.onScroll()},methods:{getTarget(){let t=this.$el;for(;"HTML"!==t.tagName&&"BOYD"!==t.tagName&&1===t.nodeType;){const e=window.getComputedStyle(t).overflowY;if("scroll"===e||"auto"===e)return t;t=t.parentNode}return document},onScroll(){if(this.error)return;r.a.checkInView(this.$el)&&this.fetch();const t=r.a.on(this.getTarget(),["scroll"],this.$utils.throttle(()=>{this.error||(!this.noMore&&this.auto?r.a.checkInView(this.$el)&&this.fetch():r.a.off(t))},200))}}},c=n(1);var component=Object(c.a)(o,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"flow-state-wrap"},[t.error?t._ssrNode("<div>","</div>",[t._t("error",[r("div",{staticClass:"state-error"},[r("span",[t._v("出错了，点击重试")])])])],2):t.nothing?t._ssrNode("<div>","</div>",[t._t("nothing",[r("div",{staticClass:"state-nothing"},[r("img",{attrs:{src:n(172),alt:"no-content"}}),t._v(" "),r("span",[t._v("这里什么都没有")])])])],2):t.noMore?t._ssrNode("<div>","</div>",[t._t("no-more",[t.displayNoMore?r("div",{staticClass:"state-no-more"},[r("span",[t._v("没有更多了")])]):t._e()])],2):t.loading?t._ssrNode("<div>","</div>",[t._t("loading",[r("div",{staticClass:"state-loading"},[r("i"),t._v(" "),r("span",[t._v("加载中…")])])])],2):t.auto?t._ssrNode('<div class="state-shim"></div>'):t._ssrNode("<button>","</button>",[t._t("load-btn",[r("div",{staticClass:"state-fetch-btn-text"},[r("span",[t._v("点击加载更多")])])])],2)])},[],!1,function(t){var e=n(175);e.__inject__&&e.__inject__(t)},null,"16540fb2");e.a=component.exports},174:function(t,e){},175:function(t,e,n){"use strict";n.r(e);var r=n(171),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},176:function(t,e){},178:function(t,e){},179:function(t,e,n){"use strict";var r={name:"UserAvatar",props:{user:{type:Object,required:!0},size:{type:Number,default:40}},methods:{toUser(){this.$router.push(this.$alias.user(this.user.zone))}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"user-avatar",style:{width:t.$px2vw(t.size),height:t.$px2vw(t.size)},on:{click:function(e){return e.stopPropagation(),t.toUser(e)}}},[t._ssrNode("<img"+t._ssrAttr("src",t.$resize(t.user.avatar,{width:2*t.size}))+">")])},[],!1,function(t){var e=n(181);e.__inject__&&e.__inject__(t)},null,"16ffe9a8");e.a=component.exports},181:function(t,e,n){"use strict";n.r(e);var r=n(174),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},183:function(t,e){t.exports={tag:"tag-14",rolling:"rolling-aq"}},184:function(t,e){},185:function(t,e){},186:function(t,e){},187:function(t,e){t.exports={item:"item-1M","in-detail":"in-detail-3X",inDetail:"in-detail-3X",avatar:"avatar-1i",main:"main-1x",header:"header-1Z",nickname:"nickname-JF","to-user":"to-user-2r",toUser:"to-user-2r",content:"content-1g",rolling:"rolling-1u"}},188:function(t,e){},189:function(t,e){},190:function(t,e){},191:function(t,e){},192:function(t,e,n){"use strict";var r={name:"UserNickname",props:{user:{type:Object,required:!0},isMaster:{type:Boolean,default:!1}},methods:{toUser(){this.$router.push(this.$alias.user(this.user.zone))}}},o=n(1);var component=Object(o.a)(r,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"user-nickname"},[this._ssrNode('<div class="nickname"><p class="oneline">'+this._ssrEscape(this._s(this.user.nickname))+"</p></div> "+(this.isMaster?'<span class="badge master-badge"><span>楼主</span></span>':"\x3c!----\x3e"))])},[],!1,function(t){var e=n(195);e.__inject__&&e.__inject__(t)},null,"0ad68c7d");e.a=component.exports},193:function(t,e,n){"use strict";n.d(e,"i",function(){return r}),n.d(e,"r",function(){return o}),n.d(e,"h",function(){return c}),n.d(e,"c",function(){return l}),n.d(e,"o",function(){return m}),n.d(e,"f",function(){return d}),n.d(e,"m",function(){return h}),n.d(e,"e",function(){return _}),n.d(e,"p",function(){return f}),n.d(e,"a",function(){return v}),n.d(e,"n",function(){return y}),n.d(e,"j",function(){return $}),n.d(e,"d",function(){return C}),n.d(e,"b",function(){return x}),n.d(e,"g",function(){return w}),n.d(e,"q",function(){return k}),n.d(e,"l",function(){return I}),n.d(e,"k",function(){return N});const r=(t,{id:e})=>t.$axios.$get(`cartoon_role/${e}/stock_show`),o=(t,{id:e,amount:n})=>t.$axios.$post(`cartoon_role/${e}/buy_stock`,{amount:n}),c=(t,{id:e})=>t.$axios.$get(`cartoon_role/${e}/get_idol_deal`),l=(t,form)=>t.$axios.$post("cartoon_role/create_deal",form),m=(t,form)=>t.$axios.$post("cartoon_role/make_deal",form),d=(t,{id:e})=>t.$axios.$post("cartoon_role/delete_deal",{id:e}),h=t=>t.$axios.$get("cartoon_role/stock_meta"),_=(t,form)=>t.$axios.$post("cartoon_role/create_market_price_draft",form),f=(t,{is_agree:e,idol_id:n,draft_id:r})=>t.$axios.$post("cartoon_role/vote_market_price_draft",{is_agree:e,idol_id:n,draft_id:r}),v=(t,{idol_id:e,qq_group:n,lover_words:r,manager_id:o})=>t.$axios.$post("cartoon_role/change_idol_profile",{idol_id:e,qq_group:n,lover_words:r,manager_id:o}),y=t=>t.$axios.$get("cartoon_role/user_draft_work"),$=t=>t.$axios.$get("cartoon_role/can_use_income"),C=(t,{product_id:e,product_type:n,amount:r})=>t.$axios.$post("cartoon_role/create_buy_request",{product_id:e,product_type:n,amount:r}),x=(t,{order_id:e,result:n})=>t.$axios.$post("cartoon_role/check_product_request",{order_id:e,result:n}),w=(t,{order_id:e})=>t.$axios.$post("cartoon_role/delete_buy_request",{order_id:e}),k=(t,{order_id:e})=>t.$axios.$post("cartoon_role/over_buy_request",{order_id:e}),I=t=>t.$axios.$get("cartoon_role/get_mine_product_orders"),N=(t,{idol_id:e,days:n})=>t.$axios.$get("cartoon_role/get_idol_days_chart",{params:{idol_id:e,days:n}})},194:function(t,e,n){"use strict";e.a=((t,e,n,r)=>{let o=0;const element=n?[n]:[document.getElementsByTagName("html")[0],document.body],c=n?n.scrollTop:window.scrollY,l=t||0,m=e||2e3,d=r||"easeOutSine",time=Math.max(.1,Math.min(Math.abs(c-l)/m,.8)),h={easeOutSine:t=>Math.sin(t*(Math.PI/2)),easeInOutSine:t=>-.5*(Math.cos(Math.PI*t)-1),easeInOutQuint:t=>(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)};element.forEach(t=>{t.requestAnimFrame||(t.requestAnimFrame=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}).bind(window))}),function t(){const p=(o+=1/60)/time,e=h[d](p);element.forEach(n=>{p<1?(n.requestAnimFrame(t),n.scrollTop=c+(l-c)*e):n.scrollTop=l})}()})},195:function(t,e,n){"use strict";n.r(e);var r=n(176),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},196:function(t,e,n){t.exports=n.p+"img/1727dbb.png"},198:function(t,e,n){"use strict";n.r(e);var r=n(178),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},201:function(t,e){t.exports={"bangumi-panel":"bangumi-panel-b5",bangumiPanel:"bangumi-panel-b5",avatar:"avatar-2K",content:"content-2m",name:"name-5O",summary:"summary-3v",controls:"controls-1p",rolling:"rolling-nc"}},202:function(t,e){},203:function(t,e,n){"use strict";var r=n(179),o=n(192),c={name:"FlowHeaderUser",components:{UserAvatar:r.a,UserNickname:o.a},props:{user:{type:Object,required:!0},time:{type:String,required:!0}}},l=n(1);var component=Object(l.a)(c,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"user-panel"},[n("UserAvatar",{attrs:{user:t.user}}),t._ssrNode(" "),t._ssrNode('<div class="slot">',"</div>",[t._t("default")],2),t._ssrNode(" "),t._ssrNode('<div class="user-info">',"</div>",[n("UserNickname",{attrs:{user:t.user}}),t._ssrNode(" "),n("VTime",{model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],2)],2)},[],!1,function(t){var e=n(198);e.__inject__&&e.__inject__(t)},null,"7d79de9c");e.a=component.exports},206:function(t,e,n){"use strict";var r=n(194),o={name:"CommentCreateForm",props:{type:{required:!0,type:String},id:{required:!0,type:[Number,String]},masterId:{required:!0,type:Number}},data:()=>({content:""}),computed:{isGuest(){return!this.$store.state.login},submitting(){return this.$store.state.comment.submitting}},methods:{async submit(){if(this.isGuest)this.$channel.$emit("sign-in");else if(this.content){if(!this.submitting){this.$store.commit("comment/SET_SUBMITTING",{result:!0});try{const t=await this.$store.dispatch("comment/createMainComment",{content:this.content,images:[],type:this.type,id:this.id,ctx:this});this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp),this.$emit("submit"),this.content="",setTimeout(()=>{const e=document.getElementById(`comment-${t.data.id}`);e&&Object(r.a)(this.$utils.getOffsetTop(e)-100,600)},400)}finally{this.$store.commit("comment/SET_SUBMITTING",{result:!1})}}}else this.$emit("close")},handleAreaFocus(){document.body.scrollTop=0}}},c=n(1);var l=Object(c.a)(o,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"comment-create-form"},[this._ssrNode('<textarea placeholder="来吧，尽情的（在1000字以内）发挥吧" maxlength="1000" class="content"></textarea> '),e("el-button",{staticClass:"submit-btn",attrs:{loading:this.submitting,type:"primary"},on:{click:this.submit}},[this._v("\n    发布\n  ")])],2)},[],!1,function(t){var e=n(213);e.__inject__&&e.__inject__(t)},null,"8222d2d8").exports,m={name:"SubCommentItem",props:{comment:{required:!0,type:Object},parentUserId:{required:!0,type:Number},parentCommentId:{required:!0,type:Number},type:{required:!0,type:String}},data:()=>({deleting:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isMine(){return this.currentUserId===this.comment.from_user_id},showToUser(){return this.comment.to_user_id&&this.comment.to_user_id!==this.parentUserId},canDelete(){return this.isMine||this.currentUserId===this.parentUserId}},methods:{handleSubCommentClick(){if(this.isMine)return this.deleteComment(),void this.$nextTick(()=>{document.getElementById("reply-comment-textarea").style.display="none"});this.currentUserId&&this.$channel.$emit("reply-comment",{id:this.parentCommentId,targetUserId:this.comment.from_user_id,targetUserName:this.comment.from_user_name})},deleteComment(){this.canDelete&&(this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteSubComment",{ctx:this,type:this.type,id:this.comment.id,parentId:this.comment.parent_id})}).catch(()=>{this.deleting=!1})))}}};var d={name:"PostSubCommentList",components:{SubCommentItem:Object(c.a)(m,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.item},[n("nuxt-link",{class:t.$style.avatar,attrs:{to:t.$alias.user(t.comment.from_user_zone),tag:"div"}},[n("VImg",{attrs:{src:t.comment.from_user_avatar,width:22,height:22,avatar:!0}})],1),t._ssrNode(" "),t._ssrNode("<div"+t._ssrClass(null,t.$style.main)+">","</div>",[t._ssrNode("<div"+t._ssrClass("oneline",t.$style.header)+">","</div>",[t.showToUser?[n("nuxt-link",{class:t.$style.nickname,attrs:{to:t.$alias.user(t.comment.from_user_zone),tag:"span"}},[t._v("\n          "+t._s(t.comment.from_user_name)+":\n        ")]),t._ssrNode(" "),n("nuxt-link",{class:t.$style.toUser,attrs:{to:t.$alias.user(t.comment.to_user_zone),tag:"span"}},[t._v("\n          @"+t._s(t.comment.to_user_name)+"\n        ")])]:n("nuxt-link",{class:t.$style.nickname,attrs:{to:t.$alias.user(t.comment.from_user_zone),tag:"span"},domProps:{textContent:t._s(t.comment.from_user_name)}})],2),t._ssrNode(" <p"+t._ssrClass(null,t.$style.content)+">"+t._ssrEscape(t._s(t.comment.content))+"</p>")],2)],2)},[],!1,function(t){var e=n(215);e.__inject__&&e.__inject__(t);var r=n(216);r.__inject__&&r.__inject__(t),this.$style=r.locals||r},null,"40f00e8d").exports},props:{parentComment:{required:!0,type:Object},type:{required:!0,type:String}},computed:{comments(){return this.parentComment.comments},authorId(){return this.parentComment.from_user_id},hasComment(){return!!this.comments.list.length},filterComments(){const data=this.comments,t=data.list,e=t.slice(0,2);if(t.every(t=>t.id<=data.maxId))return e;const n=e.map(t=>t.id);return e.concat(t.filter(t=>t.id>data.maxId&&-1===n.indexOf(t.id)))}},methods:{loadAllComment(){this.$channel.$emit("load-all-sub-comment",{id:this.parentComment.id})}}};var h=Object(c.a)(d,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.hasComment?n("div",{staticClass:"sub-comment-list-wrap"},[t._ssrNode('<div class="sub-comment-list">',"</div>",[t._l(t.filterComments,function(e){return n("SubCommentItem",{key:e.id,attrs:{comment:e,"parent-user-id":t.authorId,"parent-comment-id":t.parentComment.id,type:t.type}})}),t._ssrNode(" "+(!t.comments.noMore||t.comments.list.length>2?'<button class="load-all-comment">'+t._ssrEscape("\n      全部"+t._s(t.comments.total)+"条回复\n    ")+"</button>":"\x3c!----\x3e"))],2)]):t._e()},[],!1,function(t){var e=n(217);e.__inject__&&e.__inject__(t)},null,"4af58698").exports,_=n(179),f=n(192),v={name:"CommentCommentItem",components:{SubCommentList:h,UserAvatar:_.a,UserNickname:f.a},props:{comment:{required:!0,type:Object},masterId:{required:!0,type:Number},type:{required:!0,type:String}},data:()=>({deleting:!1,liking:!1}),computed:{currentUserId(){return this.$store.state.login?this.$store.state.user.id:0},isMine(){return this.currentUserId===this.comment.from_user_id},canDelete(){return this.isMine||this.currentUserId===this.masterId},computeFromUser(){return{id:this.comment.from_user_id,avatar:this.comment.from_user_avatar,nickname:this.comment.from_user_name,zone:this.comment.from_user_zone}},imageCount(){return this.comment.images.length},filterImages(){return this.inDetail?this.comment.images:this.comment.images.slice(0,3)}},methods:{async toggleLike(){if(this.currentUserId){if(!this.liking){this.liking=!0;try{await this.$store.dispatch("comment/toggleLikeMainComment",{ctx:this,type:this.type,id:this.comment.id})}finally{this.liking=!1}}}else this.$channel.$emit("sign-in")},deleteComment(){this.deleting||(this.deleting=!0,this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.dispatch("comment/deleteMainComment",{ctx:this,type:this.type,id:this.comment.id}),this.$emit("delete")}).catch(()=>{this.deleting=!1}))},handleCommentBtnClick(){this.$channel.$emit("reply-comment",{id:this.comment.id,targetUserId:this.computeFromUser.id,targetUserName:this.computeFromUser.nickname})}}};var y={name:"VCommentMain",components:{CommentCreateForm:l,CommentItem:Object(c.a)(v,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"comment-item"},[t._ssrNode('<div class="avatar">',"</div>",[r("UserAvatar",{attrs:{size:35,user:t.computeFromUser}})],1),t._ssrNode(" "),t._ssrNode('<div class="content">',"</div>",[t._ssrNode('<div class="header">',"</div>",[t._ssrNode('<div class="right-btn">'+(t.canDelete?'<div class="tool-btn-wrap"><button><img'+t._ssrAttr("src",n(214))+"></button></div>":"\x3c!----\x3e")+"</div> "),r("UserNickname",{attrs:{user:t.computeFromUser,"is-master":t.comment.is_owner}})],2),t._ssrNode(" "),t._ssrNode('<div class="main">',"</div>",[t._ssrNode('<div class="text-area">'+t._s(t.comment.content)+"</div> "),t.imageCount?t._ssrNode('<div class="image-area">',"</div>",[1===t.imageCount?t._ssrNode("<div>","</div>",t._l(t.comment.images,function(t,e){return r("VImg",{key:e,staticClass:"image",attrs:{src:t.url,size:t.size,type:t.type,blur:!0,height:98,width:"auto"}})}),1):t._ssrNode("<div>","</div>",[t._ssrNode("<div>","</div>",t._l(t.filterImages,function(t,e){return r("VImg",{key:e,staticClass:"image",attrs:{src:t.url,size:t.size,type:t.type,blur:!0,width:"32%"}})}),1),t._ssrNode(" "+(t.imageCount>3?'<div class="mask"><span>'+t._ssrEscape("共"+t._s(t.imageCount)+"张图片")+"</span></div>":"\x3c!----\x3e"))],2)]):t._e()],2),t._ssrNode(" "),t._t("extra"),t._ssrNode(" "),t._ssrNode('<div class="footer">',"</div>",[t._ssrNode('<div class="info">',"</div>",[t._ssrNode("<span>"+t._ssrEscape(t._s(t.comment.floor_count)+"楼")+"</span> "),r("VTime",{model:{value:t.comment.created_at,callback:function(e){t.$set(t.comment,"created_at",e)},expression:"comment.created_at"}})],2),t._ssrNode(' <div class="social"><button'+t._ssrClass(null,{"is-active":t.comment.liked})+">"+(t.comment.like_count?"<span>"+t._ssrEscape(t._s(t.$utils.shortenNumber(t.comment.like_count)))+"</span>":"\x3c!----\x3e")+' <i class="iconfont icon-icon_good"></i></button></div>')],2),t._ssrNode(" "),r("SubCommentList",{attrs:{"parent-comment":t.comment,type:t.type}})],2)],2)},[],!1,function(t){var e=n(218);e.__inject__&&e.__inject__(t)},null,"6daa4147").exports,FlowState:n(173).a},props:{id:{required:!0,type:[Number,String]},type:{required:!0,type:String,validator:t=>~["post","video","image","score","question","answer","role"].indexOf(t)},onlySeeMaster:{type:Boolean,default:!1},masterId:{required:!0,type:Number},bottomAppendComment:{type:Boolean,default:!0},auto:{type:Boolean,default:!1},lazy:{type:Boolean,default:!0}},data:()=>({loadingMainComment:!1,focusCommentId:0,openFocusCommentDrawer:!1,loadingSubComment:!1,replyForm:{id:"",content:"",targetUserId:0,targetUserName:"",open:!1,replying:!1,liking:!1},openCreateCommentDrawer:!1,lastScroll:0,isScrollTop:!0}),computed:{store(){return this.$store.state.comment},list(){return this.store.list},noMore(){return this.store.noMore},total(){return this.store.total},focusComment(){return this.focusCommentId?this.list.filter(t=>t.id===this.focusCommentId)[0]:null},currentUserId(){return this.$store.state.login?this.$store.state.user.id:0}},mounted(){this.auto?this.$channel.$on(`fire-load-comment-${this.type}-${this.id}`,()=>{this.loadMoreMainComment(!0),this.$channel.$off(`fire-load-comment-${this.type}-${this.id}`)}):this.lazyLoadComment(),this.$channel.$on("load-all-sub-comment",({id:t})=>{this.focusCommentId=t,this.openFocusCommentDrawer=!0}),this.$channel.$on(`open-create-comment-drawer-${this.type}-${this.id}`,()=>{this.currentUserId?this.openCreateCommentDrawer=!0:this.$channel.$emit("sign-in")}),this.$channel.$on("reply-comment",({id:t,targetUserId:e,targetUserName:n})=>{this.handleSubCommentReply({id:t,targetUserId:e,targetUserName:n})}),window.addEventListener("scroll",this.$utils.throttle(()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;this.isScrollTop=this.lastScroll>t,this.lastScroll=t},200))},methods:{async lazyLoadComment(){if(!this.lazy)return void this.$nextTick(()=>{this.scrollToReply()});const{query:t}=this.$route;await this.$store.dispatch("comment/getMainComments",{id:this.id,type:this.type,seeReplyId:t["comment-id"],onlySeeMaster:t.only&&parseInt(t.only,10)?1:0}),this.$nextTick(()=>{this.scrollToReply()})},autoLoadMoreMainComment(){this.loadMoreMainComment(!1)},async loadMoreMainComment(t=!1){if(!this.loadingMainComment){this.loadingMainComment=!0;try{await this.$store.dispatch("comment/getMainComments",{ctx:this,type:this.type,id:this.id,onlySeeMaster:this.onlySeeMaster?1:0,firstRequest:t})}finally{this.loadingMainComment=!1}}},async loadMoreSubComment(){if(!this.loadingSubComment){this.loadingSubComment=!0;try{await this.$store.dispatch("comment/getSubComments",{ctx:this,type:this.type,id:this.focusCommentId})}finally{this.loadingSubComment=!1}}},commentToComment(data){this.handleSubCommentReply({id:data.parent_id,targetUserId:data.from_user_id,targetUserName:data.from_user_name})},handleCommentBtnClick(){this.handleSubCommentReply({id:this.focusComment.id,targetUserId:this.focusComment.from_user_id,targetUserName:this.focusComment.from_user_name})},handleSubCommentReply({id:t,targetUserId:e,targetUserName:n}){this.currentUserId?(this.replyForm.id=t,this.replyForm.targetUserId=e,this.replyForm.targetUserName=n,this.replyForm.open=!0,setTimeout(()=>{document.body.scrollTop=0},200)):this.$channel.$emit("sign-in")},async toggleFocusCommentLike(){if(this.currentUserId){if(!this.replyForm.liking){this.replyForm.liking=!0;try{await this.$store.dispatch("comment/toggleLikeMainComment",{ctx:this,type:this.type,id:this.focusCommentId})}finally{this.replyForm.liking=!1}}}else this.$channel.$emit("sign-in")},async handleReplySubmit(){if(this.currentUserId){if(this.replyForm.content&&!this.replyForm.replying){this.replyForm.replying=!0;try{const t=await this.$store.dispatch("comment/createSubComment",{ctx:this,id:this.replyForm.id,type:this.type,content:this.replyForm.content,targetUserId:this.replyForm.targetUserId});this.replyForm.open=!1,this.replyForm.content="",this.$toast.success(t.message),this.$store.commit("UPDATE_USER_EXP",t.exp)}finally{this.replyForm.replying=!1}}}else this.$channel.$emit("sign-in")},writeComment(){this.$channel.$emit(`open-create-comment-drawer-${this.type}-${this.id}`)},closeCommentDrawer(){this.openCreateCommentDrawer=!1},submitCommentCallback(){this.openCreateCommentDrawer=!1,this.$emit("create-main-comment")},deleteCommentCallback(){this.$emit("delete-main-comment")},scrollToReply(){const t=this.$route.query["comment-id"];if(!t)return;const e=document.getElementById(`comment-${t}`);e&&setTimeout(()=>{Object(r.a)(this.$utils.getOffsetTop(e)-100,600)},400)}}};var $=Object(c.a)(y,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"comment-wrap"}},[t._ssrNode('<h3 class="title">\n    评论 '+(t.total?"<span>"+t._ssrEscape(t._s(t.total))+"</span>":"\x3c!----\x3e")+"</h3> "),t.list.length?[t._ssrNode('<div id="comment-list-wrap">',"</div>",t._l(t.list,function(e){return t._ssrNode('<div class="comment-item-wrap">',"</div>",[t._t("comment-item",[r("CommentItem",{attrs:{type:t.type,comment:e,"master-id":t.masterId},on:{delete:t.deleteCommentCallback}})],{comment:e,reply:t.handleSubCommentReply})],2)}),0),t._ssrNode(" "),r("FlowState",{attrs:{"no-more":t.noMore,loading:t.loadingMainComment,auto:!0,fetch:t.autoLoadMoreMainComment}}),t._ssrNode(" <button"+t._ssrClass("comment-fixed-btn",{isScrollTop:t.isScrollTop})+'><i class="iconfont icon-talk"></i> <span>回复</span></button>')]:t._ssrNode('<div class="comment-nothing"><img'+t._ssrAttr("src",n(212))+"> <p>还没有人发言呢！</p> <button>\n      抢沙发\n    </button></div>"),t._ssrNode(" "),r("v-drawer",{staticClass:"focus-comment-drawer",attrs:{"header-text":"评论列表"+(t.focusComment&&t.focusComment.floor_count?" - "+t.focusComment.floor_count+" 楼":""),backdrop:!1,from:"bottom",size:"100%"},model:{value:t.openFocusCommentDrawer,callback:function(e){t.openFocusCommentDrawer=e},expression:"openFocusCommentDrawer"}},[t.focusComment?[r("div",{staticClass:"container"},[r("div",{staticClass:"reply"},[r("div",{staticClass:"user clearfix"},[r("nuxt-link",{staticClass:"avatar",attrs:{to:t.$alias.user(t.focusComment.from_user_zone)}},[r("v-img",{attrs:{src:t.focusComment.from_user_avatar,avatar:!0,width:"35"}})],1),t._v(" "),r("div",{staticClass:"summary"},[r("nuxt-link",{staticClass:"nickname",attrs:{to:t.$alias.user(t.focusComment.from_user_zone)},domProps:{textContent:t._s(t.focusComment.from_user_name)}}),t._v(" "),r("div",{staticClass:"info"},[r("v-time",{model:{value:t.focusComment.created_at,callback:function(e){t.$set(t.focusComment,"created_at",e)},expression:"focusComment.created_at"}})],1)],1)],1),t._v(" "),r("div",{staticClass:"content"},[r("div",{staticClass:"text-area",domProps:{innerHTML:t._s(t.focusComment.content)}}),t._v(" "),r("div",{staticClass:"image-area"},t._l(t.focusComment.images,function(img,t){return r("div",{key:t,staticClass:"image-package"},[r("v-img",{attrs:{src:img.url,width:img.width,height:img.height,full:!0}})],1)}),0)]),t._v(" "),r("div",{staticClass:"social"},[r("button",{class:[t.focusComment.liked?"reply-liked-btn":"reply-like-btn"],on:{click:t.toggleFocusCommentLike}},[r("i",{staticClass:"iconfont icon-icon_good"}),t._v(" "),r("span",[t._v(t._s(t.focusComment.liked?"已赞":"赞"))]),t._v(" "),t.focusComment.like_count?r("span",[t._v("("+t._s(t.focusComment.like_count)+")")]):t._e()]),t._v(" "),r("button",{staticClass:"reply-btn fr",on:{click:t.handleCommentBtnClick}},[t._v("\n              回复\n            ")])])]),t._v(" "),r("div",{staticClass:"hr"}),t._v(" "),r("p",{staticClass:"total"},[t._v("\n          "+t._s(t.focusComment.comments.total)+"条回复\n        ")]),t._v(" "),r("ul",{staticClass:"comments"},t._l(t.focusComment.comments.list,function(e){return r("li",{key:e.id},[r("div",{staticClass:"from-user"},[r("nuxt-link",{staticClass:"avatar",attrs:{to:t.$alias.user(e.from_user_zone)}},[r("v-img",{attrs:{src:e.from_user_avatar,avatar:!0,width:"35"}})],1),t._v(" "),r("div",{staticClass:"summary"},[r("div",{staticClass:"users oneline"},[r("nuxt-link",{staticClass:"nickname",attrs:{to:t.$alias.user(e.from_user_zone)},domProps:{textContent:t._s(e.from_user_name)}}),t._v(" "),e.to_user_zone?[t._v("\n                    回复\n                    "),r("nuxt-link",{staticClass:"nickname",attrs:{to:t.$alias.user(e.to_user_zone)},domProps:{textContent:t._s(e.to_user_name)}})]:t._e(),t._v("\n                  :\n                ")],2),t._v(" "),r("div",{staticClass:"info"},[r("v-time",{model:{value:e.created_at,callback:function(n){t.$set(e,"created_at",n)},expression:"item.created_at"}})],1)])],1),t._v(" "),r("div",{staticClass:"main"},[r("div",{staticClass:"content reply-btn",domProps:{textContent:t._s(e.content)},on:{click:function(n){return t.commentToComment(e)}}})])])}),0)]),t._v(" "),r("FlowState",{attrs:{"no-more":t.focusComment.comments.noMore,loading:t.loadingSubComment,fetch:t.loadMoreSubComment}})]:t._e()],2),t._ssrNode(" "),t._ssrNode('<div class="reply-comment-drawer-wrap">',"</div>",[r("v-drawer",{attrs:{"header-text":t.currentUserId===t.replyForm.targetUserId?"回复":"回复："+t.replyForm.targetUserName,backdrop:!1,from:"right",size:"100%","submit-text":"发送"},on:{submit:t.handleReplySubmit},model:{value:t.replyForm.open,callback:function(e){t.$set(t.replyForm,"open",e)},expression:"replyForm.open"}},[r("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.replyForm.content,expression:"replyForm.content",modifiers:{trim:!0}}],attrs:{placeholder:"100字以内任意发挥",maxlength:"100"},domProps:{value:t.replyForm.content},on:{input:function(e){e.target.composing||t.$set(t.replyForm,"content",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])],1),t._ssrNode(" "),r("v-drawer",{attrs:{from:"right",size:"100%","header-text":"发表评论"},model:{value:t.openCreateCommentDrawer,callback:function(e){t.openCreateCommentDrawer=e},expression:"openCreateCommentDrawer"}},[t.openCreateCommentDrawer?r("div",{staticClass:"container"},[t._t("reply-form",[t.openCreateCommentDrawer?r("CommentCreateForm",{attrs:{id:t.id,type:t.type,"master-id":t.masterId},on:{close:t.closeCommentDrawer,submit:t.submitCommentCallback}}):t._e()],{close:t.closeCommentDrawer})],2):t._e()])],2)},[],!1,function(t){var e=n(219);e.__inject__&&e.__inject__(t)},null,"26fa08ed");e.a=$.exports},208:function(t,e,n){"use strict";n.r(e);var r=n(183),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},209:function(t,e,n){"use strict";n.r(e);var r=n(184),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},212:function(t,e,n){t.exports=n.p+"img/e82d3e7.png"},213:function(t,e,n){"use strict";n.r(e);var r=n(185),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},214:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAxElEQVRYR+2UMQ7CMAxFbYmyw9E6ZGlnrgATAxO9AnO7ZOjRYKdIQdkQ8lL9Wkqkn9k/enr+skrhTwvnEwKiG6JBGkQNoHl2kAZRA2ieHaRB1ACar7ODMcb9suxuKckpG1CVR9N8riGEt2XEc940OE3zPSU5/8KoytB17cUC9Jw3AcdxforI4Q/m1fft0QL0nK8T0HNleQNr/jcNepY+A675v84zgx7XLfM0iNqkQRpEDaB5dpAGUQNonh2kQdQAmi++g1+Jsoopr5i4FgAAAABJRU5ErkJggg=="},215:function(t,e,n){"use strict";n.r(e);var r=n(186),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},216:function(t,e,n){"use strict";n.r(e);var r=n(187),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},217:function(t,e,n){"use strict";n.r(e);var r=n(188),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},218:function(t,e,n){"use strict";n.r(e);var r=n(189),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},219:function(t,e,n){"use strict";n.r(e);var r=n(190),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},221:function(t,e,n){"use strict";n.r(e);var r=n(191),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},222:function(t,e){},223:function(t,e,n){"use strict";var r={name:"BubbleTag",props:{icon:{type:String,default:""},text:{type:String,required:!0}}},o=n(1);var c={name:"FlowTags",components:{BubbleTag:Object(o.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("button",{class:t.$style.tag,on:{click:function(e){return t.$emit("click")}}},[t._t("icon"),t._ssrNode(" <span>"+t._ssrEscape(t._s(t.text))+"</span>")],2)},[],!1,function(t){var e=n(208);e.__inject__&&e.__inject__(t),this.$style=e.locals||e},null,"1c233d9a").exports},props:{bangumi:{type:Object,default:null},idol:{type:Object,default:null},tags:{type:Array,default:()=>[]}}};var l=Object(o.a)(c,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"flow-tags"},[t.bangumi?r("BubbleTag",{attrs:{text:t.bangumi.name}},[r("img",{attrs:{slot:"icon",src:n(196)},slot:"icon"})]):t._e(),t._ssrNode(" "),t.idol?r("BubbleTag",{attrs:{text:t.idol.name}},[r("img",{attrs:{slot:"icon",src:n(196)},slot:"icon"})]):t._l(t.tags,function(t){return r("BubbleTag",{key:t.id,attrs:{text:t.name}})})],2)},[],!1,function(t){var e=n(209);e.__inject__&&e.__inject__(t)},null,"7d582408");e.a=l.exports},224:function(t,e,n){"use strict";var r={props:{type:{required:!0,type:String,validator:t=>~["bangumi","user","question"].indexOf(t)},id:{required:!0,type:Number}},computed:{source(){return this.$store.getters["social/getState"](this.type,this.id)}},methods:{toggleFollow(){this.$store.state.login?this.$store.dispatch("social/toggleAction",{id:this.id,type:this.type,action:"follow"}):this.$channel.$emit("sign-in")}}},o=n(1);var component=Object(o.a)(r,function(){var t=this.$createElement;return(this._self._c||t)("button",{staticClass:"follow-button",on:{click:this.toggleFollow}},[this._ssrNode('<i class="iconfont icon-like"></i> <span>'+this._ssrEscape(this._s(this.source.follow?"已关注":"关注"))+"</span>")])},[],!1,function(t){var e=n(221);e.__inject__&&e.__inject__(t)},null,"bf8ea772");e.a=component.exports},230:function(t,e){t.exports={"image-preview":"image-preview-2_",imagePreview:"image-preview-2_",container:"container-34",bar:"bar-1j","top-bar":"top-bar-1d",topBar:"top-bar-1d","foot-bar":"foot-bar-AF",footBar:"foot-bar-AF",wrap:"wrap-tx",item:"item-32",close:"close-27",download:"download-51","next-btn":"next-btn-3T",nextBtn:"next-btn-3T","prev-btn":"prev-btn-12",prevBtn:"prev-btn-12",rolling:"rolling-3m"}},240:function(t,e,n){"use strict";e.a={data:()=>({uploadHeaders:{key:"",token:""},uploadConfig:{max:5},imageUploadAccept:["image/jpeg","image/png","image/jpg","image/gif"].toString(),imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://image.calibur.tv/",getUpTokenTimer:0,uploadPending:0,uploadImageTotal:0,uploadImageList:[]}),computed:{currentUser(){return this.$store.state.user}},watch:{currentUser:{handler:function(t){t&&t.uptoken&&(this.uploadHeaders.token=t.uptoken.upToken)},deep:!0,immediate:!0}},mounted(){this.getUpTokenTimer=setInterval(()=>{this.getUpToken()},18e5)},beforeDestroy(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{async getUpToken(){try{await this.$store.dispatch("getUpToken")}catch(t){}},handleImageUploadError(t,e){console.log(t),this.uploadPending--,this.uploadImageList.forEach((t,n)=>{t.uid===e.uid&&this.uploadImageList.splice(n,1)}),this.$toast.error(`图片：${e.name} 上传失败`)},beforeImageUpload(t){const e=~this.imageUploadAccept.split(",").indexOf(t.type),n=t.size/1024/1024<this.uploadConfig.max;if(!e)return this.$toast.error(`仅支持上传${this.imageUploadAccept.replace(/image\//g,"").replace(/,/g,"、")}格式的图片`),!1;if(!n)return this.$toast.error(`图片大小不能超过 ${this.uploadConfig.max}MB!`),!1;return this.uploadHeaders.key=(({userId:t,page:e,file:n})=>`admin/${t}${e}/${(new Date).getTime()}-${Math.random().toString(36).substring(3,6)}.${n.type.split("/").pop()}`)({userId:this.currentUser.id,page:this.$route.path,file:t}),!0},handleImageUploadRemove(t){this.uploadImageList.forEach((e,n)=>{e.uid===t.uid&&this.uploadImageList.splice(n,1)})},handleImageUploadSuccess(t,e){this.uploadImageList.forEach((n,r)=>{n.uid===e.uid&&(this.uploadImageList[r]=Object.assign(n,{data:t.data,status:"success",url:this.$resize(`${this.imagePrefix}${t.data.url}`,{width:100})}))}),this.uploadImageTotal++,this.uploadPending--},handleImageUploadBefore(t){if(!this.currentUser)return this.$channel.$emit("sign-in"),!1;const e=-1!==this.imageUploadAccept.split(",").indexOf(t.type),n=t.size/1024/1024<this.uploadConfig.max;return e?n?(this.uploadHeaders.key=this.$utils.createFileName({userId:this.$store.state.user.id,type:this.$route.path,file:t}),this.uploadImageList.push({name:t.name,percentage:0,raw:t,size:t.size,status:"uploading",uid:t.uid}),this.uploadPending++,!0):(this.$toast.error(`图片大小不能超过 ${this.uploadConfig.max}MB!`),!1):(this.$toast.error("仅支持jpg, jpeg, png, gif格式的图片"),!1)}}}},244:function(t,e,n){"use strict";n.r(e);var r=n(201),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},245:function(t,e,n){"use strict";n.r(e);var r=n(202),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},247:function(t,e,n){"use strict";var r={name:"ShareBtn",props:{shareData:{type:Object,required:!0}},data:()=>({showModal:!1,backdropId:0,display:!0}),computed:{login(){return this.$store.state.login},shareLink(){return this.shareData?this.shareData.link:`https://m.calibur.tv${this.route.path}`}},methods:{showIntroModal(){this.showModal=!0,this.backdropId=this.$backdrop.show({ele:this.$el,click:()=>{this.showModal=!1,this.$backdrop.hide(this.backdropId)}})},abort(){this.display=!1,this.$backdrop.hide(this.backdropId),this.$toast.success("好吧...orz")},handleCopyOK(){this.showModal=!1,this.$backdrop.hide(this.backdropId),this.$toast.success("复制成功~快去分享给其他人吧！")}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.login&&t.display?n("div",{staticClass:"fenxiao-btn-container"},[t.showModal?t._ssrNode('<div class="modal-content">',"</div>",[t._ssrNode('<div class="tips"><p>这是你的专属邀请码</p> <p>把它分享给其他人，只要有人注册，那么你将会获得5个团子</p> <p>通过你的邀请码注册的人，将会获得2个团子</p> <p>团子可以用来看视频，为偶像应援等</p> <p>或经过转化之后提现，1团子相当于1人民币</p> <p>更重要的是，calibur 的发展需要你的支持，感谢</p></div> '),n("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.shareLink,expression:"shareLink"}],staticClass:"join",on:{success:t.handleCopyOK}},[t._ssrNode("\n      获取分享链接\n    ")]),t._ssrNode(' <button class="abort">\n      但是，我拒绝\n    </button>')],2):t._e(),t._ssrNode(' <button class="fenxiao-btn">\n    分享\n  </button>')],2):t._e()},[],!1,function(t){var e=n(245);e.__inject__&&e.__inject__(t)},null,"1e594501");e.a=component.exports},248:function(t,e,n){"use strict";var r={name:"BangumiPanel",components:{FollowButton:n(224).a},props:{bangumi:{type:Object,required:!0}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.bangumiPanel},[n("nuxt-link",{class:t.$style.avatar,attrs:{to:t.$alias.bangumi(t.bangumi.id)}},[n("v-img",{attrs:{src:t.bangumi.avatar,width:"80",height:"92"}})],1),t._ssrNode(" "),t._ssrNode("<div"+t._ssrClass(null,t.$style.content)+">","</div>",[n("nuxt-link",{attrs:{to:t.$alias.bangumi(t.bangumi.id)}},[n("h5",{staticClass:"oneline",class:t.$style.name,domProps:{textContent:t._s(t.bangumi.name)}})]),t._ssrNode(" <p"+t._ssrClass(null,t.$style.summary)+">"+t._ssrEscape(t._s(t.bangumi.summary))+"</p> "),t._ssrNode("<div"+t._ssrClass(null,t.$style.controls)+">","</div>",[n("FollowButton",{attrs:{id:t.bangumi.id,type:"bangumi"}})],1)],2)],2)},[],!1,function(t){var e=n(244);e.__inject__&&e.__inject__(t),this.$style=e.locals||e},null,"adeff4b4");e.a=component.exports},253:function(t,e){},254:function(t,e){},255:function(t,e){},263:function(t,e,n){"use strict";n.r(e);var r=n(222),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},267:function(t,e,n){"use strict";var r={name:"SocialPanel",props:{isCreator:{required:!0,type:Boolean},isMine:{required:!0,type:Boolean},id:{required:!0,type:[Number,String]},type:{required:!0,type:String,validator:t=>~["post","video","image","score","answer","video"].indexOf(t)}},computed:{isGuest(){return!this.$store.state.login},source(){return this.$store.getters["social/getState"](this.type,this.id)},displayUsers(){return(this.isCreator?this.source.reward_users.list:this.source.like_users.list).slice(0,this.displayCount)}},methods:{computeTextByAction:t=>"reward"===t?"投食":"like"===t?"喜欢":"mark"===t?"收藏":"操作",toggleAction(t){if(this.isGuest)this.$channel.$emit("sign-in");else if(this.isMine)this.$toast.info(`不能${this.computeTextByAction(t)}自己的内容`);else if("reward"===t){if(this.source.reward)return void this.$toast.info("已投食过");this.$confirm("向TA投食需要消耗你一个团子，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.submitAction("reward")}).catch(()=>{})}else this.submitAction(t)},async submitAction(t){const data=await this.$store.dispatch("social/toggleAction",{type:this.type,id:this.id,action:t});data.success&&this.$emit(`${t}-callback`,{result:data.result})}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.source?n("div",{staticClass:"ours-panel"},[t._ssrNode('<div class="buttons">',"</div>",[t.isCreator?n("el-button",{class:{"is-plain":t.source.reward},attrs:{loading:t.source.reward_loading,type:"warning",icon:"iconfont icon-fantuan",round:"",size:"mini"},on:{click:function(e){return t.toggleAction("reward")}}},[t._v("\n      "+t._s(t.source.reward?"已投食":"投食")+t._s(t.source.reward_users.total?"  |  "+t.source.reward_users.total:"")+"\n    ")]):t._e(),t._ssrNode(" "),n("el-button",{class:{"is-plain":t.source.like},attrs:{loading:t.source.like_loading,type:"danger",icon:"iconfont icon-like",round:"",size:"mini"},on:{click:function(e){return t.toggleAction("like")}}},[t._v("\n      "+t._s(t.source.like?"已喜欢":"喜欢")+t._s(t.source.like_users.total?"  |  "+t.source.like_users.total:"")+"\n    ")]),t._ssrNode(" "),n("el-button",{class:{"is-plain":t.source.mark},attrs:{loading:t.source.mark_loading,type:"success",icon:"iconfont icon-mark",round:"",size:"mini"},on:{click:function(e){return t.toggleAction("mark")}}},[t._v("\n      "+t._s(t.source.mark?"已收藏":"收藏")+t._s(t.source.mark_users.total?"  |  "+t.source.mark_users.total:"")+"\n    ")])],2),t._ssrNode(' <div class="users"><ul>'+t._ssrList(t.displayUsers,function(e){return'<li class="user-face"><img'+t._ssrAttr("src",t.$resize(e.avatar,{width:60}))+"></li>"})+"</ul></div>")],2):t._e()},[],!1,function(t){var e=n(263);e.__inject__&&e.__inject__(t)},null,"379e1343");e.a=component.exports},271:function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"a",function(){return o}),n.d(e,"c",function(){return c});const r=(t,{id:e,only:n,hash:r,time:time})=>t.$axios.$get(`post/${e}/show`,{params:{only:n,hash:r,time:time}}),o=(t,{title:title,bangumiId:e,content:content,images:n,tags:r,desc:desc,geetest:o,is_creator:c})=>t.$axios.$post("post/create",{title:title,bangumiId:e,content:content,images:n,tags:r,desc:desc,geetest:o,is_creator:c}),c=t=>t.$axios.$get("post/tags")},274:function(t,e,n){"use strict";n.r(e);var r=n(230),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},283:function(t,e,n){"use strict";var r={name:"ImagePreview",props:{images:{type:Array,default:()=>[]},query:{type:String,default:""},download:{type:Boolean,default:!0}},data(){return{show:!1,currentIndex:-1,maxWidth:0,maxHeight:0,displayImages:this.images.map(t=>Object.assign({finalWidth:0,finalHeight:0,loading:!0},t))}},computed:{total(){return this.images.length},currentImage(){return-1===this.currentIndex?null:this.displayImages[this.currentIndex]},isWechat(){return this.$store.state.ua.wechat}},mounted(){this.getScreenSize(),window.addEventListener("resize",this.getScreenSize)},methods:{handleClose(){this.show=!1},handleClick(t){if(this.isWechat)return;if(!this.total)return;const e=t.target,n="img"===e.tagName.toLowerCase();if(!this.query&&!n)return;if(this.query&&-1===e.className.indexOf(this.query))return;let r="";if(n)r=e.getAttribute("src").split("?")[0];else{const img=e.querySelector("img");if(!img)return;r=img.getAttribute("src").split("?")[0]}this.getClickImageIndex(r),this.computeDisplaySize(this.currentIndex),this.show=!0},getClickImageIndex(t){this.images.forEach((image,e)=>{image.url===t&&(this.currentIndex=e)})},getScreenSize(){this.maxWidth=window.innerWidth,this.maxHeight=window.innerHeight-88},switchImage(t){if(t&&this.currentIndex===this.total-1)return;if(!t&&0===this.currentIndex)return;const e=t?this.currentIndex+1:this.currentIndex-1;this.computeDisplaySize(e),this.currentIndex=e},getSiblingsIndex(t){let e,n;return 0===this.currentIndex?(e=this.total-1,n=1):this.currentIndex===this.total-1?(e=this.total-2,n=0):(e=this.currentIndex-1,n=this.currentIndex+1),[e,t,n]},computeDisplaySize(t){if(void 0===this.images[t])return;const image=this.images[t];if(image.finalWidth&&image.finalHeight)return;const e=image.width,n=image.height,r=this.maxWidth,o=this.maxHeight;let c,l;if(r>=e&&o>=n)c=e,l=n;else if(r<e&&o<n){const t=e/o,m=n/o;t>=m?(c=r,l=parseInt(n/t,10)):(c=parseInt(e/m,10),l=o)}else if(n<o){c=r,l=parseInt(n/(e/o),10)}else{c=parseInt(e/(n/o),10),l=o}this.displayImages[t].finalWidth=c||r,this.displayImages[t].finalHeight=l||o},handleSwitch(t,e){this.currentIndex=e}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{class:t.$style.imagePreview,on:{click:t.handleClick}},[t._ssrNode((t.show?"<div"+t._ssrClass(null,t.$style.container)+"><div"+t._ssrClass(null,[t.$style.bar,t.$style.topBar])+">"+(t.total?"<span"+t._ssrClass(null,t.$style.total)+">"+t._ssrEscape("\n        "+t._s(t.currentIndex+1)+"/"+t._s(t.total)+"\n      ")+"</span>":"\x3c!----\x3e")+" <span"+t._ssrClass(null,t.$style.close)+"> × </span></div> <div"+t._ssrClass(null,[t.$style.bar,t.$style.footBar])+">"+(t.currentImage&&t.download?"<a"+t._ssrAttr("href",t.currentImage.url)+' target="_blank"'+t._ssrClass(null,t.$style.download)+">\n        下载原图\n      </a>":"\x3c!----\x3e")+"</div> "+(t.currentImage?"<div"+t._ssrClass(null,t.$style.wrap)+"><div"+t._ssrClass(null,t.$style.item)+t._ssrStyle(null,{backgroundImage:"url("+t.$resize(t.currentImage.url,{webP:!t.download})+")",width:""+t.$px2vw(t.currentImage.finalWidth),height:""+t.$px2vw(t.currentImage.finalHeight)},null)+"></div> "+(t.total>1?"<button"+t._ssrClass(null,t.$style.prevBtn)+'><i class="el-icon-caret-left"></i></button> <button'+t._ssrClass(null,t.$style.nextBtn)+'><i class="el-icon-caret-right"></i></button>':"\x3c!----\x3e")+"</div>":"\x3c!----\x3e")+"</div>":"\x3c!----\x3e")+" "),t._t("default")],2)},[],!1,function(t){var e=n(274);e.__inject__&&e.__inject__(t),this.$style=e.locals||e},null,"c07ef6ca");e.a=component.exports},284:function(t,e,n){"use strict";var r={name:"ImageUploader",mixins:[n(240).a],props:{listType:{type:String,default:"picture-card"},limit:{type:Number,default:1},loading:{type:Boolean,default:!1},required:{type:Boolean,default:!0}},mounted(){this.$channel.$on("image-upload-done",()=>{this.uploadImageList=[],this.uploadImageTotal=0,this.$refs.upload&&this.$refs.upload.clearFiles()}),this.getUpToken()},methods:{handleImageUploadExceed(){this.$toast.error(`最多可上传 ${this.limit} 张图片!`)},handleImageUploadEmit(){if(this.uploadPending)return void this.$toast.error("等待图片上传完成");if(this.required&&!this.uploadImageTotal)return void this.$toast.error("请先选择图片");const t=this.uploadImageList.filter(t=>t).map(t=>t.data);this.$emit("submit",1===this.limit?t[0]:t)}}},o=n(1);var component=Object(o.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-upload",{ref:"upload",attrs:{action:t.imageUploadAction,accept:t.imageUploadAccept,data:t.uploadHeaders,disabled:!0,multiple:t.limit>1,"before-upload":t.handleImageUploadBefore,"on-success":t.handleImageUploadSuccess,"on-error":t.handleImageUploadError,"on-remove":t.handleImageUploadRemove,"on-exceed":t.handleImageUploadExceed,"file-list":t.uploadImageList,"list-type":t.listType}},[t._v("\n    +\n  ")]),t._ssrNode(" "),n("el-button",{staticClass:"upload-btn",attrs:{loading:!!t.uploadPending||t.loading,type:"primary"},on:{click:t.handleImageUploadEmit}},[t._v("\n    "+t._s(t.uploadPending?"图片上传中...":"确认提交")+"\n  ")])],2)},[],!1,function(t){var e=n(297);e.__inject__&&e.__inject__(t)},null,"37120795");e.a=component.exports},297:function(t,e,n){"use strict";n.r(e);var r=n(253),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},307:function(t,e){},308:function(t,e,n){"use strict";n.r(e);var r=n(254),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},309:function(t,e,n){"use strict";n.r(e);var r=n(255),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},350:function(t,e){},351:function(t,e){},375:function(t,e,n){"use strict";var r=n(283),o=(n(86),n(2),n(43)),c=n.n(o),l=(n(307),n(154)),m=n.n(l),d=n(193),h={name:"BuyContentBtn",components:{"mt-spinner":m.a,"el-input-number":c.a},props:{id:{type:[String,Number],required:!0},title:{type:String,required:!0},author:{type:String,required:!0},type:{type:String,required:!0}},data:()=>({show:!1,idol:null,price:5,submitting:!1}),methods:{async showBuyModal(){this.show=!0,this.idol=await Object(d.j)(this)},async submitAction(){if(this.price<5)this.$toast.error("不支持5团子以下的采购");else if(this.price>this.idol.income)this.$toast.error("没有足够的资金");else if(!this.submitting&&this.idol){this.submitting=!0;try{await Object(d.d)(this,{product_id:this.id,product_type:this.type,amount:this.price}),this.show=!1,this.$toast.success("请求已发送，等待作者确认")}catch(t){this.$toast.error(t)}finally{this.submitting=!1}}}}},_=n(1);var f=Object(_.a)(h,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"buy-content-btn-wrap"},[t._ssrNode('<button class="buy-content-btn">\n    采购\n  </button> '),n("v-drawer",{attrs:{"header-text":"内容采购","submit-text":"确认",from:"bottom",size:"70%"},on:{submit:t.submitAction},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("div",{staticClass:"container"},[t.idol?[n("p",[t._v("\n          以「"+t._s(t.idol.name)+"」经纪人的身份，采购「"+t._s(t.author)+"」的文章《"+t._s(t.title)+"》\n        ")]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("当前可用资金：￥"+t._s(t.idol.income))]),t._v(" "),n("div",[n("br"),t._v(" "),n("p",[n("strong",[t._v("采购价格：")])]),t._v(" "),n("br"),t._v(" "),n("el-input-number",{attrs:{min:5,max:t.idol.income>35?35:t.idol.income},model:{value:t.price,callback:function(e){t.price=e},expression:"price"}})],1),t._v(" "),n("div",[n("br"),t._v(" "),n("p",[n("strong",[t._v("分成比例：")])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("\n            当前默认的分成比例是\n            5：5（该文章每收到一次投食，就有0.5个团子赠予偶像，0.5个团子归属作者）\n          ")])]),t._v(" "),n("div",[n("br"),t._v(" "),n("p",[n("strong",[t._v("提示：")])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("\n            确认采购后，等待作者确认，作者同意后才会扣费，并开始计算偶像的盈利\n          ")])]),t._v(" "),n("br")]:n("div",{staticStyle:{"text-align":"center"}},[n("br"),t._v(" "),n("br"),t._v(" "),n("mt-spinner",{attrs:{type:"triple-bounce"}})],1)],2)])],2)},[],!1,function(t){var e=n(308);e.__inject__&&e.__inject__(t)},null,"5c37effc").exports,v=n(203),y=n(223),$={name:"PostContent",components:{ImagePreview:r.a,BuyContentBtn:f,FlowHeaderUser:v.a,FlowTags:y.a},props:{post:{type:Object,required:!0},user:{type:Object,required:!0},bangumi:{type:Object,required:!0}}};var C=Object(_.a)($,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"post-content"}},[t._ssrNode('<div class="container">',"</div>",[t._ssrNode('<h1 class="title">'+(t.post.is_nice?'<div class="nice_badge">\n        精\n      </div>':"\x3c!----\x3e")+t._ssrEscape("\n      "+t._s(t.post.title)+"\n    ")+"</h1> "),n("FlowHeaderUser",{attrs:{user:t.user,time:t.post.created_at}},[!t.post.idol&&t.post.is_idol_manager&&t.post.is_creator?n("BuyContentBtn",{attrs:{id:t.post.id,title:t.post.title,author:t.user.nickname,type:"post"}}):t._e()],1),t._ssrNode(" "),t._ssrNode('<div class="content">',"</div>",[n("ImagePreview",{staticClass:"image-area",attrs:{images:t.post.images}},t._l(t.post.images,function(img,t){return n("div",{key:t,staticClass:"image-package"},[n("v-img",{attrs:{src:img.url,full:!0,width:img.width,height:img.height}})],1)}),0),t._ssrNode(' <div class="text-area">'+t._s(t.post.content)+"</div>")],2),t._ssrNode(" "),n("FlowTags",{attrs:{bangumi:t.bangumi,idol:t.post.idol,tags:t.post.tags}})],2)])},[],!1,function(t){var e=n(309);e.__inject__&&e.__inject__(t)},null,"13064e1a");e.a=C.exports},436:function(t,e,n){"use strict";n.r(e);var r=n(350),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},437:function(t,e,n){"use strict";n.r(e);var r=n(351),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},469:function(t,e,n){"use strict";n.r(e);var r=n(375),o=n(206),c=n(194),l={name:"PostCommentForm",components:{ImageUploader:n(284).a},props:{id:{required:!0,type:String}},data:()=>({forms:{content:""},exceed:5}),computed:{isGuest(){return!this.$store.state.login},submitting(){return this.$store.state.comment.submitting}},methods:{async submit(t){if(this.isGuest)this.$channel.$emit("sign-in");else if(this.forms.content){if(!this.submitting){this.$store.commit("comment/SET_SUBMITTING",{result:!0});try{const e=await this.$store.dispatch("comment/createMainComment",{content:this.forms.content,images:t,type:"post",id:this.id});this.$emit("close"),this.forms={content:""},this.$toast.success(e.message),this.$store.commit("UPDATE_USER_EXP",e.exp),setTimeout(()=>{const t=document.getElementById(`comment-${e.data.id}`);t&&Object(c.a)(this.$utils.getOffsetTop(t)-100,600)},400),this.$channel.$emit("image-upload-done")}finally{this.$store.commit("comment/SET_SUBMITTING",{result:!1})}}}else t.length?this.$emit("close"):this.$toast.error("内容不能为空")},handleRemove(t){this.images.forEach((e,n)=>{e.id===t.uid&&this.images.splice(n,1)})},handleSuccess(t,e){this.images.push({id:e.uid,img:t.data})},handleExceed(){this.$toast.error(`最多可上传 ${this.exceed} 张图片!`)},beforeUpload(t){if(!this.isGuest)return this.uploadConfig.max=5,this.uploadConfig.params={userId:this.$store.state.user.id,id:this.id,type:"post"},this.handleImageUploadBefore(t);this.$channel.$emit("sign-in")},handleAreaFocus(){document.body.scrollTop=0}}},m=n(1);var d=Object(m.a)(l,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"post-comment-form"},[this._ssrNode('<textarea placeholder="来吧，尽情的（在4000字以内）发挥吧" maxlength="4000" class="content"></textarea> '),e("ImageUploader",{attrs:{loading:this.submitting,limit:this.exceed,required:!1},on:{submit:this.submit}})],2)},[],!1,function(t){var e=n(436);e.__inject__&&e.__inject__(t)},null,"e30ec038").exports,h=n(267),_=n(248),f=n(247),v=n(271),y={name:"PostShow",components:{SocialPanel:h.a,CommentMain:o.a,BangumiPanel:_.a,PostCommentForm:d,ShareBtn:f.a,PostContent:r.a},props:{id:{type:String,required:!0}},data:()=>({post:null,bangumi:null,master:null,share_data:null}),computed:{onlySeeMaster(){return!!parseInt(this.$route.query.only,10)},isMaster(){return!!this.$store.state.login&&this.$store.state.user.id===this.master.id}},asyncData({query:t,store:e,params:n,app:r,error:o}){const{id:c}=n;return Object(v.b)(r,{id:c,only:t.only&&parseInt(t.only,10)?1:0}).then(data=>{const{post:t,bangumi:n}=data;return e.commit("social/SET_STATE",{type:"post",id:c,data:{like:t.liked,reward:t.rewarded,mark:t.marked,like_users:t.like_users,mark_users:t.mark_users,reward_users:t.reward_users}}),e.commit("social/SET_STATE",{type:"bangumi",id:n.id,data:{follow:n.followed}}),{post:t,bangumi:n,master:data.user,share_data:data.share_data}}).catch(t=>{o({statusCode:t.statusCode,message:t.message})})},async fetch({store:t,query:e,params:n}){try{await t.dispatch("comment/getMainComments",{id:n.id,type:"post",onlySeeMaster:e.only&&parseInt(e.only,10)?1:0,seeReplyId:e["comment-id"]})}catch(t){}},head(){return{title:this.post.title,script:[{hid:"share-data",innerHTML:JSON.stringify(this.share_data),type:"application/json"}]}}};var $=Object(m.a)(y,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"post-show"}},[n("PostContent",{attrs:{post:t.post,user:t.master,bangumi:t.bangumi}}),t._ssrNode(" "),t._ssrNode('<div class="content-footer">',"</div>",[n("SocialPanel",{attrs:{id:t.post.id,"is-creator":t.post.is_creator,"is-mine":t.isMaster,type:"post"}})],1),t._ssrNode(' <div class="hr"></div> '),t._ssrNode('<div class="container">',"</div>",[n("BangumiPanel",{attrs:{bangumi:t.bangumi}})],1),t._ssrNode(' <div class="hr"></div> '),t._ssrNode('<div class="container">',"</div>",[n("CommentMain",{attrs:{id:t.id,"only-see-master":t.onlySeeMaster,"bottom-append-comment":!1,lazy:!1,"master-id":t.master.id,type:"post"},scopedSlots:t._u([{key:"reply-form",fn:function(e){var r=e.close;return n("PostCommentForm",{attrs:{id:t.id},on:{close:r}})}}])},[n("div",{attrs:{slot:"header"},slot:"header"})])],1),t._ssrNode(" "),n("ShareBtn",{attrs:{"share-data":t.share_data}})],2)},[],!1,function(t){var e=n(437);e.__inject__&&e.__inject__(t)},null,"0557306f");e.default=$.exports}};
//# sourceMappingURL=_id.chunk.eba776df.js.map