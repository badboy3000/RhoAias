module.exports=function(t){var e={},n={0:0};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.e=function(e){if(0!==n[e]){var r=require("./"+({1:"pages/index"}[e]||e)+".chunk."+{1:"fc97758c"}[e]+".js"),o=r.modules,c=r.ids;for(var l in o)t[l]=o[l];for(var i=0;i<c.length;i++)n[c[i]]=0}return Promise.all([])},r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(object,t){return Object.prototype.hasOwnProperty.call(object,t)},r.p="https://file.calibur.tv/m/",r.oe=function(t){process.nextTick(function(){throw t})},r(r.s=74)}([function(t,e){t.exports=require("vue")},function(t,e,n){"use strict";function r(t,e,n,r,o,c,l,d){var h,m="function"==typeof t?t.options:t;if(e&&(m.render=e,m.staticRenderFns=n,m._compiled=!0),r&&(m.functional=!0),c&&(m._scopeId="data-v-"+c),l?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(l)},m._ssrRegister=h):o&&(h=d?function(){o.call(this,this.$root.$options.shadowRoot)}:o),h)if(m.functional){m._injectStyles=h;var f=m.render;m.render=function(t,e){return h.call(e),f(t,e)}}else{var _=m.beforeCreate;m.beforeCreate=_?[].concat(_,h):[h]}return{exports:t,options:m}}n.d(e,"a",function(){return r})},function(t,e){},function(t,e,n){"use strict";n.d(e,"c",function(){return r}),n.d(e,"j",function(){return o}),n.d(e,"g",function(){return c}),n.d(e,"e",function(){return l}),n.d(e,"f",function(){return d}),n.d(e,"a",function(){return h}),n.d(e,"b",function(){return m}),n.d(e,"d",function(){return f}),n.d(e,"h",function(){return _}),n.d(e,"i",function(){return v});const r=t=>t.$axios.$post("door/refresh"),o=(t,{phone_number:e,type:n,geetest:r})=>t.$axios.$post("door/message",{phone_number:e,type:n,geetest:r}),c=(t,{access:e,secret:n,nickname:r,authCode:o,inviteCode:c})=>t.$axios.$post("door/register",{access:e,secret:n,nickname:r,authCode:o,inviteCode:c}),l=(t,{access:e,secret:n,remember:r,geetest:o})=>t.$axios.$post("door/login",{access:e,secret:n,remember:r,geetest:o}),d=t=>t.$axios.$post("door/logout"),h=(t,{type:e,desc:desc,ua:n})=>t.$axios.$post("user/feedback",{type:e,desc:desc,ua:n}),m=(t,{zone:e})=>t.$axios.$get(`user/${e}/followed/bangumi`),f=(t,{id:e})=>t.$axios.$get("user/card",{params:{id:e}}),_=(t,{id:e,type:n,model:r,message:o})=>t.$axios.$post("report/send",{id:e,type:n,model:r,message:o}),v=(t,{method:e,access:n,authCode:r,secret:o})=>t.$axios.$post("door/reset",{method:e,access:n,authCode:r,secret:o})},function(t,e){t.exports=require("element-ui/lib/transitions/collapse-transition")},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){t.exports=require("element-ui/lib/upload")},function(t,e){t.exports=require("element-ui/lib/form-item")},function(t,e){t.exports=require("element-ui/lib/form")},function(t,e){t.exports=require("element-ui/lib/button")},function(t,e){t.exports=require("element-ui/lib/input")},function(t,e){},function(t,e){t.exports=require("vue-router")},function(t,e){t.exports=require("vuex")},function(t,e){t.exports=require("timeago.js")},function(t,e,n){t.exports=n.p+"img/b07f58f.jpeg"},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){t.exports=require("querystring")},function(t,e){t.exports=require("vue-meta")},function(t,e){t.exports=require("vue-no-ssr")},function(t,e){t.exports={baseUrl:{API_URL:{development:"https://api.calibur.tv/",staging:"http://localhost/",production:"http://localhost/"},API_URL_BROWSER:{development:"https://api.calibur.tv/",staging:"http://t-api.calibur.tv/",production:"https://api.calibur.tv/"}},SHARE_KEY:"the-world",AUTH_KEY:"Dark-Flame-Master",REDIS_URL:{development:"redis://localhost:6379",staging:"redis://localhost:6379",production:"redis://:Qq414927352@r-uf686e351aa9bff4.redis.rds.aliyuncs.com:6379"}}},function(t,e){t.exports=require("qs")},function(t,e){t.exports=require("lodash/orderBy")},function(t,e){t.exports=require("axios")},function(t,e){t.exports=require("js-cookie")},function(t,e){t.exports=require("element-ui/lib/col")},function(t,e){t.exports=require("element-ui/lib/row")},function(t,e){t.exports=require("element-ui/lib/alert")},function(t,e){t.exports=require("element-ui/lib/tooltip")},function(t,e){t.exports=require("element-ui/lib/popover")},function(t,e){t.exports=require("element-ui/lib/button-group")},function(t,e){t.exports=require("element-ui/lib/option-group")},function(t,e){t.exports=require("element-ui/lib/option")},function(t,e){t.exports=require("element-ui/lib/select")},function(t,e){t.exports=require("element-ui/lib/switch")},function(t,e){t.exports=require("element-ui/lib/radio-button")},function(t,e){t.exports=require("element-ui/lib/radio-group")},function(t,e){t.exports=require("element-ui/lib/radio")},function(t,e){t.exports=require("element-ui/lib/input-number")},function(t,e){t.exports=require("element-ui/lib/dropdown-item")},function(t,e){t.exports=require("element-ui/lib/dropdown-menu")},function(t,e){t.exports=require("element-ui/lib/dropdown")},function(t,e){t.exports=require("element-ui/lib/tab-pane")},function(t,e){t.exports=require("element-ui/lib/tabs")},function(t,e){t.exports=require("element-ui/lib/rate")},function(t,e){t.exports=require("blueimp-md5")},function(t,e){t.exports=require("vue-clipboards")},function(t,e){t.exports=require("vue-image-lazier")},function(t,e,n){t.exports=n(128)},function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=75},function(t,e,n){t.exports=n.p+"img/d465ab1.jpeg"},function(t,e,n){t.exports=n.p+"img/adea640.jpeg"},function(t,e,n){"use strict";n.r(e);var r=n(5),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(6),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(7),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(8),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(9),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(10),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(11),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e){},function(t,e){},function(t,e,n){"use strict";n.r(e);var r=n(12),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(13),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(14),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(15),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(16),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(17),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(18),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(19),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(20),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(21),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(22),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(23),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(24),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(25),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){"use strict";n.r(e);var r=n(26),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e,n){var map={"./bangumi.js":133,"./comment.js":132,"./editor.js":103,"./flow.js":131,"./index.js":129,"./search.js":130,"./social.js":134};function r(t){var e=o(t);return n(e)}function o(t){if(!n.o(map,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return map[t]}r.keys=function(){return Object.keys(map)},r.resolve=o,t.exports=r,r.id=102},function(t,e,n){"use strict";n.r(e),n.d(e,"state",function(){return o}),n.d(e,"mutations",function(){return c}),n.d(e,"actions",function(){return l}),n.d(e,"getters",function(){return d});const r={title:{type:"title",text:""},img:{type:"img",url:"",width:0,height:0,mime:"",text:""},txt:{type:"txt",text:""},list:{type:"list",text:"",sort:""},use:{type:"use",text:""}},o=()=>({resource:null,selectedIndex:0,sections:[Object.assign({},r.title,{id:0}),Object.assign({},r.img,{id:1}),Object.assign({},r.txt,{id:2}),Object.assign({},r.list,{id:3}),Object.assign({},r.use,{id:4})]}),c={SWITCH_SECTION(t,{index:e}){t.selectedIndex=e},APPEND_SECTION(t,{type:e,index:n}){const o=r[e],template={id:`${t.sections.length}-${Date.now()}`};Object.keys(o).forEach(t=>{template[t]=o[t]});const c=n+1;t.sections.splice(c,0,template),t.selectedIndex=c},UPDATE_SECTION_TEXT(t,{value:e}){t.sections[t.selectedIndex].text=e},UPDATE_SECTION_SORT(t,{value:e}){t.sections[t.selectedIndex].sort=e},UPDATE_SECTION_IMAGE(t,{url:e,width:n,height:r,size:o,mime:c}){t.sections[t.selectedIndex].url=e,t.sections[t.selectedIndex].width=n,t.sections[t.selectedIndex].height=r,t.sections[t.selectedIndex].mime=c,t.sections[t.selectedIndex].size=o},DELETE_SECTION(t,{index:e}){t.sections.splice(e,1),t.selectedIndex=0},SORT_SECTION(t,{index:e}){t.sections.splice(e-1,1,...t.sections.splice(e,1,t.sections[e-1]))},INIT_SECTION(t,data){const e=[];data.content.forEach((section,t)=>{section.id=`${t}-${Date.now()}`,e.push(section)}),t.sections=e,t.resource=data}},l={async getData({commit:t},{api:e,id:n}){const data=await e.edit({id:n});data&&t("INIT_SECTION",data)}},d={}},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,n){"use strict";n.r(e);var r=n(27),o=n.n(r);for(var c in r)"default"!==c&&function(t){n.d(e,t,function(){return r[t]})}(c);e.default=o.a},function(t,e){},function(t,e){},function(t,e){t.exports=require("debug")},function(t,e,n){"use strict";n.r(e);var r=n(43),o=n(0),c=n.n(o);const l=n(75),d=l.keys();function h(t){const e=l(t);return e.default||e}const m={};for(const t of d){m[t.replace(/^\.\//,"").replace(/\.(js|mjs|ts)$/,"")]=h(t)}var f=m;function _(t){return t.options&&t._Ctor===t?t:(t.options?(t._Ctor=t,t.extendOptions=t.options):(t=c.a.extend(t))._Ctor=t,!t.options.name&&t.options.__file&&(t.options.name=t.options.__file),t)}function v(t,e=!1){return Array.prototype.concat.apply([],t.matched.map((t,n)=>Object.keys(t.components).map(r=>(e&&e.push(n),t.components[r]))))}function y(t){return Promise.all(function(t,e){return Array.prototype.concat.apply([],t.matched.map((t,n)=>Object.keys(t.components).reduce((r,o)=>(t.components[o]?r.push(e(t.components[o],t.instances[o],t,o,n)):delete t.components[o],r),[])))}(t,async(t,e,n,r)=>("function"!=typeof t||t.options||(t=await t()),n.components[r]=_(t),n.components[r])))}async function x(t){return await y(t),{...t,meta:v(t).map((e,n)=>({...e.options.meta,...(t.matched[n]||{}).meta}))}}async function w(t,e){t.context||(t.context={isStatic:!1,isDev:!1,isHMR:!1,app:t,store:t.store,payload:e.payload,error:e.error,base:"/",env:{API_URL:"http://localhost/",API_URL_BROWSER:"https://api.calibur.tv/",SENTRY_URL:"https://63fb1028c6e24cb5be33e8ed64d798e8@sentry.io/1278322",RELEASE:"2019-5-2 04:09:19"}},e.req&&(t.context.req=e.req),e.res&&(t.context.res=e.res),t.context.redirect=((e,path,n)=>{if(!e)return;t.context._redirected=!0;let r=typeof path;"number"==typeof e||"undefined"!==r&&"object"!==r||(n=path||{},r=typeof(path=e),e=302),"object"===r&&(path=t.router.resolve(path).href),/(^[.]{1,2}\/)|(^\/(?!\/))/.test(path)?t.context.next({path:path,query:n,status:e}):(path=function(t,e){let n;const r=t.indexOf("://");-1!==r?(n=t.substring(0,r),t=t.substring(r+3)):t.startsWith("//")&&(t=t.substring(2));let o,c=t.split("/"),l=(n?n+"://":"//")+c.shift(),path=c.filter(Boolean).join("/");2===(c=path.split("#")).length&&(path=c[0],o=c[1]);l+=path?"/"+path:"",e&&"{}"!==JSON.stringify(e)&&(l+=(2===t.split("?").length?"&":"?")+function(t){return Object.keys(t).sort().map(e=>{const n=t[e];return null==n?"":Array.isArray(n)?n.slice().map(t=>[e,"=",t].join("")).join("&"):e+"="+n}).filter(Boolean).join("&")}(e));return l+=o?"#"+o:""}(path,n),t.context.next({path:path,status:e}))}),t.context.beforeNuxtRender=(t=>e.beforeRenderFns.push(t))),t.context.next=e.next,t.context._redirected=!1,t.context._errored=!1,t.context.isHMR=!!e.isHMR,e.route&&(t.context.route=await x(e.route)),t.context.params=t.context.route.params||{},t.context.query=t.context.route.query||{},e.from&&(t.context.from=await x(e.from))}function $(t,e){return!t.length||e._redirected||e._errored?Promise.resolve():E(t[0],e).then(()=>$(t.slice(1),e))}function E(t,e){let n;return(n=2===t.length?new Promise(n=>{t(e,function(t,data){t&&e.error(t),n(data=data||{})})}):t(e))&&(n instanceof Promise||"function"==typeof n.then)||(n=Promise.resolve(n)),n}function T(t,e){return function(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)"object"==typeof t[i]&&(e[i]=new RegExp("^(?:"+t[i].pattern+")$"));return function(n,r){let path="";const data=n||{},o=r||{},c=o.pretty?C:encodeURIComponent;for(let i=0;i<t.length;i++){const n=t[i];if("string"==typeof n){path+=n;continue}const r=data[n.name||"pathMatch"];let o;if(null==r){if(n.optional){n.partial&&(path+=n.prefix);continue}throw new TypeError('Expected "'+n.name+'" to be defined')}if(Array.isArray(r)){if(!n.repeat)throw new TypeError('Expected "'+n.name+'" to not repeat, but received `'+JSON.stringify(r)+"`");if(0===r.length){if(n.optional)continue;throw new TypeError('Expected "'+n.name+'" to not be empty')}for(let t=0;t<r.length;t++){if(o=c(r[t]),!e[i].test(o))throw new TypeError('Expected all "'+n.name+'" to match "'+n.pattern+'", but received `'+JSON.stringify(o)+"`");path+=(0===t?n.prefix:n.delimiter)+o}}else{if(o=n.asterisk?encodeURI(r).replace(/[?#]/g,t=>"%"+t.charCodeAt(0).toString(16).toUpperCase()):c(r),!e[i].test(o))throw new TypeError('Expected "'+n.name+'" to match "'+n.pattern+'", but received "'+o+'"');path+=n.prefix+o}}return path}}(function(t,e){const n=[];let r=0,o=0,path="";const c=e&&e.delimiter||"/";let l;for(;null!=(l=k.exec(t));){const e=l[0],d=l[1],h=l.index;if(path+=t.slice(o,h),o=h+e.length,d){path+=d[1];continue}const m=t[o],f=l[2],_=l[3],v=l[4],y=l[5],x=l[6],w=l[7];path&&(n.push(path),path="");const $=null!=f&&null!=m&&m!==f,E="+"===x||"*"===x,T="?"===x||"*"===x,k=l[2]||c,pattern=v||y;n.push({name:_||r++,prefix:f||"",delimiter:k,optional:T,repeat:E,partial:$,asterisk:!!w,pattern:pattern?I(pattern):w?".*":"[^"+S(k)+"]+?"})}o<t.length&&(path+=t.substr(o));path&&n.push(path);return n}(t,e))}const k=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function C(t){return encodeURI(t).replace(/[\/?#]/g,t=>"%"+t.charCodeAt(0).toString(16).toUpperCase())}function S(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function I(t){return t.replace(/([=!:$\/()])/g,"\\$1")}var O=n(44),N=n.n(O),j=n(34),A=n.n(j);const R=()=>(function(t){return t.then(t=>t.default||t)})(n.e(1).then(n.bind(null,135)));c.a.use(A.a);const U=function(t,e,n){if(n)return n;let r={x:0,y:0};return t.hash&&(r={selector:t.hash}),r};var D=n(45),P={...n.n(D).a,name:"NoSsr"},L={name:"NuxtChild",functional:!0,props:{nuxtChildKey:{type:String,default:""},keepAlive:Boolean,keepAliveProps:{type:Object,default:void 0}},render(t,{parent:e,data:data,props:n}){data.nuxtChild=!0;const r=e,o=e.$nuxt.nuxt.transitions,c=e.$nuxt.nuxt.defaultTransition;let l=0;for(;e;)e.$vnode&&e.$vnode.data.nuxtChild&&l++,e=e.$parent;data.nuxtChildDepth=l;const d=o[l]||c,h={};B.forEach(t=>{void 0!==d[t]&&(h[t]=d[t])});const m={};F.forEach(t=>{"function"==typeof d[t]&&(m[t]=d[t].bind(r))});const f=m.beforeEnter;m.beforeEnter=(t=>{if(window.$nuxt.$nextTick(()=>{window.$nuxt.$emit("triggerScroll")}),f)return f.call(r,t)});let _=[t("router-view",data)];return n.keepAlive&&(_=[t("keep-alive",{props:n.keepAliveProps},_)]),t("transition",{props:h,on:m},_)}};const B=["name","mode","appear","css","type","duration","enterClass","leaveClass","appearClass","enterActiveClass","enterActiveClass","leaveActiveClass","appearActiveClass","enterToClass","leaveToClass","appearToClass"],F=["beforeEnter","enter","afterEnter","enterCancelled","beforeLeave","leave","afterLeave","leaveCancelled","beforeAppear","appear","afterAppear","appearCancelled"];var z=n(3),G={name:"SignInForm",props:{inviteCode:{type:String,default:""}},data:()=>({form:{access:"",secret:"",remember:!0},rule:{access:[{validator:(t,e,n)=>e?11!==e.length?n(new Error("请填写11位手机号")):void n():n(new Error("请填写手机号")),trigger:"blur"}],secret:[{validator:(t,e,n)=>""===e?n(new Error("请填写登录密码")):e.length<6?n(new Error("密码不能小于6位")):e.length>16?n(new Error("密码不能大于16位")):void n(),trigger:"blur"}]},loading:!1,watchPwd:!1}),computed:{ua(){return this.$store.state.ua},qqRegisterLink(){let link="https://api.calibur.tv/callback/oauth2/qq?from=sign";return this.inviteCode&&(link=`${link}&invite=${this.inviteCode}`),link},wechatRegisterLink(){let link="https://api.calibur.tv/callback/oauth2/weixin?from=sign";return this.inviteCode&&(link=`${link}&invite=${this.inviteCode}`),link}},methods:{submitForm(){this.$refs.form.validate(t=>{if(!t)return!1;this.login()})},login(){this.loading||(this.loading=!0,this.$captcha({ctx:this,success:({data:data})=>{Object(z.e)(this,{access:this.form.access,secret:this.form.secret,remember:this.form.remember,geetest:data}).then(t=>{this.$cookie.set("JWT-TOKEN",t,{expires:365}),window.location.reload()}).catch(()=>{this.loading=!1})},close:()=>{this.loading=!1}}))},showReset(){this.$emit("to-reset"),this.$refs.form.resetFields()},showRegister(){this.$emit("to-register"),this.$refs.form.resetFields()},showOAuth(){this.$toast.info("暂未开放第三方登录")}}},K=n(1);var H=Object(K.a)(G,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sign-in-form"},[t._ssrNode("<img"+t._ssrAttr("src",t.$resize("https://image.calibur.tv/owner/logo/calibur-pink-new.png",{width:500,height:200}))+' alt="sign-logo" class="logo"> '),n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rule}},[n("el-form-item",{attrs:{prop:"access"}},[n("el-input",{attrs:{type:"text",placeholder:"手机（填写常用手机号，用于登录）"},model:{value:t.form.access,callback:function(e){t.$set(t.form,"access",e)},expression:"form.access"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"secret"}},[n("el-input",{attrs:{type:t.watchPwd?"text":"password",placeholder:"密码（6-16个字符组成，区分大小写）"},model:{value:t.form.secret,callback:function(e){t.$set(t.form,"secret",e)},expression:"form.secret"}}),t._v(" "),t.form.secret.length>5?n("button",{staticClass:"watch-pwd",attrs:{type:"button"},on:{click:function(e){t.watchPwd=!t.watchPwd}}},[n("i",{staticClass:"iconfont icon-yuedu"})]):t._e()],1),t._v(" "),n("div",{staticClass:"providers"},[n("a",{attrs:{href:t.qqRegisterLink}},[n("i",{staticClass:"iconfont icon-qq"})]),t._v(" "),n("not-ssr",[t.ua.wechat?n("a",{attrs:{href:t.wechatRegisterLink}},[n("i",{staticClass:"iconfont icon-wechat"})]):t._e()])],1),t._v(" "),n("el-form-item",[n("el-button",{staticClass:"submit-btn",attrs:{loading:t.loading,type:"primary"},on:{click:t.submitForm}},[t._v("\n        登录\n      ")])],1)],1),t._ssrNode(' <div class="others"><a class="fl">忘记密码?&gt;</a> <a class="fr">点击注册»</a></div>')],2)},[],!1,function(t){var e=n(78);e.__inject__&&e.__inject__(t)},null,"2609bd16").exports,V={name:"SignUpForm",props:{inviteCode:{type:String,default:""}},data(){return{watchPwd:!1,form:{access:"",secret:"",nickname:"",authCode:"",inviteCode:this.inviteCode},rule:{nickname:[{validator:(t,e,n)=>{if(""===e)return n(new Error("请先给自己起个名字"));const r=e.replace(/([\u4e00-\u9fa5])/g,"aa").trim().length;return r<2?n(new Error("昵称至少是2个字符")):r>14?n(new Error("昵称不能超过14个字符，1个汉字占2个字符")):/^([\u4e00-\u9fa5]|[a-z0-9])+$/i.test(e)?void n():n(new Error("昵称只能包含：中文、数字、字母"))},trigger:"blur"}],access:[{validator:(t,e,n)=>e?11!==e.length?n(new Error("请填写11位手机号")):/^(0|86|17951)?(1)[0-9]{10}$/.test(e)?void n():n(new Error("错误的手机号格式")):n(new Error("请填写手机号")),trigger:"blur"}],secret:[{validator:(t,e,n)=>""===e?n(new Error("请填写登录密码")):e.length<6?n(new Error("密码不能小于6位")):e.length>16?n(new Error("密码不能大于16位")):void n(),trigger:"blur"}]},step:0,timeout:0}},computed:{ua(){return this.$store.state.ua},qqRegisterLink(){let link="https://api.calibur.tv/callback/oauth2/qq?from=sign";return this.inviteCode&&(link=`${link}&invite=${this.inviteCode}`),link},wechatRegisterLink(){let link="https://api.calibur.tv/callback/oauth2/weixin?from=sign";return this.inviteCode&&(link=`${link}&invite=${this.inviteCode}`),link},submitBtnText(){return 0===this.step?"注册":1===this.step?"提交中...":2===this.step?"短信已发送":3===this.step?"注册中...":"注册"},submitBtnLoading(){return 1===this.step||3===this.step},submitBtnDisabled(){return 0!==this.timeout&&0===this.step||3===this.step}},methods:{submitForm(){this.$refs.form.validate(t=>{if(!t)return!1;0===this.step&&this.getRegisterAuthCode(),2===this.step&&this.openConfirmModal()})},getRegisterAuthCode(){this.step=1,this.$captcha({ctx:this,success:async({data:data})=>{try{await Object(z.j)(this,{type:"sign_up",phone_number:this.form.access,geetest:data}),this.step=2,this.openConfirmModal()}catch(t){this.step=0}finally{this.timeout=60;const t=setInterval(()=>{--this.timeout||(this.step=0,clearInterval(t))},1e3)}},close:()=>{this.step=0}})},openConfirmModal(){this.$prompt("请输入收到的验证码","短信已发送",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d{6}$/,inputErrorMessage:"验证码格式不正确"}).then(({value:t})=>{this.form.authCode=t,this.step=3,this.signUp()}).catch(()=>{})},signUp(){Object(z.g)(this,{access:this.form.access,secret:this.form.secret,nickname:this.form.nickname,authCode:this.form.authCode,inviteCode:this.form.inviteCode}).then(t=>{this.$toast.success("注册成功！"),this.$cookie.set("JWT-TOKEN",t),window.location="/about/hello"}).catch(()=>{this.step=0})},showOAuth(){this.$toast.info("暂未开放第三方注册")},showLogin(){this.$emit("to-login"),this.$refs.form.resetFields()}}};var J=Object(K.a)(V,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sign-up-form"},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rule,"status-icon":""}},[n("el-form-item",{attrs:{prop:"nickname"}},[n("el-input",{attrs:{type:"text",placeholder:"昵称（2-14个字符组成，1个汉字占2个字符）","auto-complete":"off"},model:{value:t.form.nickname,callback:function(e){t.$set(t.form,"nickname",e)},expression:"form.nickname"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"access"}},[n("el-input",{attrs:{type:"text",placeholder:"手机（填写常用手机号，用于登录）","auto-complete":"off"},model:{value:t.form.access,callback:function(e){t.$set(t.form,"access",e)},expression:"form.access"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"secret"}},[n("el-input",{attrs:{type:t.watchPwd?"text":"password",placeholder:"密码（6-16个字符组成，区分大小写）","auto-complete":"off"},model:{value:t.form.secret,callback:function(e){t.$set(t.form,"secret",e)},expression:"form.secret"}}),t._v(" "),t.form.secret.length>5?n("button",{staticClass:"watch-pwd",attrs:{type:"button"},on:{click:function(e){t.watchPwd=!t.watchPwd}}},[n("i",{staticClass:"iconfont icon-yuedu"})]):t._e()],1),t._v(" "),t.inviteCode?t._e():n("el-form-item",[n("el-input",{attrs:{type:"number",placeholder:"邀请码（可为空）","auto-complete":"off"},model:{value:t.form.inviteCode,callback:function(e){t.$set(t.form,"inviteCode",e)},expression:"form.inviteCode"}})],1),t._v(" "),n("el-form-item",[n("el-button",{staticClass:"submit-btn",attrs:{loading:t.submitBtnLoading,disabled:t.submitBtnDisabled,type:"primary"},on:{click:t.submitForm}},[t._v("\n        "+t._s(t.submitBtnText)+"\n        "),t.timeout?[t._v("\n          （"+t._s(t.timeout)+"s 后可重新获取）\n        ")]:t._e()],2)],1)],1),t._ssrNode(" "),t._ssrNode('<div class="others">',"</div>",[t._ssrNode('<span class="providers">',"</span>",[t._ssrNode("<a"+t._ssrAttr("href",t.qqRegisterLink)+'><i class="iconfont icon-qq"></i></a> '),n("not-ssr",[t.ua.wechat?n("a",{attrs:{href:t.wechatRegisterLink}},[n("i",{staticClass:"iconfont icon-wechat"})]):t._e()])],2),t._ssrNode(" "+(t.inviteCode?"\x3c!----\x3e":'<a class="fr">已有账号»</a>'))],2),t._ssrNode(' <div class="tip">\n    提示：由于注册时要根据初始昵称为每个用户分配独立域名，因此注册时的昵称不支持日文和特殊符号和标点符号，可在注册完成后在个人设置页面修改昵称\n  </div>')],2)},[],!1,function(t){var e=n(79);e.__inject__&&e.__inject__(t)},null,"7bf82ee8").exports,W={name:"ResetPasswordForm",data:()=>({form:{access:"",secret:"",authCode:""},rule:{access:[{validator:(t,e,n)=>e?11!==e.length?n(new Error("请填写11位手机号")):void n():n(new Error("请填写手机号")),trigger:"blur"}],secret:[{validator:(t,e,n)=>""===e?n(new Error("请填写登录密码")):e.length<6?n(new Error("密码不能小于6位")):e.length>16?n(new Error("密码不能大于16位")):void n(),trigger:"blur"}]},step:0,timeout:0}),computed:{submitBtnText(){return 0===this.step?"立即重置":1===this.step?"提交中...":2===this.step?"短信已发送":3===this.step?"已重置":"立即重置"},submitBtnLoading(){return 1===this.step||3===this.step},submitBtnDisabled(){return 0!==this.timeout&&0===this.step||3===this.step}},methods:{submitForm(){this.$refs.form.validate(t=>{if(!t)return!1;0===this.step&&this.getResetAuthCode(),2===this.step&&this.openConfirmModal()})},getResetAuthCode(){this.step=1,this.$captcha({ctx:this,success:async({data:data})=>{try{await Object(z.j)(this,{type:"forgot_password",phone_number:this.form.access,geetest:data}),this.step=2,this.openConfirmModal()}catch(t){this.step=0}finally{this.timeout=60;const t=setInterval(()=>{--this.timeout||(this.step=0,clearInterval(t))},1e3)}},close:()=>{this.step=0}})},openConfirmModal(){this.$prompt("请输入收到的验证码","短信已发送",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d{6}$/,inputErrorMessage:"验证码格式不正确"}).then(({value:t})=>{this.form.authCode=t,this.step=3,this.signReset()}).catch(()=>{})},async signReset(){try{const t=await Object(z.i)(this,{access:this.form.access,authCode:this.form.authCode,secret:this.form.secret});this.$toast.success(t),this.showLogin()}finally{this.step=0}},showLogin(){this.$emit("to-login"),this.$refs.form.resetFields()},showRegister(){this.$emit("to-register"),this.$refs.form.resetFields()}}};var Y=Object(K.a)(W,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"reset-password-form"},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rule}},[n("el-form-item",{attrs:{prop:"access"}},[n("el-input",{attrs:{type:"text",placeholder:"手机号","auto-complete":"off"},model:{value:t.form.access,callback:function(e){t.$set(t.form,"access",e)},expression:"form.access"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"secret"}},[n("el-input",{attrs:{type:"text",placeholder:"新密码","auto-complete":"off"},model:{value:t.form.secret,callback:function(e){t.$set(t.form,"secret",e)},expression:"form.secret"}})],1),t._v(" "),n("el-form-item",[n("el-button",{staticClass:"submit-btn",attrs:{loading:t.submitBtnLoading,disabled:t.submitBtnDisabled,type:"primary"},on:{click:t.submitForm}},[t._v("\n        "+t._s(t.submitBtnText)+"\n        "),t.timeout?[t._v("\n          （"+t._s(t.timeout)+"s 后可重新获取）\n        ")]:t._e()],2)],1)],1),t._ssrNode(' <div class="others"><a class="fl">返回登录&gt;</a> <a class="fr">点击注册»</a></div>')],2)},[],!1,function(t){var e=n(80);e.__inject__&&e.__inject__(t)},null,"e7cac0a4").exports,Q={name:"UserSex",props:{sex:{type:[String,Number],required:!0},secret:{type:Boolean,default:!1}},computed:{convertSex(){if("string"==typeof this.sex)return this.sex;let t="";switch(this.sex){case 0:t="未知";break;case 1:t="男";break;case 2:t="女";break;case 3:t="伪娘";break;case 4:t="药娘";break;case 5:t="扶她";break;default:t="未知"}return t}}},Z={name:"VUserDrawer",components:{UserSex:Object(K.a)(Q,function(){var t=this,e=t.$createElement;return(t._self._c||e)("span",{staticClass:"user-sex"},[t._ssrNode(t.secret?'<i class="iconfont icon-simi" style="color: limegreen"></i>':"未知"===t.convertSex?'<i class="iconfont icon-unknown" style="color: gold"></i>':"男"===t.convertSex?'<i class="iconfont icon-nan" style="color: deepskyblue"></i>':"女"===t.convertSex?'<i class="iconfont icon-nv" style="color: hotpink"></i>':"伪娘"===t.convertSex?'<i class="iconfont icon-tijianxingbiefenxi" style="color: mediumpurple"></i>':"药娘"===t.convertSex?'<i class="iconfont icon-xingbie" style="color: #ff4d51;"></i>':"扶她"===t.convertSex?'<i class="iconfont icon-intersex" style="color: silver"></i>':"\x3c!----\x3e")])},[],!1,null,null,"8309f5b2").exports},data:()=>({switchUserDrawer:!1}),computed:{user(){return this.$store.state.user},computeUserDrawerBg(){return!this.user||this.user.banner.split("/default/user-banner").length>1?{}:{backgroundImage:`url(${this.$resize(this.user.banner,{height:250,mode:2})})`}},coinCount(){return this.user.pocket}},mounted(){this.$channel.$on("open-user-drawer",()=>{this.switchUserDrawer=!0})},methods:{logout(){this.$cookie.remove("JWT-TOKEN"),Object(z.f)(this),window.location.href="/"}}};var X={name:"SignDrawer",components:{SignUpForm:J,SignInForm:H,ResetPasswordForm:Y,UserDrawer:Object(K.a)(Z,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.user?n("v-drawer",{staticClass:"user-drawer",attrs:{id:"user",from:"right",size:"70%"},model:{value:t.switchUserDrawer,callback:function(e){t.switchUserDrawer=e},expression:"switchUserDrawer"}},[n("div",{staticClass:"user-section"},[n("div",{staticClass:"bg",style:t.computeUserDrawerBg}),t._v(" "),n("div",{staticClass:"mask"}),t._v(" "),n("div",{staticClass:"user-info"},[n("nuxt-link",{staticClass:"avatar",attrs:{to:t.$alias.user(t.user.zone)}},[n("v-img",{attrs:{src:t.user.avatar,lazy:!1,avatar:!0,width:"50",height:"50"}})],1),t._v(" "),n("div",{staticClass:"panel"},[n("div",{staticClass:"nickname"},[n("nuxt-link",{staticClass:"oneline",attrs:{to:t.$alias.user(t.user.zone)},domProps:{textContent:t._s(t.user.nickname)}})],1),t._v(" "),n("div",[n("UserSex",{attrs:{sex:t.user.sex,secret:t.user.sexSecret}}),t._v("\n          · "),n("span",{staticClass:"level"},[t._v("Lv"+t._s(t.user.exp.level))])],1)])],1),t._v(" "),n("span",{staticClass:"badge"},[t._v("虚拟币："+t._s(t.coinCount))]),t._v("\n    ·\n    "),n("span",{staticClass:"badge"},[t._v("邀请码："+t._s(t.user.id))])]),t._v(" "),n("ul",{staticClass:"routes container",on:{click:function(e){t.switchUserDrawer=!1}}},[n("li",[n("nuxt-link",{attrs:{to:t.$alias.user(t.user.zone)}},[n("i",{staticClass:"iconfont icon-zhuye"}),t._v(" 个人主页\n      ")])],1),t._v(" "),n("li",[n("nuxt-link",{attrs:{to:"/my/setting"}},[n("i",{staticClass:"iconfont icon-shezhi"}),t._v(" 用户设置\n      ")])],1),t._v(" "),n("li",[n("nuxt-link",{attrs:{to:"/about/hello"}},[n("i",{staticClass:"iconfont icon-bangzhu"}),t._v(" 功能简介\n      ")])],1),t._v(" "),n("li",[n("nuxt-link",{attrs:{to:"/my/invite"}},[n("i",{staticClass:"iconfont icon-yaoqingma"}),t._v(" 我的邀请码\n      ")])],1),t._v(" "),n("li",[n("button",{on:{click:t.logout}},[n("i",{staticClass:"iconfont icon-tuichu"}),t._v(" 退出登录\n      ")])])])]):t._e()},[],!1,function(t){var e=n(81);e.__inject__&&e.__inject__(t)},null,"c373211c").exports},data:()=>({openDrawer:!1,showSignIn:!1,showSignUp:!1,showReset:!1}),computed:{isGuest(){return!this.$store.state.login},query(){return this.$route.query},paramsIsOK(){return!!(this.query.uid&&/^\d+$/.test(this.query.uid)&&this.query.time&&/^\d+$/.test(this.query.time)&&Date.now()<=1e3*this.query.time&&this.query.key===this.$md5(`${this.query.uid}-the-world-${this.query.time}`))}},mounted(){this.$channel.$on("sign-up",()=>{this.showRegister()}),this.$channel.$on("sign-in",(t=!0)=>{t&&this.$toast.error("请先登录"),this.showLogin()})},methods:{showLogin(){this.showReset=!1,this.showSignIn=!0,this.showSignUp=!1,this.openDrawer=!0},showRegister(){this.showSignUp=!0,this.showSignIn=!1,this.openDrawer=!0}}};var tt=Object(K.a)(X,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.isGuest?n("v-drawer",{staticClass:"sign-drawer",attrs:{"header-text":t.showSignUp?"注册":t.showReset?"找回密码":"登录",from:"bottom",size:"100%"},model:{value:t.openDrawer,callback:function(e){t.openDrawer=e},expression:"openDrawer"}},[n("div",{staticClass:"container"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.showSignIn,expression:"showSignIn"}]},[n("ResetPasswordForm",{directives:[{name:"show",rawName:"v-show",value:t.showReset,expression:"showReset"}],on:{"to-login":function(e){t.showReset=!1},"to-register":t.showRegister}}),t._v(" "),n("SignInForm",{directives:[{name:"show",rawName:"v-show",value:!t.showReset,expression:"!showReset"}],attrs:{"invite-code":t.paramsIsOK?t.query.uid:""},on:{"to-reset":function(e){t.showReset=!0},"to-register":t.showRegister}})],1),t._v(" "),n("SignUpForm",{directives:[{name:"show",rawName:"v-show",value:t.showSignUp,expression:"showSignUp"}],attrs:{"invite-code":t.paramsIsOK?t.query.uid:""},on:{"to-login":t.showLogin}})],1)]):[n("UserDrawer")]],2)},[],!1,function(t){var e=n(82);e.__inject__&&e.__inject__(t)},null,"59ee3a7e").exports,et={name:"nuxt-error",components:{SignDrawer:tt},props:{error:{type:Object,default:null}},head:{title:"出错了"},computed:{statusCode(){return"继续操作前请先登录"===this.message?401:"请在APP内打开该页面"===this.message?403:this.error&&this.error.statusCode||404},message(){return this.error&&this.error.message||"您要找的页面不存在"}},methods:{handleLogin(){this.$channel.$emit("sign-in")},toastMessage(){this.$toast.error(this.message)}}};var st=Object(K.a)(et,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"error-page"}},[t._ssrNode('<div class="error-main">',"</div>",[401===t.statusCode?t._ssrNode('<div id="error-401">',"</div>",[t._ssrNode("<img"+t._ssrAttr("src",n(76))+' alt="error-401"> <h3>请登录后重新访问</h3> <button class="back">\n        登录\n      </button>')],2):403===t.statusCode?t._ssrNode('<div id="error-403"><img'+t._ssrAttr("src",n(37))+' alt="error-403"> <h3>您没有权限访问该页面</h3> <a href="/" class="back">回到首页</a></div>'):404===t.statusCode?t._ssrNode('<div id="error-404">',"</div>",[t._ssrNode("<img"+t._ssrAttr("src",n(77))+' alt="error-404"> <h3>您要找的页面不存在</h3> <div class="subtitle">\n        不存在的，或者正在审核中。\n      </div> '),r("nuxt-link",{staticClass:"back",attrs:{to:"/"}},[t._v("\n        返回首页\n      ")])],2):500===t.statusCode?t._ssrNode('<div id="error-500">',"</div>",[t._ssrNode("<img"+t._ssrAttr("src",n(37))+' alt="error-500"> <h3>服务器出错了</h3> <div class="subtitle">\n        服务器出了点问题，工程师正在加紧抢修ヽ( ° ▽°)ノ\n      </div> '),r("nuxt-link",{staticClass:"back",attrs:{to:"/"}},[t._v("\n        返回首页\n      ")])],2):t._e()]),t._ssrNode(" "),r("SignDrawer")],2)},[],!1,function(t){var e=n(83);e.__inject__&&e.__inject__(t)},null,"4c7ced59").exports,nt={name:"Nuxt",components:{NuxtChild:L,NuxtError:st},props:{nuxtChildKey:{type:String,default:void 0},keepAlive:Boolean,keepAliveProps:{type:Object,default:void 0},name:{type:String,default:"default"}},computed:{routerViewKey(){if(void 0!==this.nuxtChildKey||this.$route.matched.length>1)return this.nuxtChildKey||T(this.$route.matched[0].path)(this.$route.params);const t=this.$route.matched[0]&&this.$route.matched[0].components.default;return t&&t.options&&t.options.key?"function"==typeof t.options.key?t.options.key(this.$route):t.options.key:this.$route.path}},beforeCreate(){c.a.util.defineReactive(this,"nuxt",this.$root.$options.nuxt)},render(t){return this.nuxt.err?t("NuxtError",{props:{error:this.nuxt.err}}):t("NuxtChild",{key:this.routerViewKey,props:this.$props})}},it={name:"NuxtLoading",data:()=>({percent:0,show:!1,canSucceed:!0,reversed:!1,skipTimerCount:0,rtl:!1,throttle:200,duration:5e3,continuous:!1}),computed:{left(){return!(!this.continuous&&!this.rtl)&&(this.rtl?this.reversed?"0px":"auto":this.reversed?"auto":"0px")}},beforeDestroy(){this.clear()},methods:{clear(){clearInterval(this._timer),clearTimeout(this._throttle),this._timer=null},start(){return this.clear(),this.percent=0,this.reversed=!1,this.skipTimerCount=0,this.canSucceed=!0,this.throttle?this._throttle=setTimeout(()=>this.startTimer(),this.throttle):this.startTimer(),this},set(t){return this.show=!0,this.canSucceed=!0,this.percent=Math.min(100,Math.max(0,Math.floor(t))),this},get(){return this.percent},increase(t){return this.percent=Math.min(100,Math.floor(this.percent+t)),this},decrease(t){return this.percent=Math.max(0,Math.floor(this.percent-t)),this},pause(){return clearInterval(this._timer),this},resume(){return this.startTimer(),this},finish(){return this.percent=this.reversed?0:100,this.hide(),this},hide(){return this.clear(),setTimeout(()=>{this.show=!1,this.$nextTick(()=>{this.percent=0,this.reversed=!1})},500),this},fail(){return this.canSucceed=!1,this},startTimer(){this.show||(this.show=!0),void 0===this._cut&&(this._cut=1e4/Math.floor(this.duration)),this._timer=setInterval(()=>{this.skipTimerCount>0?this.skipTimerCount--:(this.reversed?this.decrease(this._cut):this.increase(this._cut),this.continuous&&(this.percent>=100?(this.skipTimerCount=1,this.reversed=!this.reversed):this.percent<=0&&(this.skipTimerCount=1,this.reversed=!this.reversed)))},100)}},render(t){let e=t(!1);return this.show&&(e=t("div",{staticClass:"nuxt-progress",class:{"nuxt-progress-notransition":this.skipTimerCount>0,"nuxt-progress-failed":!this.canSucceed},style:{width:this.percent+"%",left:this.left}})),e}};var ot=Object(K.a)(it,void 0,void 0,!1,function(t){var e=n(84);e.__inject__&&e.__inject__(t)},null,"32ba1dc4").exports,at=(n(85),n(86),{name:"SearchInput",props:{value:{type:String,default:""},type:{type:String,default:"all"},showSuggestion:{type:Boolean,default:!0}},data(){return{word:this.value,selectedType:this.type,cacheKey:"search-history",typing:!1,filteredSelect:[],selectedIndex:-1}},computed:{bangumis(){return this.$store.state.bangumi.all},displaySuggestion(){return this.showSuggestion&&this.word.length&&this.typing&&this.filteredSelect.length}},mounted(){this.$watch("value",t=>{this.word=t,this.typing=!0,this.selectedIndex=-1,this.handleEnter(t)}),this.$watch("word",t=>{this.$emit("input",t)}),this.$watch("$route",t=>{"search"===t.name&&(this.word=t.query.q,this.selectedType=t.query.type,setTimeout(()=>{this.typing=!1},0))})},methods:{handleInputBlur(){this.$emit("input-blur"),document.body.scrollTop=0},handleInputFocus(){this.$emit("input-focus"),document.body.scrollTop=0},clear(){this.word=""},submit(){const q=-1!==this.selectedIndex?this.filteredSelect[this.selectedIndex].name:this.word;q&&(this.setHistory(q),this.$router.push({name:"search",query:{q:q,type:this.selectedType}}))},setHistory(q){setTimeout(()=>{const t=this.getHistory(),e=t.indexOf(q);-1!==e&&t.splice(e,1),t.unshift(q),t.length>10&&t.pop();try{localStorage.setItem(this.cacheKey,JSON.stringify(t))}catch(t){}},0)},getHistory(){try{return JSON.parse(localStorage.getItem(this.cacheKey))||[]}catch(t){return[]}},clickToSearch(t){this.selectedIndex=t,this.submit()},handleEnter(t){this.filteredSelect=t?this.bangumis.filter(option=>option.alias.indexOf(t)>-1||option.name.indexOf(t)>-1):[]}}});var ct={name:"VSearchHistory",data:()=>({cacheKey:"search-history",list:[],maxLen:10}),mounted(){this.list=this.get()},methods:{query(q){this.$router.push({name:"search",query:{q:q,type:"all"}})},set(q){setTimeout(()=>{const t=this.get(),e=t.indexOf(q);-1!==e&&t.splice(e,1),t.unshift(q),t.length>this.maxLen&&t.pop(),this.list=t;try{localStorage.setItem(this.cacheKey,JSON.stringify(t))}catch(t){}},0)},get(){try{return JSON.parse(localStorage.getItem(this.cacheKey))||[]}catch(t){return[]}},clear(){try{localStorage.removeItem(this.cacheKey)}catch(t){}this.list=[]}}};var ut={name:"VSearchDrawer",components:{vSearch:Object(K.a)(at,function(){var t=this,e=t.$createElement;return(t._self._c||e)("form",{staticClass:"search-input-wrap",attrs:{method:"get",action:"#"},on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[t._ssrNode('<button type="submit" class="search-btn"><i class="iconfont icon-sousuo"></i></button> <div class="input-wrap"><input maxlength="200" name="q" type="search" aria-autocomplete="both" aria-haspopup="false" autocapitalize="off" autocomplete="off" autocorrect="off" role="combobox" spellcheck="false" placeholder="搜索二次元的一切" aria-label="搜索"'+t._ssrAttr("value",t.word)+'></div> <ul class="search-suggestion"'+t._ssrStyle(null,null,{display:t.displaySuggestion?"":"none"})+">"+t._ssrList(t.filteredSelect,function(e,n){return"<li"+t._ssrClass(null,{active:n===t.selectedIndex})+"><img"+t._ssrAttr("src",t.$resize(e.avatar,{width:60}))+"> <span>"+t._ssrEscape(t._s(e.name))+"</span></li>"})+"</ul>")])},[],!1,function(t){var e=n(87);e.__inject__&&e.__inject__(t)},null,"f4d3a51a").exports,vSearchHistory:Object(K.a)(ct,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.list.length?n("div",{staticClass:"search-history"},[t._ssrNode('<p class="title">\n    搜索历史\n  </p> <ul>'+t._ssrList(t.list,function(e,n){return'<li><i class="iconfont icon-lishijilu"></i> <span>'+t._ssrEscape(t._s(e))+"</span></li>"})+'</ul> <button class="clear-btn">\n    清除历史记录\n  </button>')]):t._e()},[],!1,function(t){var e=n(88);e.__inject__&&e.__inject__(t)},null,"4224f606").exports},props:{value:{required:!0,type:Boolean}},data(){return{open:this.value,query:""}},mounted(){this.$watch("value",t=>{this.open=t}),this.$watch("open",t=>{this.$emit("input",t)})},methods:{}};var lt={name:"VHeader",components:{SearchDrawer:Object(K.a)(ut,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-drawer",{staticClass:"search-drawer",attrs:{from:"bottom",size:"100%","header-text":"搜索"},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[n("div",{staticClass:"container"},[n("v-search",{model:{value:t.query,callback:function(e){t.query=e},expression:"query"}}),t._v(" "),n("div",{staticClass:"hr"}),t._v(" "),n("v-search-history")],1)])},[],!1,function(t){var e=n(89);e.__inject__&&e.__inject__(t)},null,"04411b96").exports},data:()=>({openSearchDrawer:!1}),computed:{currentUser(){return this.$store.state.user},haveAuthToken(){return this.$store.state.haveAuthToken},path(){return this.$route.path},homePage(){return"/"===this.path},worldPage(){return/^\/world/.test(this.path)},bangumiPage(){return/^\/bangumi/.test(this.path)},rolePage(){return/^\/role\/trending/.test(this.path)},appPage(){return/^\/app/.test(this.path)},rewardPage(){return/^\/about\/reward/.test(this.path)},noBorderPage(){return this.homePage||this.appPage}},methods:{openSignDrawer(){this.$channel.$emit("sign-in",!1)},openUserDrawer(){this.$channel.$emit("open-user-drawer")}}};var pt=Object(K.a)(lt,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("header",{attrs:{id:"header"}},[t._ssrNode("<div"+t._ssrClass("header-text",{"border-header":!t.noBorderPage})+">","</div>",[t._ssrNode('<div class="nav-left">',"</div>",[n("router-link",{attrs:{to:"/"}},[n("img",{staticClass:"logo",attrs:{src:"https://image.calibur.tv/owner/logo/icon-1024.png-share120jpg",alt:"logo"}})]),t._ssrNode(" "),n("router-link",{staticClass:"link",class:{active:t.rolePage},attrs:{to:"/role/trending"}},[t._v("\n        股市\n      ")]),t._ssrNode(" "),n("router-link",{staticClass:"link",class:{active:t.worldPage},attrs:{to:"/world/post"}},[t._v("\n        社区\n      ")]),t._ssrNode(" "),n("router-link",{staticClass:"link",class:{active:t.bangumiPage},attrs:{to:"/bangumi/news"}},[t._v("\n        番剧\n      ")]),t._ssrNode(" "),n("router-link",{staticClass:"link",class:{active:t.appPage},attrs:{to:"/app/download"}},[t._v("\n        APP\n      ")]),t._ssrNode(" "),n("router-link",{staticClass:"link",class:{active:t.rewardPage},attrs:{to:"/about/reward"}},[t._v("\n        捐赠\n      ")])],2),t._ssrNode(" "),t._ssrNode('<div class="nav-right">',"</div>",[n("not-ssr",[t.haveAuthToken?[t.currentUser?n("div",{staticClass:"nav-avatar"},[n("button",{on:{click:t.openUserDrawer}},[n("img",{attrs:{src:t.$resize(t.currentUser.avatar,{width:48}),alt:""}})])]):n("img",{staticClass:"faker-user-avatar",attrs:{src:t.$resize("https://image.calibur.tv/default/user-avatar",{width:48})}})]:n("button",{staticClass:"sign-btn",on:{click:t.openSignDrawer}},[t._v("\n          登录\n        ")])],2),t._ssrNode(" "),t.homePage?t._e():[t._ssrNode('<button class="open-search-btn"><i class="iconfont icon-sousuo"></i></button> '),n("SearchDrawer",{model:{value:t.openSearchDrawer,callback:function(e){t.openSearchDrawer=e},expression:"openSearchDrawer"}})]],2)],2)])},[],!1,function(t){var e=n(90);e.__inject__&&e.__inject__(t)},null,"399833e3").exports,ht={name:"VRadio",props:{title:{type:String,default:""},align:{type:String,default:""},options:{type:Array,required:!0},value:{type:[String,Number],default:""}},data(){return{currentValue:this.value}},watch:{value(t){this.currentValue=t},currentValue(t){this.$emit("input",t)}}};var mt=Object(K.a)(ht,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"mint-radiolist",on:{change:function(e){return t.$emit("change",t.currentValue)}}},[t._ssrNode((t.title?'<label class="mint-radiolist-title">'+t._ssrEscape(t._s(t.title))+"</label>":"\x3c!----\x3e")+" "+t._ssrList(t.options,function(option,e){return'<div class="mint-radio-wrap"><label class="mint-radiolist-label"><span'+t._ssrClass("mint-radio",{"is-right":"right"===t.align})+"><input"+t._ssrAttr("disabled",option.disabled)+' type="radio"'+t._ssrAttr("value",option.value||option)+t._ssrAttr("checked",t._q(t.currentValue,option.value||option))+' class="mint-radio-input"> <span class="mint-radio-core"></span></span> <span class="mint-radio-label">'+t._ssrEscape(t._s(option.label||option))+"</span></label></div>"}))])},[],!1,function(t){var e=n(91);e.__inject__&&e.__inject__(t)},null,"16fdf5a7").exports,ft={name:"FeedbackDrawer",components:{VRadio:mt},data:()=>({show:!1,options:[{label:"功能建议",value:1},{label:"遇到错误",value:2},{label:"资源报错",value:4},{label:"求资源",value:5},{label:"求偶像",value:6},{label:"其它问题",value:3}],selectedType:1,placeholder:"",content:"",preContent:""}),mounted(){this.$channel.$on("open-feedback",({type:t,desc:desc,placeholder:e}={})=>{this.selectedType=t||1,this.preContent=desc||"{?}",this.placeholder=e||"非常感谢您的反馈，请填写详细信息方便我们解决",this.show=!0})},methods:{async submitFeedback(){this.content.length?(await Object(z.a)(this,{type:this.selectedType,desc:this.preContent.replace("{?}",this.content),ua:navigator.userAgent}),this.$toast.success("反馈成功，感谢您的反馈！"),this.content="",this.show=!1):this.$toast.error("请先填写反馈信息！")}}};var gt=Object(K.a)(ft,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-drawer",{staticClass:"feedback-drawer",attrs:{backdrop:!1,from:"bottom",size:"100%","header-text":"反馈"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("div",{staticClass:"container"},[n("div",{staticClass:"desc"},[n("p",[t._v("详细信息")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.content,expression:"content",modifiers:{trim:!0}}],attrs:{placeholder:t.placeholder},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),n("VRadio",{attrs:{options:t.options,title:"反馈类型"},model:{value:t.selectedType,callback:function(e){t.selectedType=e},expression:"selectedType"}}),t._v(" "),n("button",{staticClass:"btn-submit",on:{click:t.submitFeedback}},[t._v("\n      提交\n    ")])],1)])},[],!1,function(t){var e=n(92);e.__inject__&&e.__inject__(t)},null,"42eb93f3").exports,_t={name:"UserReportForm",components:{VRadio:mt},props:{id:{type:[Number,String],default:0},model:{type:[Number,String],default:0}},data:()=>({selectedType:-1,loading:!1,content:""}),computed:{options1:()=>[{label:"违法违规",value:1},{label:"色情低俗",value:2},{label:"赌博诈骗",value:3}],options2:()=>[{label:"人身攻击",value:4},{label:"侵犯隐私",value:5},{label:"内容抄袭",value:6}],options3:()=>[{label:"垃圾广告",value:7},{label:"恶意引战",value:8},{label:"重复内容/刷屏",value:9},{label:"内容不相关",value:10},{label:"互刷团子",value:11},{label:"其它",value:99}],needContent(){return 99===this.selectedType||6===this.selectedType}},methods:{async submit(){if(this.id&&this.model)if(this.selectedType<0)this.$toast.error("请选择正确的分类");else if(!this.needContent||this.content){if(!this.loading){this.loading=!0;try{await Object(z.h)(this,{id:this.id,message:this.content,type:99===this.selectedType?0:this.selectedType,model:this.model})}finally{this.loading=!1,this.$toast.success("感谢您的反馈！"),this.content="",this.selectedType=-1,this.$emit("success")}}}else this.$toast.error("请填写具体情况");else this.$toast.error("参数错误")}}};var vt={name:"ReportDrawer",components:{UserReportForm:Object(K.a)(_t,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",attrs:{id:"user-report-form"}},[n("VRadio",{attrs:{options:t.options1,title:"违反法律法规"},model:{value:t.selectedType,callback:function(e){t.selectedType=e},expression:"selectedType"}}),t._ssrNode(" "),n("VRadio",{attrs:{options:t.options2,title:"侵犯个人权益"},model:{value:t.selectedType,callback:function(e){t.selectedType=e},expression:"selectedType"}}),t._ssrNode(" "),n("VRadio",{attrs:{options:t.options3,title:"有害社区环境"},model:{value:t.selectedType,callback:function(e){t.selectedType=e},expression:"selectedType"}}),t._ssrNode(" "+(t.needContent?'<div><p>留言：</p> <textarea placeholder="请说明情况"></textarea></div>':"\x3c!----\x3e")+" "),n("el-button",{staticClass:"submit-btn",attrs:{loading:t.loading,type:"primary"},on:{click:t.submit}},[t._v("\n    提交\n  ")])],2)},[],!1,function(t){var e=n(93);e.__inject__&&e.__inject__(t)},null,"90844d32").exports},data:()=>({show:!1,title:"",id:0,model:0,isCreator:!1}),computed:{drawerTitle(){return this.title||"举报"}},mounted(){this.$channel.$on("open-report-drawer",({id:t,model:e,title:title,isCreator:n})=>{this.id=t,this.model=e,this.title=title,this.isCreator=n,this.show=!0})}};var yt=Object(K.a)(vt,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-drawer",{staticClass:"report-drawer",attrs:{"header-text":t.drawerTitle,backdrop:!1,from:"bottom",size:"100%"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("UserReportForm",{attrs:{id:t.id,model:t.model},on:{success:function(e){t.show=!1}}})],1)},[],!1,function(t){var e=n(94);e.__inject__&&e.__inject__(t)},null,"01460c22").exports,bt=n(46),xt={name:"GiftModal",data:()=>({user:null,showDialog:!1,backdropId:0}),computed:{query(){return this.$route.query},paramsIsOK(){return!!(this.query.uid&&/^\d+$/.test(this.query.uid)&&this.query.time&&/^\d+$/.test(this.query.time)&&Date.now()<=1e3*this.query.time&&this.query.key===this.$md5(`${this.query.uid}-${bt.SHARE_KEY}-${this.query.time}`))},isGuest(){return!this.$store.state.haveAuthToken}},mounted(){this.paramsIsOK&&this.isGuest&&this.getGiftUser()},methods:{getGiftUser(){Object(z.d)(this,{id:this.query.uid}).then(data=>{this.user=data,this.showDialog=!0,this.backdropId=this.$backdrop.show({ele:this.$el,click:()=>{this.showDialog=!1,this.$backdrop.hide(this.backdropId)}})})},joinUs(){this.$channel.$emit("sign-in",!1)},abortYou(){this.showDialog=!1,this.$backdrop.hide(this.backdropId),this.$toast.success("哦，好吧...orz")}}};var wt=Object(K.a)(xt,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.showDialog?n("div",{staticClass:"gift-modal"},[t.user?t._ssrNode('<div class="content">',"</div>",[t._ssrNode('<div class="avatar"><img'+t._ssrAttr("src",t.$resize(t.user.avatar,{width:200}))+'></div> <div class="tips"><p>'+t._ssrEscape("这个页面是「"+t._s(t.user.nickname)+"」分享给你的")+'</p> <p>在这里注册，你们都将会获得「团子」奖励</p> <p>团子可以用来看视频，为偶像应援</p> <p>或经过转化之后提现，1团子相当于1人民币</p> <p>更重要的是，calibur 的发展需要你</p> <p>请加入我们吧</p></div> <button class="join">\n      可以，我加入！\n    </button> <button class="abort">\n      但是，我拒绝！\n    </button> '),t._ssrNode('<p class="expired">',"</p>",[t._ssrNode("<span>该邀请将于</span> "),n("v-time",{model:{value:t.query.time,callback:function(e){t.$set(t.query,"time",e)},expression:"query.time"}}),t._ssrNode(" <span>失效</span>")],2)],2):t._e()]):t._e()},[],!1,function(t){var e=n(95);e.__inject__&&e.__inject__(t)},null,"5247d609").exports,$t=n(47),Et=n.n($t),Tt=t=>{const e="undefined"!=typeof window;if(e&&window.__JWT_TOKEN__)return window.__JWT_TOKEN__;let n="";const r=e?document.cookie:t?t.headers.cookie:"";r&&r.split("; ").forEach(t=>{const e=t.split("=");"JWT-TOKEN"===e[0]&&(n=e[1])});const o=t?t.headers.authorization:"";o&&(n=o.split("Bearer ")[1]);const c=e?window.location.href:t.url,l=Et.a.parse(c.split("?")[1]);if(l&&l.from&&(n=l.token),e){const t=JSON.parse(document.querySelector('script[data-name="page-data"]').textContent)||{};n=t.authToken,window.__JWT_TOKEN__=n}return n},kt={created(){this.$isServer||(this.$store.commit("SET_AUTH_TOKEN",Tt()),this.$store.commit("SET_UA",window.navigator.userAgent.toLowerCase()),this.$store.dispatch("initAuth"),this.$store.dispatch("getOauthData"))}},Ct={name:"DefaultLayout",components:{vHeader:pt,FeedbackDrawer:gt,ReportDrawer:yt,SignDrawer:tt,GiftModal:wt},mixins:[kt],mounted(){this.$store.dispatch("bangumi/getAllBangumi")}},St=Object(K.a)(Ct,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"layout-default"}},[e("v-header"),this._ssrNode(" "),e("nuxt",{staticClass:"main-view"}),this._ssrNode(" "),e("FeedbackDrawer"),this._ssrNode(" "),e("ReportDrawer"),this._ssrNode(" "),e("SignDrawer"),this._ssrNode(" "),e("GiftModal")],2)},[],!1,null,null,"e9d63a5c").exports,It={name:"EmptyLayout"},Ot=Object(K.a)(It,function(){var t=this.$createElement;return(this._self._c||t)("nuxt")},[],!1,null,null,"379513c4").exports,Nt={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}};var jt=Object(K.a)(Nt,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"json-content-txt-parser"},[this._ssrNode("<p>"+this._s(this.item.text)+"</p>")])},[],!1,function(t){var e=n(96);e.__inject__&&e.__inject__(t)},null,"789ba38e").exports,qt={name:"JsonContentImgParser",props:{item:{type:Object,required:!0}}};var At=Object(K.a)(qt,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"json-content-img-parser"},[n("v-img",{attrs:{src:t.item.url,"img-width":t.item.width,"img-height":t.item.height}}),t._ssrNode(" "+(t.item.text?'<p class="img-tip">'+t._ssrEscape(t._s(t.item.text))+"</p>":"\x3c!----\x3e"))],2)},[],!1,function(t){var e=n(97);e.__inject__&&e.__inject__(t)},null,"c05c9068").exports,Rt={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}};var Mt=Object(K.a)(Rt,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"json-content-txt-parser"},[this._ssrNode("<blockquote>"+this._s(this.item.text)+"</blockquote>")])},[],!1,function(t){var e=n(98);e.__inject__&&e.__inject__(t)},null,"5b52fee0").exports,Ut={name:"JsonContentListParser",props:{item:{type:Object,required:!0}},computed:{list(){let t=this.item.text;if(!t)return[];for(;/\n\n/.test(t);)t=t.replace(/\n\n/g,"\n");return t.split("\n")}}};var Dt=Object(K.a)(Ut,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"json-content-list-parser"},[t._ssrNode("1"===t.item.sort?"<ol>"+t._ssrList(t.list,function(li,e){return"<li>"+t._ssrEscape(t._s(li))+"</li>"})+"</ol>":"<ul>"+t._ssrList(t.list,function(li,e){return"<li>"+t._ssrEscape(t._s(li))+"</li>"})+"</ul>")])},[],!1,function(t){var e=n(99);e.__inject__&&e.__inject__(t)},null,"29afbf7a").exports,Pt={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}};var Lt={name:"JsonContent",components:{TxtParser:jt,ImgParser:At,UseParser:Mt,ListParser:Dt,TitleParser:Object(K.a)(Pt,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"json-content-txt-parser"},[this._ssrNode(this.item.text?"<h3>"+this._ssrEscape(this._s(this.item.text))+"</h3>":"\x3c!----\x3e")])},[],!1,function(t){var e=n(100);e.__inject__&&e.__inject__(t)},null,"edaf10be").exports},props:{content:{required:!0,type:Array}}},Bt={name:"WriteLayout",components:{JsonContent:Object(K.a)(Lt,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"json-content"},this._l(this.content,function(t,n){return e(t.type+"-parser",{key:n,tag:"component",attrs:{item:t}})}),1)},[],!1,null,null,"c1e4f6b2").exports},data:()=>({submitting:!1,preview:!1}),computed:{id(){return this.$route.params.id},user(){return this.$store.state.user},sections(){return this.$store.state.editor.sections},published(){return!!this.$store.state.editor.resource&&!!this.$store.state.editor.resource.published_at}},mounted(){this.$channel.$on("write-submit",t=>{this.submitting=t})},methods:{emitPublish(){this.$channel.$emit("write-publish")},emitSave(){this.$channel.$emit("write-save")},emitPreview(){this.preview=!0},emitDestroy(){this.$channel.$emit("write-destroy")},goHome(){this.$confirm("要离开写作界面吗?").then(()=>{window.location=this.$alias.user(this.user.zone)}).catch(()=>{})},goIndex(){this.$confirm("要离开写作界面吗?").then(()=>{window.location="/"}).catch(()=>{})}}};var Ft={name:"WxAppLayout",mixins:[kt],mounted(){this.showDebugBar()},methods:{showDebugBar(){0}}};const zt={_default:St,_empty:Ot,_write:Object(K.a)(Bt,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"layout-write"}},[t._ssrNode("<header>","</header>",[t._ssrNode('<button class="calibur"><img'+t._ssrAttr("src",t.$resize("https://image.calibur.tv/owner/logo-new/logo.png",{width:50}))+' alt="logo" class="logo"> <span class="slogan">calibur.tv</span></button> '),t.user?[t._ssrNode('<button class="avatar">',"</button>",[n("v-img",{attrs:{src:t.user.avatar,avatar:!0,width:24,height:24}})],1),t._ssrNode(' <button class="primary">\n        发布\n      </button> '+(t.published?"\x3c!----\x3e":'<button class="warning">\n        保存\n      </button>')+' <button class="success">\n        预览\n      </button>')]:t._e()],2),t._ssrNode(" "),[n("router-view",{staticClass:"main-view"}),t._ssrNode(" "),n("v-drawer",{staticClass:"preview-drawer",attrs:{footer:!1,"header-text":"预览","submit-text":"确认",from:"bottom",size:"100%"},model:{value:t.preview,callback:function(e){t.preview=e},expression:"preview"}},[t.preview?n("JsonContent",{attrs:{content:t.sections}}):t._e()],1)]],2)},[],!1,function(t){var e=n(101);e.__inject__&&e.__inject__(t)},null,"35f4a0a0").exports,"_wx-app":Object(K.a)(Ft,function(){var t=this.$createElement;return(this._self._c||t)("nuxt")},[],!1,null,null,"05b49fb4").exports};var Gt={head:{htmlAttrs:{lang:"zh-CN"},bodyAttrs:{id:"calibur-tv"},meta:[{charset:"utf-8"},{name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1"},{"http-equiv":"X-UA-Compatible",content:"IE=edge,chrome=1"},{name:"force-rendering",content:"webkit"},{hid:"description",name:"description",content:"calibur.tv - 二次元股市"},{hid:"keywords",name:"keywords",content:"calibur，C站, 二次元股市"}],script:[{innerHTML:'var _hmt=_hmt||[];(function (){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?c10304a2f70ee2ddf8d2818551d37a4b";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s)})();',type:"text/javascript",async:!0},{innerHTML:"(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js'}else{bp.src='http://push.zhanzhang.baidu.com/push.js'}var s=document.getElementsByTagName(\"script\")[0];s.parentNode.insertBefore(bp,s)})();",type:"text/javascript",async:!0},{innerHTML:"(function(){var iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;var ratio=window.devicePixelRatio||1;var screen={width:window.screen.width*ratio,height:window.screen.height*ratio};if(iOS&&screen.width===1125&&screen.height===2436){document.querySelector('meta[name=viewport]').content=document.querySelector('meta[name=viewport]').content+',viewport-fit=cover'}}());",type:"text/javascript"},{src:"//qzonestyle.gtimg.cn/qzone/qzact/common/share/share.js",type:"text/javascript"},{src:"//res2.wx.qq.com/open/js/jweixin-1.4.0.js",type:"text/javascript"}],__dangerouslyDisableSanitizers:"script",link:[],style:[]},render(t,e){const n=t("NuxtLoading",{ref:"loading"}),r=t(this.layout||"nuxt"),o=t("div",{domProps:{id:"__layout"},key:this.layoutName},[r]),c=t("transition",{props:{name:"layout",mode:"out-in"},on:{beforeEnter(t){window.$nuxt.$nextTick(()=>{window.$nuxt.$emit("triggerScroll")})}}},[o]);return t("div",{domProps:{id:"__nuxt"}},[n,c])},data:()=>({isOnline:!0,layout:null,layoutName:""}),beforeCreate(){c.a.util.defineReactive(this,"nuxt",this.$options.nuxt)},created(){c.a.prototype.$nuxt=this,this.error=this.nuxt.error},mounted(){this.$loading=this.$refs.loading},watch:{"nuxt.err":"errorChanged"},computed:{isOffline(){return!this.isOnline}},methods:{refreshOnlineStatus(){0},errorChanged(){this.nuxt.err&&this.$loading&&(this.$loading.fail&&this.$loading.fail(),this.$loading.finish&&this.$loading.finish())},setLayout(t){return t&&zt["_"+t]||(t="default"),this.layoutName=t,this.layout=zt["_"+t],this.layout},loadLayout:t=>(t&&zt["_"+t]||(t="default"),Promise.resolve(zt["_"+t]))},components:{NuxtLoading:ot}},Kt=n(35),Ht=n.n(Kt);c.a.use(Ht.a);const Vt=console,Jt=["state","getters","actions","mutations"];let Wt,Yt={};!function(){const t=(Wt=n(102)).keys().sort((t,e)=>{let n=t.split("/").length-e.split("/").length;return 0===n&&t.includes("/index.")?n=-1:0===n&&e.includes("/index.")&&(n=1),n}),e=t.find(path=>path.includes("./index."));if(e&&(Yt=Zt(e,{isRoot:!0})),"function"==typeof Yt)return Vt.warn("Classic mode for store/ is deprecated and will be removed in Nuxt 3.");Yt.modules=Yt.modules||{};for(const path of t){const t=path.replace(/^\.\//,"").replace(/\.(js|mjs|ts)$/,"");if("index"===t)continue;const e=t.split("/");let n=e[e.length-1];const r=Zt(path,{isState:"state"===n});if(Jt.includes(n)){const t=n;te(Xt(Yt,e,{isProperty:!0}),r,t);continue}"index"===n&&(e.pop(),n=e[e.length-1]);const o=Xt(Yt,e);for(const t of Jt)te(o,r[t],t)}}();const Qt=Yt instanceof Function?Yt:()=>new Ht.a.Store(Object.assign({strict:!1},Yt));function Zt(path,{isRoot:t=!1,isState:e=!1}={}){const n=Wt(path);let r=n.default||n;if(e&&"function"!=typeof r){Vt.warn(`${path} should export a method that returns an object`);const t=Object.assign({},r);return()=>t}if(t&&r.commit)throw new Error("[nuxt] store/"+path.replace("./","")+" should export a method that returns a Vuex instance.");if(t&&"function"!=typeof r&&(r=Object.assign({},r)),r.state&&"function"!=typeof r.state){Vt.warn(`'state' should be a method that returns an object in ${path}`);const t=Object.assign({},r.state);r=Object.assign({},r,{state:()=>t})}return r}function Xt(t,e,{isProperty:n=!1}={}){if(!e.length||n&&1===e.length)return t;const r=e.shift();return t.modules[r]=t.modules[r]||{},t.modules[r].namespaced=!0,t.modules[r].modules=t.modules[r].modules||{},Xt(t.modules[r],e,{isProperty:n})}function te(t,e,n){e&&("state"===n?t.state=e||t.state:t[n]=Object.assign({},t[n],e))}var ee=n(49),se=n.n(ee);const ne={setHeader(t,e,n="common"){for(let r of Array.isArray(n)?n:[n]){if(!e)return void delete this.defaults.headers[r][t];this.defaults.headers[r][t]=e}},setToken(t,e,n="common"){const r=t?(e?e+" ":"")+t:null;this.setHeader("Authorization",r,n)},onRequest(t){this.interceptors.request.use(e=>t(e)||e)},onResponse(t){this.interceptors.response.use(e=>t(e)||e)},onRequestError(t){this.interceptors.request.use(void 0,e=>t(e)||Promise.reject(e))},onResponseError(t){this.interceptors.response.use(void 0,e=>t(e)||Promise.reject(e))},onError(t){this.onRequestError(t),this.onResponseError(t)}};for(let t of["request","delete","get","head","options","post","put","patch"])ne["$"+t]=function(){return this[t].apply(this,arguments).then(t=>t&&t.data)};var re=(t,e)=>{const n={baseURL:process.env._AXIOS_BASE_URL_||"http://localhost:3000/",headers:{common:{Accept:"application/json, text/plain, */*"},delete:{},get:{},head:{},post:{},put:{},patch:{}}};n.headers.common=t.req&&t.req.headers?Object.assign({},t.req.headers):{},delete n.headers.common.accept,delete n.headers.common.host,delete n.headers.common["cf-ray"],delete n.headers.common["cf-connecting-ip"],n.headers.common["Accept-Encoding"]="gzip, deflate";const r=se.a.create(n);(t=>{for(let e in ne)t[e]=ne[e].bind(t)})(r),t.$axios=r,e("axios",r)},ie=n(50),oe=n.n(ie),ae=({$axios:t,app:e})=>{const n="undefined"!=typeof window;t.setHeader("Accept","application/x.api.latest+json"),e.store.state.login?t.setToken(e.store.state.user.token,"Bearer"):t.setToken(Tt(n?"":e.context.req),"Bearer"),t.onRequest(t=>{t.baseURL=n?"https://api.calibur.tv/":"http://localhost/",t.timeout=1e4;const e=t.method.toLocaleUpperCase();n&&M.sentry.setRequestStack({url:t.url,params:"GET"===e?t.params:t.data,method:e})}),t.onResponse(t=>{n&&M.sentry.setResponseStack({url:t.request.responseURL,requestId:t.headers["x-request-id"],viaId:t.headers["x-via"]||"none",code:200});const e=t.headers.authorization;return e&&Object.assign(t.data.data,{token:e.split("Bearer ").pop()}),t.data}),t.onError(t=>{const e=(t=>/timeout of/.test(t.message)?(t.statusCode=504,t.message="网络请求超时，请稍候再试！",t):t.response?(t.statusCode=t.response.status,t.message=t.response.data.message,t):(t.statusCode=502,t.message="网络错误，请刷新网页重试！",t))(t);if(n){M.sentry.setResponseStack({url:e.request&&e.request.responseURL||"unknown",code:e.statusCode,message:e.message});const t=window.location.search,source=/from=/.test(t)?t.split("from=")[1].split("&")[0]:"",n=-1===["wxapp"].indexOf(source);/\/door\/refresh/.test(e.config.url)&&(oe.a.remove("JWT-TOKEN"),n&&setTimeout(()=>{window.location=window.location.pathname},1e3)),n&&M.toast.error(e.message)}return Promise.reject(e)})},ce=(n(38),n(2),n(28)),ue=n.n(ce),le=(n(104),n(51)),de=n.n(le),pe=(n(105),n(52)),he=n.n(pe),me=(n(106),n(53)),fe=n.n(me),ge=(n(39),n(29)),_e=n.n(ge),ve=(n(40),n(30)),ye=n.n(ve),be=(n(107),n(54)),xe=n.n(be),we=(n(108),n(55)),$e=n.n(we),Ee=(n(109),n(56)),Te=n.n(Ee),ke=(n(41),n(31)),Ce=n.n(ke),Se=(n(110),n(57)),Ie=n.n(Se),Oe=(n(111),n(58)),Ne=n.n(Oe),je=(n(112),n(59)),qe=n.n(je),Ae=(n(113),n(60)),Re=n.n(Ae),Me=(n(114),n(61)),Ue=n.n(Me),De=(n(115),n(62)),Pe=n.n(De),Le=(n(116),n(63)),Be=n.n(Le),Fe=(n(117),n(64)),ze=n.n(Fe),Ge=(n(42),n(32)),Ke=n.n(Ge),He=(n(118),n(65)),Ve=n.n(He),Je=(n(119),n(66)),We=n.n(Je),Ye=(n(120),n(67)),Qe=n.n(Ye),Ze=(n(121),n(68)),Xe=n.n(Ze),ts=(n(122),n(69)),es=n.n(ts),ss=(n(123),n(70)),ns=n.n(ss),rs=n(4),is=n.n(rs);c.a.component(is.a.name,is.a),c.a.use(ns.a),c.a.use(es.a),c.a.use(Xe.a),c.a.use(Qe.a),c.a.use(We.a),c.a.use(Ve.a),c.a.use(Ke.a),c.a.use(ze.a),c.a.use(Be.a),c.a.use(Pe.a),c.a.use(Ue.a),c.a.use(Re.a),c.a.use(qe.a),c.a.use(Ne.a),c.a.use(Ie.a),c.a.use(Ce.a),c.a.use(Te.a),c.a.use($e.a),c.a.use(xe.a),c.a.use(ye.a),c.a.use(_e.a),c.a.use(fe.a),c.a.use(he.a),c.a.use(de.a),c.a.use(ue.a);var os={index:"/",__query(t,e){if(!e)return t;let n="?";return Object.keys(e).forEach(t=>{n+=`${t}=${e[t]}&`}),`${t.split("?").shift()}${n.substring(0,n.length-1)}`},url(t,e){return this.__query(t,e)},user:(t,path="")=>`/user/${t}/${path}`,bangumi:(t,e="")=>`/bangumi/${t}/${e}`,video:t=>`/video/${t}`,image:t=>`/pin/${t}`,score:t=>`/review/${t}`,post(t,e){return this.__query(`/post/${t}`,e)},bangumiTag:t=>t?`/bangumi/tags?id=${t}`:"/bangumi/tags",bangumiNews:"/bangumi/news",bangumiTimeline:"/bangumi/timeline",postTrending:t=>`/post/trending/${t}`,world:t=>`/world/${t}`,editScore:t=>`/review/create?id=${t}`,question:t=>`/qaq/${t}`,answer:t=>`/soga/${t}`,roleTrending:"/role/trending",createScore:"/review/create",cartoonRole:t=>`/role/${t}`},as={shortenNumber:t=>t>1e3?`${Math.floor(t/1e3*10)/10}k`:t,timeLong(time){const t=/^\d+$/.test(time)?13===time.toString().length?parseInt((time-0)/1e3,10):1e3*time:time.replace(/-/g,"/"),e=new Date(t);return`${e.getFullYear()}-${`0${e.getMonth()+1}`.substr(-2)}-${`0${e.getDate()}`.substr(-2)} ${`0${e.getHours()}`.substr(-2)}:${`0${e.getMinutes()}`.substr(-2)}:${`0${e.getSeconds()}`.substr(-2)}`},throttle(t,e,n){let r,o,c,l=null,d=0;n||(n={});const h=function(){d=!1===n.leading?0:Date.now(),l=null,c=t.apply(r,o),l||(r=o=null)};return function(){const m=Date.now();d||!1!==n.leading||(d=m);const f=e-(m-d);return r=this,o=arguments,f<=0||f>e?(l&&(clearTimeout(l),l=null),d=m,c=t.apply(r,o),l||(r=o=null)):l||!1===n.trailing||(l=setTimeout(h,f)),c}},createFileName:({userId:t,type:e,file:n})=>`user/${t}/${e}/${(new Date).getTime()}-${Math.random().toString(36).substring(3,6)}.${n.type.split("/").pop()}`,getOffsetTop(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop)}while(t=t.offsetParent);return e},shuffle(t){for(let i=t.length;i;i--){const e=Math.floor(Math.random()*i);[t[i-1],t[e]]=[t[e],t[i-1]]}return t}},cs=(t,e={})=>{if(!t)return"";if(/imageMogr2/.test(t))return t;const link=/^http/.test(t)?t:`https://image.calibur.tv/${t}`,n=e.format?`/format/${e.format}`:(()=>{if("undefined"==typeof window)return!1;if(void 0!==window.supportWebP)return window.supportWebP;const t=document.createElement("canvas");if(t.getContext&&t.getContext("2d")){const e=0===t.toDataURL("image/webp").indexOf("data:image/webp");return window.supportWebP=e,e}return!1})()?"/format/webp":"",r=void 0===e.mode?1:e.mode;if(1===r&&!e.width||!e.width&&!e.height)return`${link}?imageMogr2/auto-orient/strip${n}`;let o,c;return 1===r?(o=`/w/${e.width}`,c=e.height?`/h/${e.height}`:`/h/${e.width}`):(o=e.width?`/w/${e.width}`:"",c=e.height?`/h/${e.height}`:""),`${link}?imageMogr2/auto-orient/strip|imageView2/${r}${o}${c}${n}`},us=n(71),ls=n.n(us);function ds(t,e){const n=Math.pow(10,e+1),r=Math.floor(t*n);return 10*Math.round(r/10)/n}function ps(t,{viewportWidth:e,unitPrecision:n,viewportUnit:r,minPixelValue:o}={viewportWidth:375,unitPrecision:5,viewportUnit:"vw",minPixelValue:1}){if("number"==typeof t||!Number.isNaN(+t))return ds(+t/e*100,n)+r;if("string"==typeof t){const c=new RegExp("\"[^\"]+\"|'[^']+'|url\\([^\\)]+\\)|(\\d*\\.?\\d+)px","ig");return t.replace(c,function(t,e,n,r){return function(o,c){if(!c)return o;const l=parseFloat(c);return l<=e?o:ds(l/t*100,n)+r}}(e,o,n,r))}if("[object Object]"===Object.prototype.toString.call(t)){const e=t;return Object.keys(t).forEach(n=>{e[n]=ps(t[n])}),e}throw new Error("typeof px is invalid")}c.a.use({install(t){t.prototype.$md5=ls.a,t.prototype.$alias=os,t.prototype.$utils=as,t.prototype.$resize=cs,t.prototype.$px2vw=ps}});var hs={name:"not-ssr",props:["placeholder"],data:()=>({canRender:!1}),mounted(){this.canRender=!0},render(t){return this.canRender?this.$slots.default&&this.$slots.default[0]:t("div",{class:["no-ssr-placeholder"]},this.$slots.placeholder||this.placeholder)}},ms=n(36),fs=n.n(ms);const gs=fs()();var _s={name:"VTime",props:{value:{default:parseInt(Date.now()/1e3,10).toString()}},render:function(t){return t("time",{attrs:{datetime:this.$utils.timeLong(this.value)}})},mounted(){gs.render(this.$el,"zh_CN")},beforeDestroy(){fs.a.cancel(this.$el)}},vs={name:"VDrawer",props:{value:{type:Boolean,default:!1},id:{type:String,default:""},from:{type:String,default:"right",validator:t=>~["left","right","top","bottom"].indexOf(t)},size:{type:String,default:"70%"},headerText:{type:String,default:""},backdrop:{type:Boolean,default:!0},submitText:{type:String,default:""}},data(){return{show:this.value,pos:0,backdropId:0}},computed:{position(){const style={};return"left"===this.from||"right"===this.from?(style.top=0,style.height="100%",style.width=this.size):(style.left=0,style.width="100%",style.height=this.size),style[this.from]=0,style}},watch:{value(t){t?this.open():this.close(),this.show=t},show(t){this.$emit("input",t)},$route(){this.close()}},mounted(){this.id&&(this.$channel.$on(`drawer-open-${this.id}`,this.open),this.$channel.$on(`drawer-close-${this.id}`,this.close))},beforeDestroy(){this.id&&(this.$channel.$off(`drawer-open-${this.id}`),this.$channel.$off(`drawer-close-${this.id}`))},methods:{open(){this.show||(this.pos=window.scrollY,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=0,document.body.style.bottom=0,document.body.style.right=0,document.body.style.left=0,document.body.style.height=`${window.innerHeight}px`,this.show=!0,window.__closeImageLazy__=!0,this.id&&this.$channel.$emit(`drawer-open-event-${this.id}`),this.backdrop&&(this.backdropId=this.$backdrop.show({ele:this.$el,click:this.close})))},close(){document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.bottom="",document.body.style.right="",document.body.style.left="",document.body.style.height="",this.show&&(window.scrollTo(0,this.pos),this.show=!1,window.__closeImageLazy__=!1,this.backdrop&&this.$backdrop.hide(this.backdropId),this.id&&this.$channel.$emit(`drawer-close-event-${this.id}`),this.$emit("cancel"))},submit(){this.close(),this.$nextTick(()=>{this.$emit("submit")})}}};var ys=Object(K.a)(vs,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("not-ssr",[n("transition",{attrs:{name:"fade-"+t.from}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"drawer",style:t.position},[t.headerText?n("header",{staticClass:"drawer-header"},[n("button",{staticClass:"close-btn",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.close(e)}}},[t._v("\n          关闭\n        ")]),t._v(" "),n("h3",{staticClass:"oneline",domProps:{textContent:t._s(t.headerText)}}),t._v(" "),t.submitText?n("button",{staticClass:"submit-btn",domProps:{textContent:t._s(t.submitText)},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.submit(e)}}}):t._e()]):t._e(),t._v(" "),t._t("default")],2)])],1)},[],!1,function(t){var e=n(124);e.__inject__&&e.__inject__(t)},"01f87a34","366e8e16").exports;var bs=new class{constructor(){this.id=0,this.listeners={}}checkInView(t,e=1.3){if("undefined"==typeof window||!(t instanceof Element))return!1;const rect=t.getBoundingClientRect();return rect.top<window.innerHeight*e&&rect.bottom>0&&rect.left<window.innerWidth*e&&rect.right>0}on(element,t,e,n=!1){const r=[];return("string"==typeof t?[t]:t).forEach(t=>{const o=this.id++;element.addEventListener(t,e,n),this.listeners[o]={element:element,event:t,handler:e,capture:n},r.push(o)}),r}off(t){t.forEach(t=>{if(this.listeners[t]){const e=this.listeners[t];e.element.removeEventListener(e.event,e.handler,e.capture),delete this.listeners[t]}})}},xs={name:"VLazy",props:{timeout:{type:Number,default:0},scale:{type:Number,default:1.5}},data:()=>({init:!1}),watch:{$route(){this.init=!1,this.$nextTick(()=>{this.renderComp()})}},mounted(){this.timeout?setTimeout(()=>{this.init=!0},this.timeout):this.renderComp()},methods:{renderComp(){if(bs.checkInView(this.$el,this.scale))this.init=!0;else{const t=bs.on(document,["scroll"],this.$utils.throttle(()=>{(bs.checkInView(this.$el,this.scale)||this.init)&&(this.init=!0,bs.off(t))},200))}}}},ws=Object(K.a)(xs,function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("no-ssr",[this.init?this._t("default"):e("div",{staticClass:"v-lazy-shim"})],2)],1)},[],!1,null,null,"13b09ad6").exports,$s=n(72),Es=n.n($s),Ts=n(73),ks=n.n(Ts);n(125),n(126);c.a.use(Es.a),c.a.use(ue.a),c.a.use(ye.a),c.a.use(_e.a),c.a.use(Ke.a),c.a.use(Ce.a),c.a.use(ks.a,{filter:cs,contentWidth:400,vwViewport:375}),c.a.component(ws.name,ws),c.a.component(is.a.name,is.a),c.a.component(hs.name,hs),c.a.component(_s.name,_s),c.a.component(ys.name,ys);n(33);c.a.component(P.name,P),c.a.component(L.name,L),c.a.component("NChild",L),c.a.component(nt.name,nt),c.a.use(N.a,{keyName:"head",attribute:"data-n-head",ssrAttribute:"data-n-head-ssr",tagIDKeyName:"hid"});const Cs={name:"page",mode:"out-in",appear:!1,appearClass:"appear",appearActiveClass:"appear-active",appearToClass:"appear-to"};async function Ss(t){const e=await new A.a({mode:"history",base:"/",linkActiveClass:"nuxt-link-active",linkExactActiveClass:"nuxt-link-exact-active",scrollBehavior:U,routes:[{path:"/",component:R,props:!1,name:"index"}],fallback:!1}),n=Qt(t);n.$router=e;const r=n.registerModule;n.registerModule=((path,t,e)=>r.call(n,path,t,Object.assign({preserveState:!1},e)));const o={router:e,store:n,nuxt:{defaultTransition:Cs,transitions:[Cs],setTransitions(t){return Array.isArray(t)||(t=[t]),t=t.map(t=>t=t?"string"==typeof t?Object.assign({},Cs,{name:t}):Object.assign({},Cs,t):Cs),this.$options.nuxt.transitions=t,t},err:null,dateErr:null,error(e){e=e||null,o.context._errored=!!e,e=e?function(t){let e;if(t.message||"string"==typeof t)e=t.message||t;else try{e=JSON.stringify(t,null,2)}catch(n){e=`[${t.constructor.name}]`}return{...t,message:e,statusCode:t.statusCode||t.status||t.response&&t.response.status||500}}(e):null;const n=this.nuxt||this.$options.nuxt;return n.dateErr=Date.now(),n.err=e,t&&(t.nuxt.error=e),e}},...Gt};n.app=o;const l=t?t.next:t=>o.router.push(t);let d;if(t)d=e.resolve(t.url).route;else{const path=function(base,t){let path=window.location.pathname;return"hash"===t?window.location.hash.replace(/^#\//,""):(base&&0===path.indexOf(base)&&(path=path.slice(base.length)),decodeURI(path||"/")+window.location.search+window.location.hash)}(e.options.base);d=e.resolve(path).route}await w(o,{route:d,next:l,error:o.nuxt.error.bind(o),store:n,payload:t?t.payload:void 0,req:t?t.req:void 0,res:t?t.res:void 0,beforeRenderFns:t?t.beforeRenderFns:void 0});const h=function(t,e){if(!t)throw new Error("inject(key, value) has no key provided");if(void 0===e)throw new Error("inject(key, value) has no value provided");o[t="$"+t]=e,n[t]=o[t];const r="__nuxt_"+t+"_installed__";c.a[r]||(c.a[r]=!0,c.a.use(()=>{c.a.prototype.hasOwnProperty(t)||Object.defineProperty(c.a.prototype,t,{get(){return this.$root.$options[t]}})}))};return"function"==typeof re&&await re(o.context,h),"function"==typeof ae&&await ae(o.context,h),t&&t.url&&await new Promise((n,r)=>{e.push(t.url,n,()=>{const r=e.afterEach(async(e,c,l)=>{t.url=e.fullPath,o.context.route=await x(e),o.context.params=e.params||{},o.context.query=e.query||{},r(),n()})})}),{app:o,store:n,router:e}}var Is={name:"NuxtLink",extends:c.a.component("RouterLink"),props:{noPrefetch:{type:Boolean,default:!1}}};c.a.component(Is.name,Is),c.a.component("NLink",Is);const Os=n(127)("nuxt:render");Os.color=4;const Ns=()=>new c.a({render:t=>t("div")}),js=t=>e=>{if(t.redirected=e,!t.res)return void(t.nuxt.serverRendered=!1);e.query=Object(r.stringify)(e.query),e.path=e.path+(e.query?"?"+e.query:"");e.path.startsWith("http"),e.path!==t.url?(t.res.writeHead(e.status,{Location:e.path}),t.res.end()):t.redirected=!1};e.default=(async t=>{t.redirected=!1,t.next=js(t),t.beforeRenderFns=[],t.nuxt={layout:"default",data:[],error:null,state:null,serverRendered:!0};const{app:e,router:n,store:r}=await Ss(t),o=new c.a(e);t.meta=o.$meta(),t.asyncData={};const l=async()=>{await Promise.all(t.beforeRenderFns.map(e=>E(e,{Components:m,nuxtState:t.nuxt}))),t.nuxt.state=r.state},d=async()=>{const n="function"==typeof st.layout?st.layout(e.context):st.layout;return t.nuxt.layout=n||"default",await o.loadLayout(n),o.setLayout(n),await l(),o},h=()=>(e.context.error({statusCode:404,path:t.url,message:"This page could not be found"}),d()),m=v(n.match(t.url));if(r._actions&&r._actions.nuxtServerInit)try{await r.dispatch("nuxtServerInit",e.context)}catch(t){throw Os("error occurred when calling nuxtServerInit: ",t.message),t}if(t.redirected)return Ns();if(t.nuxt.error)return d();let y=[];if(y=y.map(t=>"function"==typeof t?t:("function"!=typeof f[t]&&e.context.error({statusCode:500,message:"Unknown middleware "+t}),f[t])),await $(y,e.context),t.redirected)return Ns();if(t.nuxt.error)return d();let x=m.length?m[0].options.layout:st.layout;if("function"==typeof x&&(x=x(e.context)),await o.loadLayout(x),t.nuxt.error)return d();if(x=o.setLayout(x),t.nuxt.layout=o.layoutName,y=[],(x=_(x)).options.middleware&&(y=y.concat(x.options.middleware)),m.forEach(t=>{t.options.middleware&&(y=y.concat(t.options.middleware))}),y=y.map(t=>"function"==typeof t?t:("function"!=typeof f[t]&&e.context.error({statusCode:500,message:"Unknown middleware "+t}),f[t])),await $(y,e.context),t.redirected)return Ns();if(t.nuxt.error)return d();let w=!0;try{for(const t of m)if("function"==typeof t.options.validate&&!(w=await t.options.validate(e.context)))break}catch(t){return e.context.error({statusCode:t.statusCode||"500",message:t.message}),d()}if(!w)return t._generate&&(t.nuxt.serverRendered=!1),h();if(!m.length)return h();const T=await Promise.all(m.map(n=>{const r=[];if(n.options.asyncData&&"function"==typeof n.options.asyncData){const o=E(n.options.asyncData,e.context);o.then(e=>(t.asyncData[n.cid]=e,function(t,e){if(!e&&t.options.__hasNuxtData)return;const n=t.options._originDataFn||t.options.data||function(){return{}};t.options._originDataFn=n,t.options.data=function(){const data=n.call(this);return this.$ssrContext&&(e=this.$ssrContext.asyncData[t.cid]),{...data,...e}},t.options.__hasNuxtData=!0,t._Ctor&&t._Ctor.options&&(t._Ctor.options.data=t.options.data)}(n),e)),r.push(o)}else r.push(null);return n.options.fetch?r.push(n.options.fetch(e.context)):r.push(null),Promise.all(r)}));return t.nuxt.data=T.map(t=>t[0]||{}),t.redirected?Ns():t.nuxt.error?d():(await l(),o)})},function(t,e,n){"use strict";n.r(e);var r=n(0),o=n.n(r),c=n(3);n.d(e,"state",function(){return l}),n.d(e,"mutations",function(){return d}),n.d(e,"actions",function(){return h});const l=()=>({user:null,login:!1,ua:{ios:!1,android:!1,wechat:!1,qq:!1,tencent:!1,alipay:!1,weibo:!1,pc:!1,others:!1},haveAuthToken:!1,OAuthData:null,from:""}),d={SET_USER(t,e){const n=!!e.id;t.user=e,t.login=n,t.haveAuthToken=n},SET_USER_INFO(t,data){Object.keys(data).forEach(e=>{t.user[e]=data[e]})},SET_AUTH_TOKEN(t,e){t.haveAuthToken=!!e},SET_UA(t,e){t.ua={ios:/iphone|ipad|ipod/.test(e),android:/android/.test(e),wechat:/micromessenger/.test(e),qq:/qq/.test(e),tencent:/mqqbrowser|qq|micromessenger/.test(e),alipay:/alipayclient/.test(e),weibo:/weibo/i.test(e),pc:!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),others:/windows phone|blackberry/.test(e)}},SET_OAUTH_DATA(t,data){t.OAuthData=data},UPDATE_USER_INFO(t,{key:e,value:n}){o.a.set(t.user,e,n)},UPDATE_USER_EXP(t,e){if(t.login&&e)if(e>0)if(t.user.exp.have_exp+e>=t.user.next_level_exp){const n=t.user.exp.level+1;t.user.exp.level=n,t.user.exp.have_exp=t.user.exp.have_exp+e-t.user.next_level_exp,t.user.exp.next_level_exp=n*n+10*n}else t.user.exp.have_exp=t.user.exp.have_exp+e;else if(t.user.exp.have_exp+e<0){const n=t.user.exp.level-1,r=n*n+10*n;t.user.exp.have_exp=r+t.user.exp.have_exp+e,t.user.exp.next_level_exp=r}else t.user.exp.have_exp=t.user.exp.have_exp+e},USE_COIN(t,e){t.login&&(t.user.pocket-=e)},SET_SOURCE(t,e){t.from=e}},h={async getOauthData({commit:t}){const e=(window.navigator.userAgent||"").toLowerCase();if(/mqqbrowser|qq|micromessenger/.test(e)){t("SET_OAUTH_DATA",await((t,e)=>t.$axios.$get("door/data",{params:{refer:"h5",url:e}}))(this,window.location.href))}},async initAuth({state:t,commit:e}){if(t.user)return!0;if(!t.haveAuthToken)return e("SET_USER",{}),!1;try{return e("SET_USER",await Object(c.c)(this)),!0}catch(t){return e("SET_USER",{}),!1}},async getUpToken({state:t,commit:e}){if(t.login&&t.user.uptoken.expiredAt<=parseInt(Date.now()/1e3,10)){e("UPDATE_USER_INFO",{key:"uptoken",value:await(t=>t.$axios.$get("image/uptoken"))()})}}}},function(t,e,n){"use strict";n.r(e);const r=(t,{q:q,type:e,page:n})=>t.$axios.$get("search/new",{params:{q:q,type:e,page:n}});n.d(e,"state",function(){return c}),n.d(e,"mutations",function(){return l}),n.d(e,"actions",function(){return d});const o={all:"综合",bangumi:"番剧",video:"视频",post:"帖子",score:"漫评",role:"偶像",user:"用户"},c=()=>({tabs:o,lastSearchKeywords:"",resource:Object.assign({},...Object.keys(o).map(t=>({[t]:{list:[],page:0,total:0,noMore:!1,loading:!1}}))),bangumis:[]}),l={RESET_DATA(t){t.lastSearchKeywords="",t.resource=Object.assign({},...Object.keys(o).map(t=>({[t]:{list:[],page:0,total:0,noMore:!1,loading:!1}})))},SET_LOADING(t,{type:e,value:n}){t.resource[e].loading=n},SET_RESOURCE(t,{type:e,q:q,data:data}){t.lastSearchKeywords=q,t.resource[e].list=t.resource[e].list.concat(data.list),t.resource[e].page=t.resource[e].page+1,t.resource[e].noMore=data.noMore,t.resource[e].total=data.total,t.resource[e].loading=!1},SET_BANGUMIS(t,data){t.bangumis=data}},d={async fetchData({state:t,commit:e},{q:q,type:n}){if(!q)return;t.lastSearchKeywords&&t.lastSearchKeywords!==q&&e("RESET_DATA");const o=t.resource[n];o.list.length||o.noMore||o.loading||(e("SET_LOADING",{type:n,value:!0}),e("SET_RESOURCE",{q:q,type:n,data:await r(this,{q:q,type:n,page:o.page})}))},async fetchMore({state:t,commit:e},{type:n}){const q=t.lastSearchKeywords;if(!q)return;const o=t.resource[n];o.noMore||o.loading||(e("SET_LOADING",{type:n,value:!0}),e("SET_RESOURCE",{q:q,type:n,data:await r(this,{q:q,type:n,page:o.page})}))}}},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"meta",function(){return meta}),n.d(r,"getWorldPost",function(){return d}),n.d(r,"getWorldImage",function(){return h}),n.d(r,"getWorldScore",function(){return m}),n.d(r,"getWorldQAQ",function(){return f}),n.d(r,"getRoleTrending",function(){return _}),n.d(r,"getBangumiPost",function(){return v}),n.d(r,"getBangumiImage",function(){return y}),n.d(r,"getBangumiRole",function(){return x}),n.d(r,"getBangumiScore",function(){return w}),n.d(r,"getBangumiQAQ",function(){return $}),n.d(r,"getBangumiCartoon",function(){return E}),n.d(r,"getUserFollowBangumis",function(){return T}),n.d(r,"getUserPost",function(){return k}),n.d(r,"getUserPostReply",function(){return C}),n.d(r,"getUserImage",function(){return S}),n.d(r,"getUserScore",function(){return I}),n.d(r,"getUserQAQ",function(){return O}),n.d(r,"getUserAnswer",function(){return N}),n.d(r,"getUserRole",function(){return j}),n.d(r,"getUserScoreDrafts",function(){return A}),n.d(r,"getUserInviteUsers",function(){return R}),n.d(r,"getUserAnswerDrafts",function(){return M}),n.d(r,"getUserBookmarks",function(){return U}),n.d(r,"getQuestionAnswers",function(){return D}),n.d(r,"cartoonRoleFans",function(){return P}),n.d(r,"virtualIdolOwners",function(){return L}),n.d(r,"virtualIdolList",function(){return B}),n.d(r,"getVirtualIdolDealList",function(){return F}),n.d(r,"myVirtualIdolDeals",function(){return z}),n.d(r,"getIdolDraftList",function(){return G}),n.d(r,"getIdolProductOrders",function(){return K}),n.d(r,"getUserProductOrders",function(){return H}),n.d(r,"getIdolProducts",function(){return V});var o=n(0),c=n.n(o);const l=(t,{sort:e,type:n,take:r,page:o,minId:c,seenIds:l,bangumiId:d,userZone:h})=>t.$axios.$get("flow/list",{params:{sort:e,type:n,take:r,page:o,minId:c,seenIds:l,bangumiId:d,userZone:h}}),meta=(t,{type:e})=>t.$axios.$get("flow/meta",{params:{type:e}}),d=({ctx:t,seen_ids:e,count:n,max_id:r,order_by:o})=>l(t,{type:"post",sort:o,seenIds:e,minId:r,take:n}),h=({ctx:t,seen_ids:e,count:n,max_id:r,order_by:o})=>l(t,{type:"image",sort:o,seenIds:e,minId:r,take:n}),m=({ctx:t,seen_ids:e,count:n,max_id:r,order_by:o})=>l(t,{type:"score",sort:o,seenIds:e,minId:r,take:n}),f=({ctx:t,seen_ids:e,count:n,max_id:r,order_by:o})=>l(t,{type:"question",sort:o,seenIds:e,minId:r,take:n}),_=({ctx:t,seen_ids:e,count:n,max_id:r,order_by:o})=>l(t,{type:"role",sort:o,seenIds:e,minId:r,take:n}),v=({ctx:t,id:e,seen_ids:n,count:r,max_id:o,order_by:c})=>l(t,{type:"post",bangumiId:e,sort:c,seenIds:n,minId:o,take:r}),y=({ctx:t,id:e,seen_ids:n,count:r,max_id:o,order_by:c})=>l(t,{type:"image",bangumiId:e,sort:c,seenIds:n,minId:o,take:r}),x=({ctx:t,id:e,page:n,seen_ids:r,count:o,order_by:c})=>l(t,{type:"role",bangumiId:e,sort:c,seenIds:r,take:o,page:n}),w=({ctx:t,id:e,seen_ids:n,count:r,max_id:o,order_by:c})=>l(t,{type:"score",bangumiId:e,sort:c,seenIds:n,minId:o,take:r}),$=({ctx:t,id:e,seen_ids:n,count:r,max_id:o,order_by:c})=>l(t,{type:"question",bangumiId:e,sort:c,seenIds:n,minId:o,take:r}),E=({ctx:t,id:e,page:n,count:r,order_by:o})=>t.$axios.$get(`bangumi/${e}/cartoon`,{params:{page:n,take:r,sort:o}}),T=({ctx:t,id:e})=>t.$axios.$get(`user/${e}/followed/bangumi`),k=({ctx:t,id:e,page:n,count:r,order_by:o})=>l(t,{type:"post",userZone:e,sort:o,take:r,page:n}),C=({ctx:t,id:e,count:n,page:r})=>t.$axios.$get(`user/${e}/posts/reply`,{params:{count:n,page:r}}),S=({ctx:t,id:e,page:n,count:r,order_by:o})=>l(t,{type:"image",userZone:e,sort:o,take:r,page:n}),I=({ctx:t,id:e,page:n,count:r,order_by:o})=>l(t,{type:"score",userZone:e,sort:o,take:r,page:n}),O=({ctx:t,id:e,page:n,count:r,order_by:o})=>l(t,{type:"question",userZone:e,sort:o,take:r,page:n}),N=({ctx:t,id:e,page:n,count:r,order_by:o})=>l(t,{type:"answer",userZone:e,sort:o,take:r,page:n}),j=({ctx:t,id:e,page:n,count:r,order_by:o})=>l(t,{type:"role",userZone:e,sort:o,take:r,page:n}),A=({ctx:t})=>t.$axios.$get("score/drafts"),R=({ctx:t,id:e,page:n,count:r})=>t.$axios.$get("user/invite/users",{params:{id:e,page:n,take:r}}),M=({ctx:t})=>t.$axios.$get("question/soga/drafts"),U=({ctx:t,page:e,take:n,order_by:r})=>t.$axios.$get("user/bookmarks",{params:{page:e,take:n,type:r}}),D=({ctx:t,id:e,count:n,seen_ids:r,order_by:o})=>l(t,{type:"answer",bangumiId:e,sort:o,take:n,seenIds:r}),P=({ctx:t,id:e,seen_ids:n,max_id:r,order_by:o})=>t.$axios.$get(`cartoon_role/${e}/fans`,{params:{seenIds:n,minId:r,sort:o}}),L=({ctx:t,id:e,seen_ids:n,max_id:r,order_by:o})=>t.$axios.$get(`cartoon_role/${e}/owners`,{params:{seenIds:n,minId:r,sort:o}}),B=({ctx:t,id:e,seen_ids:n,order_by:r})=>{const o=r.split("-");return t.$axios.$get("cartoon_role/list/idols",{params:{seenIds:n,type:o[0],sort:o[1],state:o[2],id:e}})},F=({ctx:t,seen_ids:e})=>t.$axios.$get("cartoon_role/deal_list",{params:{seenIds:e}}),z=({ctx:t})=>t.$axios.$get("cartoon_role/my_deal"),G=({ctx:t,page:e,count:n,id:r})=>t.$axios.$get("cartoon_role/market_price_draft_list",{params:{page:e,count:n,idol_id:r}}),K=({ctx:t,page:e,count:n,id:r})=>t.$axios.$get("cartoon_role/get_idol_request_list",{params:{page:e,take:n,idol_id:r}}),H=({ctx:t,page:e,count:n})=>t.$axios.$get("cartoon_role/get_my_product_request_list",{params:{page:e,take:n}}),V=({ctx:t,max_id:e,id:n})=>t.$axios.$get("cartoon_role/products",{params:{last_id:e,idol_id:n}});n.d(e,"state",function(){return W}),n.d(e,"actions",function(){return Y}),n.d(e,"mutations",function(){return Q}),n.d(e,"getters",function(){return Z});const J={list:[],page:0,noMore:!1,nothing:!1,loading:!1,error:!1,init:!1,total:0},W=()=>({}),Y={async initData({state:t,commit:e},{id:n="",type:o,func:c,count:l=12,sort:d="",refresh:h=!1,force:m=!1}){const f=`${c}-${n}-${d}`,_=t[f];if(_&&_.error&&!m)return;if(_&&_.loading)return;if(_&&_.init&&!h)return;e("INIT_STATE",f),e("SET_LOADING",f);const v={count:l,ctx:this};"page"===o?v.page=0:"seenIds"===o?v.seen_ids="":"lastId"===o&&(v.max_id=""),n&&(v.id=n),d&&(v.order_by=d);try{e("SET_DATA",{data:await r[c](v),fieldName:f,count:l})}catch(t){e("SET_ERROR",f)}},async loadMore({state:t,commit:e},{type:n,changing:o="id",id:c="",func:l,sort:d="",count:h=12}){const m=`${l}-${c}-${d}`,f=t[m];if(f.loading||f.noMore)return;e("SET_LOADING",m);const _={count:h,ctx:this};if("page"===n)_.page=f.page;else if("lastId"===n){const t=f.list[f.list.length-1];let e;/\./.test(o)?(e=t,o.split(".").forEach(t=>{e=e[t]})):e=t[o],_.max_id=e}else"seenIds"===n&&(_.seen_ids=f.list.map(t=>{if(!/\./.test(o))return t[o];let e=t;return o.split(".").forEach(t=>{e=e[t]}),e}).toString());c&&(_.id=c),d&&(_.order_by=d);try{e("SET_DATA",{data:await r[l](_),fieldName:m,count:h})}catch(t){e("SET_ERROR",m)}}},Q={SET_ERROR(t,e){t[e].error=!0,t[e].loading=!1},INIT_STATE(t,e){c.a.set(t,e,Object.assign({},J))},SET_LOADING(t,e){t[e].loading=!0},SET_DATA(t,{data:data,fieldName:e,count:n}){if(!t[e])return;const r=(data=>!Array.isArray(data))(data);t[e].init?t[e].list=r?t[e].list.concat(data.list):t[e].list.concat(data):(t[e].init=!0,t[e].list=r?data.list:data,t[e].nothing=r?0===data.total:0===data.length),t[e].page++,t[e].noMore=r?data.noMore:"seenIds"===t.type?0===data.length:data.length<n,t[e].total=data.total||0,t[e].loading=!1,t[e].error=!1}},Z={getFlow:t=>(e,n="",r="")=>t[`${e}-${r}-${n}`]}},function(t,e,n){"use strict";n.r(e);var r=n(48),o=n.n(r);n.d(e,"state",function(){return c}),n.d(e,"mutations",function(){return l}),n.d(e,"actions",function(){return d}),n.d(e,"getters",function(){return h});const c=()=>({type:"",sort:"desc",fetchId:0,list:[],total:0,noMore:!1,submitting:!1,id:0}),l={RESET_STATE(t,{type:e}){t.type=e,t.sort="post"===e?"asc":"desc",t.fetchId=0,t.list=[],t.total=0,t.noMore=!1,t.submitting=!1,t.id=0},INIT_FETCH_TYPE(t,{type:e}){t.type=e,"post"===e&&(t.sort="asc")},SET_MAIN_COMMENTS(t,{comments:e,seeReplyId:n,id:r}){if(t.id=+r,!e.list.length)return t.noMore=e.noMore,void(t.total=e.total);const c=e.list.map(t=>{const e=t.comments.list,n=e.length,r=Object.assign(t.comments,{maxId:n?e[n-1].id:0});return Object.assign(t,{comments:r})});t.fetchId=c[c.length-1].id,!t.list.length&&n&&(t.fetchId=c.map(t=>t.id).filter(t=>t!==parseInt(n,10)).pop());const l=c.map(t=>t.id),d=t.list,h=!!l.filter(t=>-1===d.map(t=>t.id).indexOf(t)).length;t.list=t.list.filter(t=>-1===l.indexOf(t.id)),t.list=o()(t.list.concat(c),"id",t.sort),t.noMore=!h||e.noMore,t.total=h?e.total:t.list.length},SET_SUB_COMMENTS(t,{comments:e,id:n}){let r=null,o=0;if(t.list.forEach((t,e)=>{t.id===n&&(r=t,o=e)}),!r)return;t.list[o].comments.maxId=e.list[e.list.length-1].id;const c=e.list.map(t=>t.id),l=r.comments.list,d=!!c.filter(t=>-1===l.map(t=>t.id).indexOf(t)).length;t.list[o].comments.list=l.filter(t=>-1===c.indexOf(t.id)),t.list[o].comments.list=t.list[o].comments.list.concat(e.list),t.list[o].comments.noMore=!d||e.noMore,t.list[o].comments.total=d?e.total:t.list[o].comments.list.length},CREATE_MAIN_COMMENT(t,e){"asc"===t.sort?t.list.push(e):t.list.unshift(e),t.total=t.total+1},CREATE_SUB_COMMENT(t,{id:e,comment:n}){t.list.forEach((r,o)=>{r.id===e&&(t.list[o].comments.list.push(n),t.list[o].comments.total=t.list[o].comments.total+1)})},SET_SUBMITTING(t,{result:e}){t.submitting=e},DELETE_SUB_COMMENT(t,{parentId:e,id:n}){t.list.forEach((r,o)=>{r.id===e&&r.comments.list.forEach((e,r)=>{e.id===n&&(t.list[o].comments.list.splice(r,1),t.list[o].comments.total=t.list[o].comments.total-1)})})},DELETE_MAIN_COMMENT(t,{id:e}){t.list.forEach((n,r)=>{n.id===e&&(t.list.splice(r,1),t.total=t.total-1)})},TOGGLE_LIKE_SUB_COMMENT(t,{id:e,parentId:n}){t.list.forEach((r,o)=>{r.id===n&&r.comments.list.forEach((n,r)=>{if(n.id===e){const e=!t.list[o].comments[r].liked;t.list[o].comments[r].liked=e,t.list[o].comments[r].like_count=t.list[o].comments[r].like_count+(e?1:-1)}})})},TOGGLE_LIKE_MAIN_COMMENT(t,{id:e}){t.list.forEach((n,r)=>{if(n.id===e){const e=!t.list[r].liked;t.list[r].liked=e,t.list[r].like_count=t.list[r].like_count+(e?1:-1)}})}},d={async getMainComments({state:t,commit:e},{type:n,id:r,onlySeeMaster:o,seeReplyId:c,firstRequest:l}){if(t.type)if(t.type===n)if(t.id!==+r)e("RESET_STATE",{type:n});else{if(t.noMore)return;if(t.list.length&&l)return;l&&e("RESET_STATE",{type:n})}else e("RESET_STATE",{type:n});else e("INIT_FETCH_TYPE",{type:n});const d=await((t,{type:e,id:n,fetchId:r,onlySeeMaster:o,seeReplyId:c})=>t.$axios.$get("comment/main/list",{params:{fetchId:r,onlySeeMaster:o,seeReplyId:c,type:e,id:n}}))(this,{type:n,id:r,onlySeeMaster:o,seeReplyId:c,fetchId:t.fetchId});d&&e("SET_MAIN_COMMENTS",{comments:d,seeReplyId:c,id:r})},async getSubComments({state:t,commit:e},{type:n,id:r}){const o=t.list.filter(t=>t.id===r)[0].comments;o.noMore||e("SET_SUB_COMMENTS",{comments:await((t,{type:e,id:n,maxId:r})=>t.$axios.$get("comment/sub/list",{params:{maxId:r,type:e,id:n}}))(this,{type:n,id:r,maxId:o.maxId}),id:r})},async createMainComment({commit:t},{images:e,content:content,type:n,id:r}){const o=await((t,{type:e,id:n,content:content,images:r})=>t.$axios.$post("comment/main/create",{content:content,images:r,type:e,id:n}))(this,{type:n,id:r,content:content,images:e});return t("CREATE_MAIN_COMMENT",o.data),o},async createSubComment({commit:t},{id:e,type:n,content:content,targetUserId:r}){const o=await((t,{type:e,id:n,content:content,targetUserId:r})=>t.$axios.$post("comment/main/reply",{targetUserId:r,content:content,type:e,id:n}))(this,{id:e,type:n,content:content,targetUserId:r});return t("CREATE_SUB_COMMENT",{id:e,comment:o.data}),o},async deleteSubComment({commit:t},{id:e,type:n,parentId:r}){await((t,{type:e,id:n})=>t.$axios.$post("comment/sub/delete",{type:e,id:n}))(this,{id:e,type:n}),t("DELETE_SUB_COMMENT",{parentId:r,id:e})},async deleteMainComment({commit:t},{id:e,type:n}){await((t,{type:e,id:n})=>t.$axios.$post("comment/main/delete",{type:e,id:n}))(this,{id:e,type:n}),t("DELETE_MAIN_COMMENT",{id:e})},async toggleLikeSubComment({commit:t},{type:e,id:n,parentId:r}){t("TOGGLE_LIKE_SUB_COMMENT",{id:n,parentId:r}),await((t,{type:e,id:n})=>t.$axios.$post("comment/sub/toggleLike",{type:e,id:n}))(this,{type:e,id:n})},async toggleLikeMainComment({commit:t},{type:e,id:n}){t("TOGGLE_LIKE_MAIN_COMMENT",{id:n}),await((t,{type:e,id:n})=>t.$axios.$post("comment/main/toggleLike",{type:e,id:n}))(this,{type:e,id:n})}},h={}},function(t,e,n){"use strict";n.r(e);var r=n(3);n.d(e,"state",function(){return o}),n.d(e,"mutations",function(){return c}),n.d(e,"actions",function(){return l}),n.d(e,"getters",function(){return d});const o=()=>({all:[],timeline:{list:[],year:(new Date).getFullYear(),noMore:!1},currentFollowBangumiFetched:!1,currentFollowBangumis:[]}),c={SET_CURRENT_USER_BANGUMI(t,data){t.currentFollowBangumiFetched=!0,t.currentFollowBangumis=data},SET_ALL_BANGUMI(t,data){t.all=data},SET_TIMELINE(t,data){const e=t.timeline;t.timeline.list=e.list.concat(data.list),t.timeline.year=e.year-1,t.timeline.noMore=data.noMore}},l={async getAllBangumi({state:t,commit:e}){let n=!0;try{const t=localStorage.getItem("all-bangumi-load-at");if(t&&Date.now()-t<36e5){const t=JSON.parse(localStorage.getItem("all-bangumi-list"));t&&e("SET_ALL_BANGUMI",t),n=!(t&&t.length)}}catch(t){}if(t.all.length||!n)return;const data=await(t=>t.$axios.$get("search/bangumis"))(this);e("SET_ALL_BANGUMI",data);try{localStorage.setItem("all-bangumi-load-at",Date.now()),localStorage.setItem("all-bangumi-list",JSON.stringify(data))}catch(t){}},async getTimeline({state:t,commit:e}){if(t.timeline.noMore)return;const{data:data}=await((t,{year:e})=>t.$axios.get("bangumi/timeline",{params:{year:e}}))(this,{year:t.timeline.year});data&&e("SET_TIMELINE",data)},async getCurrentUserFollowBangumis({state:t,commit:e,rootState:n}){if(t.currentFollowBangumiFetched||!n.user)return t.currentFollowBangumis;const data=await Object(r.b)(this,{zone:n.user.zone});return e("SET_CURRENT_USER_BANGUMI",data),data}},d={}},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"users",function(){return l}),n.d(r,"like",function(){return d}),n.d(r,"reward",function(){return h}),n.d(r,"follow",function(){return m}),n.d(r,"mark",function(){return mark}),n.d(r,"vote",function(){return f});var o=n(0),c=n.n(o);const l=({ctx:t,type:e,id:n,last_id:r,take:o,model:c})=>t.$axios.$get("toggle/users",{params:{id:n,last_id:r,take:o,model:c,type:e}}),d=({ctx:t,type:e,id:n})=>t.$axios.$post("toggle/like",{type:e,id:n}),h=({ctx:t,type:e,id:n})=>t.$axios.$post("toggle/reward",{type:e,id:n}),m=({ctx:t,type:e,id:n})=>t.$axios.$post("toggle/follow",{type:e,id:n}),mark=({ctx:t,type:e,id:n})=>t.$axios.$post("toggle/mark",{type:e,id:n}),f=({ctx:t,type:e,id:n,is_agree:r})=>t.$axios.$post("toggle/vote",{type:e,id:n,is_agree:r});n.d(e,"state",function(){return _}),n.d(e,"mutations",function(){return v}),n.d(e,"actions",function(){return y}),n.d(e,"getters",function(){return x});const _=()=>({}),v={SET_STATE(t,{type:e,data:data,id:n}){if(Array.isArray(data))data.forEach(n=>{Object.keys(n).forEach(t=>{n[`${t}_loading`]=!1}),c.a.set(t,`${e}-${n.id}`,n)});else{const r=data=>"object"==typeof data;Object.keys(data).forEach(t=>{r(data[t])?data[t]=Object.assign(data[t],{loading:!1,error:!1,nothing:!data[t].total}):data[`${t}_loading`]=!1}),c.a.set(t,`${e}-${n||data.id}`,data)}},PUSH_STATE(t,{type:e,id:n,key:r,data:data}){const o=[`${e}-${n}`],c=`${r}_users`,l=t[o][c].list,d=data.list.map(t=>t.id);t[o][c].list=l.filter(t=>-1===d.indexOf(t.id)).concat(data.list),t[o][c].total=data.total,t[o][c].noMore=data.noMore,t[o][c].loading=!1},TOGGLE_STATE(t,{type:e,id:n,key:r,result:o,user:c}){const l=[`${e}-${n}`],d=`${r}_users`;t[l][r]=o,t[l][`${r}_loading`]=!1,t[l][d]&&(o?(t[l][d].total++,t[l][d].noMore=!1,t[l][d].list.unshift(c)):(t[l][d].total--,t[l][d].list.forEach((e,n)=>{e.id===c.id&&t[l][d].list.splice(n,1)})))},SET_PUSH_RUNNING(t,{type:e,id:n,key:r,value:o}){const c=`${r}_users`;t[[`${e}-${n}`]][c][o]=!0},SET_TOGGLE_LOADING(t,{type:e,id:n,action:r,result:o}){t[`${e}-${n}`][`${r}_loading`]=o}},y={async getUsers({state:t,commit:e},{type:n,id:r,key:o}){const c=t[`${n}-${r}`][`${o}_users`];if(!c.loading&&!c.noMore){e("SET_PUSH_RUNNING",{type:n,key:o,id:r,value:"loading"});try{e("PUSH_STATE",{type:n,id:r,key:o,data:await l({ctx:this,type:o,id:r,last_id:c.list.length?c.list[c.list.length-1].id:0,model:n,take:15})})}catch(t){e("SET_PUSH_RUNNING",{type:n,key:o,id:r,value:"error"})}}},async toggleAction({state:t,commit:e,rootState:n},{type:o,id:c,action:l}){if(!t[`${o}-${c}`][`${l}_loading`]){e("SET_TOGGLE_LOADING",{action:l,type:o,id:c,result:!0});try{const t=await r[l]({ctx:this,id:c,type:o}),{user:d}=n;return e("TOGGLE_STATE",{type:o,key:l,id:c,result:t,user:{id:d.id,nickname:d.nickname,avatar:d.avatar,created_at:parseInt(Date.now()/1e3)}}),{success:!0,result:t}}catch(t){return e("SET_TOGGLE_LOADING",{action:l,type:o,id:c,result:!1}),{success:!1}}}}},x={getState:t=>(e,n)=>t[`${e}-${n}`]}}]);
//# sourceMappingURL=server.js.map