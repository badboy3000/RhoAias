(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{500:function(t,e,s){t.exports={"bangumi-panel":"bangumi-panel-b5",bangumiPanel:"bangumi-panel-b5",avatar:"avatar-2K",content:"content-2m",name:"name-5O",controls:"controls-1p",rolling:"rolling-nc"}},506:function(t,e,s){},525:function(t,e,s){"use strict";var n=s(500),i=s.n(n);e.default=i.a},526:function(t,e,s){"use strict";s(45);var n={name:"BangumiPanel",components:{FollowButton:s(531).a},props:{id:{required:!0,type:Number},avatar:{required:!0,type:String},name:{required:!0,type:String}}},i=s(525),a=s(1);var r=Object(a.a)(n,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.$style.bangumiPanel},[s("nuxt-link",{class:t.$style.avatar,attrs:{to:t.$alias.bangumi(t.id)}},[s("v-img",{attrs:{src:t.avatar,width:"80",height:"92"}})],1),t._v(" "),s("div",{class:t.$style.content},[s("nuxt-link",{attrs:{to:t.$alias.bangumi(t.id)}},[s("h5",{staticClass:"oneline",class:t.$style.name,domProps:{textContent:t._s(t.name)}})]),t._v(" "),s("div",{class:t.$style.summary},[t._t("default")],2),t._v(" "),s("div",{class:t.$style.controls},[s("follow-button",{attrs:{id:t.id,type:"bangumi"}})],1)],1)],1)},[],!1,function(t){this.$style=i.default.locals||i.default},null,null);r.options.__file="BangumiPanel.vue";e.a=r.exports},540:function(t,e,s){"use strict";var n=s(506);s.n(n).a},541:function(t,e,s){t.exports={"image-preview":"image-preview-2_",imagePreview:"image-preview-2_",container:"container-34",bar:"bar-1j","top-bar":"top-bar-1d",topBar:"top-bar-1d","foot-bar":"foot-bar-AF",footBar:"foot-bar-AF",wrap:"wrap-tx",item:"item-32",close:"close-27",download:"download-51","next-btn":"next-btn-3T",nextBtn:"next-btn-3T","prev-btn":"prev-btn-12",prevBtn:"prev-btn-12",rolling:"rolling-3m"}},547:function(t,e,s){"use strict";s(12);var n=s(2),i=s.n(n),a=(s(45),{name:"SocialPanel",props:{isCreator:{required:!0,type:Boolean},isMine:{required:!0,type:Boolean},id:{required:!0,type:Number},type:{required:!0,type:String,validator:function(t){return~["post","video","image","score","answer","video"].indexOf(t)}}},computed:{isGuest:function(){return!this.$store.state.login},source:function(){return this.$store.getters["social/getState"](this.type,this.id)},displayUsers:function(){return(this.isCreator?this.source.reward_users.list:this.source.like_users.list).slice(0,this.displayCount)}},methods:{computeTextByAction:function(t){return"reward"===t?"投食":"like"===t?"喜欢":"mark"===t?"收藏":"操作"},toggleAction:function(t){var e=this;if(this.isGuest)this.$channel.$emit("sign-in");else if(this.isMine)this.$toast.info("不能".concat(this.computeTextByAction(t),"自己的内容"));else if("reward"===t){if(this.source.reward)return void this.$toast.info("已投食过");this.$confirm("向TA投食需要消耗你一个团子，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.submitAction("reward")}).catch(function(){})}else this.submitAction(t)},submitAction:function(){var t=i()(regeneratorRuntime.mark(function t(e){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("social/toggleAction",{type:this.type,id:this.id,action:e});case 2:(s=t.sent).success&&this.$emit("".concat(e,"-callback"),{result:s.result});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}}),r=(s(540),s(1)),o=Object(r.a)(a,function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.source?s("div",{staticClass:"social-panel"},[s("div",{staticClass:"buttons"},[t.isCreator?s("el-button",{class:{"is-plain":t.source.reward},attrs:{loading:t.source.reward_loading,type:"warning",icon:"iconfont icon-fantuan",round:"",size:"mini"},on:{click:function(e){t.toggleAction("reward")}}},[t._v("\n      "+t._s(t.source.reward?"已投食":"投食")+t._s(t.source.reward_users.total?"  |  "+t.source.reward_users.total:"")+"\n    ")]):t._e(),t._v(" "),s("el-button",{class:{"is-plain":t.source.like},attrs:{loading:t.source.like_loading,type:"danger",icon:"iconfont icon-like",round:"",size:"mini"},on:{click:function(e){t.toggleAction("like")}}},[t._v("\n      "+t._s(t.source.like?"已喜欢":"喜欢")+t._s(t.source.like_users.total?"  |  "+t.source.like_users.total:"")+"\n    ")]),t._v(" "),s("el-button",{class:{"is-plain":t.source.mark},attrs:{loading:t.source.mark_loading,type:"success",icon:"iconfont icon--mark",round:"",size:"mini"},on:{click:function(e){t.toggleAction("mark")}}},[t._v("\n      "+t._s(t.source.mark?"已收藏":"收藏")+t._s(t.source.mark_users.total?"  |  "+t.source.mark_users.total:"")+"\n    ")])],1),t._v(" "),s("div",{staticClass:"users"},[s("ul",t._l(t.displayUsers,function(e){return s("li",{key:e.id,staticClass:"user-face"},[s("img",{attrs:{src:t.$resize(e.avatar,{width:60})}})])}),0)])]):t._e()},[],!1,null,null,null);o.options.__file="SocialPanel.vue";e.a=o.exports},588:function(t,e,s){"use strict";s(10),s(24),s(25);var n={name:"ImagePreview",props:{images:{type:Array,default:function(){return[]}},query:{type:String,default:""},download:{type:Boolean,default:!0}},data:function(){return{show:!1,currentIndex:-1,maxWidth:0,maxHeight:0,displayImages:this.images.map(function(t){return Object.assign({finalWidth:0,finalHeight:0,loading:!0},t)})}},computed:{total:function(){return this.images.length},currentImage:function(){return-1===this.currentIndex?null:this.displayImages[this.currentIndex]}},mounted:function(){this.getScreenSize(),window.addEventListener("resize",this.getScreenSize)},methods:{handleClose:function(){this.show=!1},handleClick:function(t){if(this.total){var e=t.target,s="img"===e.tagName.toLowerCase();if((this.query||s)&&(!this.query||-1!==e.className.indexOf(this.query))){var n="";if(s)n=e.getAttribute("src").split("?")[0];else{var i=e.querySelector("img");if(!i)return;n=i.getAttribute("src").split("?")[0]}this.getClickImageIndex(n),this.computeDisplaySize(this.currentIndex),this.show=!0}}},getClickImageIndex:function(t){var e=this;this.images.forEach(function(s,n){s.url===t&&(e.currentIndex=n)})},getScreenSize:function(){this.maxWidth=window.innerWidth,this.maxHeight=window.innerHeight-88},switchImage:function(t){if((!t||this.currentIndex!==this.total-1)&&(t||0!==this.currentIndex)){var e=t?this.currentIndex+1:this.currentIndex-1;this.computeDisplaySize(e),this.currentIndex=e}},getSiblingsIndex:function(t){var e,s;return 0===this.currentIndex?(e=this.total-1,s=1):this.currentIndex===this.total-1?(e=this.total-2,s=0):(e=this.currentIndex-1,s=this.currentIndex+1),[e,t,s]},computeDisplaySize:function(t){if(void 0!==this.images[t]){var e=this.images[t];if(!e.finalWidth||!e.finalHeight){var s,n,i=e.width,a=e.height,r=this.maxWidth,o=this.maxHeight;if(r>=i&&o>=a)s=i,n=a;else if(r<i&&o<a){var c=i/o,l=a/o;c>=l?(s=r,n=parseInt(a/c,10)):(s=parseInt(i/l,10),n=o)}else if(a<o){s=r,n=parseInt(a/(i/o),10)}else{s=parseInt(i/(a/o),10),n=o}this.displayImages[t].finalWidth=s||r,this.displayImages[t].finalHeight=n||o}}},handleSwitch:function(t,e){this.currentIndex=e}}},i=s(634),a=s(1);var r=Object(a.a)(n,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.$style.imagePreview,on:{click:t.handleClick}},[t.show?s("div",{class:t.$style.container,on:{click:t.handleClose}},[s("div",{class:[t.$style.bar,t.$style.topBar]},[t.total?s("span",{class:t.$style.total},[t._v("\n        "+t._s(t.currentIndex+1)+"/"+t._s(t.total)+"\n      ")]):t._e(),t._v(" "),s("span",{class:t.$style.close},[t._v(" × ")])]),t._v(" "),s("div",{class:[t.$style.bar,t.$style.footBar]},[t.currentImage&&t.download?s("a",{class:t.$style.download,attrs:{href:t.currentImage.url,target:"_blank"},on:{click:function(t){t.stopPropagation()}}},[t._v("\n        下载原图\n      ")]):t._e()]),t._v(" "),t.currentImage?s("div",{class:t.$style.wrap},[s("div",{class:t.$style.item,style:{backgroundImage:"url("+t.$resize(t.currentImage.url,{webP:!t.download})+")",width:t.currentImage.finalWidth+"px",height:t.currentImage.finalHeight+"px"}}),t._v(" "),t.total>1?[s("button",{class:t.$style.prevBtn,on:{click:function(e){e.stopPropagation(),t.switchImage(!1)}}},[s("i",{staticClass:"el-icon-caret-left"})]),t._v(" "),s("button",{class:t.$style.nextBtn,on:{click:function(e){e.stopPropagation(),t.switchImage(!0)}}},[s("i",{staticClass:"el-icon-caret-right"})])]:t._e()],2):t._e()]):t._e(),t._v(" "),t._t("default")],2)},[],!1,function(t){this.$style=i.default.locals||i.default},null,null);r.options.__file="ImagePreview.vue";e.a=r.exports},634:function(t,e,s){"use strict";var n=s(541),i=s.n(n);e.default=i.a},635:function(t,e,s){},803:function(t,e,s){"use strict";var n=s(635);s.n(n).a},955:function(t,e,s){"use strict";s.r(e);s(10),s(13),s(12);var n=s(2),i=s.n(n),a=s(83),r=s(543),o=s(547),c=s(588),l=s(526),u=s(523),d={name:"ImageAlbum",asyncData:function(){var t=i()(regeneratorRuntime.mark(function t(e){var s,n,i,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.app,n=e.store,i=e.params,r=e.error,o=i.id,t.abrupt("return",Object(a.b)(s,{id:o}).then(function(t){var e=t.bangumi;return n.commit("social/SET_STATE",{type:"image",id:o,data:{like:t.liked,reward:t.rewarded,mark:t.marked,like_users:t.like_users,mark_users:t.mark_users,reward_users:t.reward_users}}),n.commit("social/SET_STATE",{type:"bangumi",id:e.id,data:{follow:e.followed}}),{info:t,bangumi:e,user:t.user,source:t.source,images:t.images}}).catch(r));case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),head:function(){return{title:this.info.name}},components:{CommentMain:r.a,SocialPanel:o.a,ImagePreview:c.a,BangumiPanel:l.a,VPopover:u.a},data:function(){return{take:4,page:0,part:0,showAll:!1}},computed:{id:function(){return+this.$route.params.id},cartoon:function(){return this.info.parts},isMine:function(){return!!this.$store.state.login&&this.user.id===this.$store.state.user.id},showMoreBtn:function(){return this.take<this.cartoon.length},sortCartoons:function(){var t=(this.page-1)*this.take;return this.showAll?this.cartoon:this.cartoon.slice(t,t+this.take)},nextPartUrl:function(){var t=this;if(!this.info.is_cartoon||!this.cartoon.length)return"";var e=0;return this.cartoon.forEach(function(s,n){s.id===t.id&&(e=n)}),e>=this.cartoon.length-1?"":this.$alias.image(this.cartoon[e+1].id)}},mounted:function(){this.computePage()},methods:{computePage:function(){var t=this;this.info.is_cartoon&&(this.cartoon.forEach(function(e,s){e.id===t.id&&(t.part=s+1)}),this.page=Math.ceil(this.part/this.take))}}},m=(s(803),s(1)),p=Object(m.a)(d,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"image-album"}},[s("div",{staticClass:"container"},[s("div",{staticClass:"album-header"},[s("h1",{staticClass:"title oneline"},[t._v("\n        ["+t._s(t.info.is_creator?"原创":"转载")+"]\n        ["+t._s(t.info.is_cartoon?"漫画":"相册")+"]\n        "+t._s(t.info.name)+"\n      ")]),t._v(" "),s("div",{staticClass:"user"},[s("a",{staticClass:"author",attrs:{href:t.$alias.user(t.user.zone)}},[s("v-img",{staticClass:"avatar",attrs:{src:t.user.avatar,avatar:!0,width:"30",height:"30"}}),t._v("\n          "+t._s(t.user.nickname)+"\n        ")],1),t._v(" "),s("span",{staticClass:"dot"},[t._v(" · ")]),t._v(" "),s("v-time",{model:{value:t.info.created_at,callback:function(e){t.$set(t.info,"created_at",e)},expression:"info.created_at"}}),t._v(" "),s("div",{staticClass:"flex1"}),t._v(" "),s("v-popover",{attrs:{"report-id":t.info.id,"is-creator":t.info.is_creator,"report-type":"image"}},[s("button",{staticClass:"tool-btn"},[t._v("···")])])],1)])]),t._v(" "),s("div",{staticClass:"album-body"},[t.info.is_album?s("image-preview",{staticClass:"images-wrap",attrs:{images:t.images}},[t._l(t.images,function(t){return s("div",{key:t.id,staticClass:"image-package"},[s("v-img",{staticClass:"image",attrs:{src:t.url,full:!0,width:t.width,height:t.height}})],1)}),t._v(" "),t.info.image_count?t._e():s("p",{staticClass:"no-image"},[t._v("\n        还没有上传图片\n      ")])],2):s("image-preview",{attrs:{images:[t.source]}},[s("div",{staticClass:"image-package"},[s("v-img",{staticClass:"image",attrs:{src:t.source.url,width:t.source.width,height:t.source.height,full:!0}})],1)]),t._v(" "),t.info.is_cartoon?s("div",{staticClass:"cartoon-list"},[s("h3",{staticClass:"sub-title"},[t._v("\n        选集（"+t._s(t.cartoon.length)+"）\n        "),t.nextPartUrl?s("a",{staticClass:"next",attrs:{href:t.nextPartUrl}},[t._v("下一话")]):t._e(),t._v(" "),t.showMoreBtn?s("div",{staticClass:"more",on:{click:function(e){t.showAll=!t.showAll}}},[t._v(t._s(t.showAll?"收起":"展开"))]):t._e()]),t._v(" "),s("ul",t._l(t.sortCartoons,function(e){return s("li",{key:e.id},[s("a",{staticClass:"oneline",class:{active:e.id===t.id},attrs:{href:t.$alias.image(e.id)},domProps:{textContent:t._s(e.name)}})])}),0)]):t._e(),t._v(" "),s("div",{staticClass:"container"},[s("social-panel",{attrs:{id:t.info.id,"is-creator":t.info.is_creator,"is-mine":t.isMine,type:"image"}})],1)],1),t._v(" "),s("div",{staticClass:"container"},[s("v-lazy",[s("comment-main",{attrs:{id:t.id,"master-id":t.user.id,type:"image"}})],1),t._v(" "),s("div",{staticClass:"hr"}),t._v(" "),s("div",{staticClass:"album-footer"},[s("div",{staticClass:"bangumi-panel"},[s("h3",{staticClass:"sub-title"},[t._v("所属番剧：")]),t._v(" "),s("bangumi-panel",{attrs:{id:t.bangumi.id,name:t.bangumi.name,avatar:t.bangumi.avatar}},[s("p",{staticClass:"summary",domProps:{textContent:t._s(t.bangumi.summary)}})])],1)])],1)])},[],!1,null,null,null);p.options.__file="_id.vue";e.default=p.exports}}]);
//# sourceMappingURL=_id.chunk.2e0ddb90.js.map