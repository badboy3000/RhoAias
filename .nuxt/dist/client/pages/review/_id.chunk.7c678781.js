(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{500:function(t,e,n){t.exports={"bangumi-panel":"bangumi-panel-b5",bangumiPanel:"bangumi-panel-b5",avatar:"avatar-2K",content:"content-2m",name:"name-5O",controls:"controls-1p",rolling:"rolling-nc"}},506:function(t,e,n){},517:function(t,e,n){},518:function(t,e,n){},519:function(t,e,n){},520:function(t,e,n){},521:function(t,e,n){},525:function(t,e,n){"use strict";var s=n(500),i=n.n(s);e.default=i.a},526:function(t,e,n){"use strict";n(45);var s={name:"BangumiPanel",components:{FollowButton:n(531).a},props:{id:{required:!0,type:Number},avatar:{required:!0,type:String},name:{required:!0,type:String}}},i=n(525),r=n(1);var a=Object(r.a)(s,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.bangumiPanel},[n("nuxt-link",{class:t.$style.avatar,attrs:{to:t.$alias.bangumi(t.id)}},[n("v-img",{attrs:{src:t.avatar,width:"80",height:"92"}})],1),t._v(" "),n("div",{class:t.$style.content},[n("nuxt-link",{attrs:{to:t.$alias.bangumi(t.id)}},[n("h5",{staticClass:"oneline",class:t.$style.name,domProps:{textContent:t._s(t.name)}})]),t._v(" "),n("div",{class:t.$style.summary},[t._t("default")],2),t._v(" "),n("div",{class:t.$style.controls},[n("follow-button",{attrs:{id:t.id,type:"bangumi"}})],1)],1)],1)},[],!1,function(t){this.$style=i.default.locals||i.default},null,null);a.options.__file="BangumiPanel.vue";e.a=a.exports},540:function(t,e,n){"use strict";var s=n(506);n.n(s).a},547:function(t,e,n){"use strict";n(12);var s=n(2),i=n.n(s),r=(n(45),{name:"SocialPanel",props:{isCreator:{required:!0,type:Boolean},isMine:{required:!0,type:Boolean},id:{required:!0,type:Number},type:{required:!0,type:String,validator:function(t){return~["post","video","image","score","answer","video"].indexOf(t)}}},computed:{isGuest:function(){return!this.$store.state.login},source:function(){return this.$store.getters["social/getState"](this.type,this.id)},displayUsers:function(){return(this.isCreator?this.source.reward_users.list:this.source.like_users.list).slice(0,this.displayCount)}},methods:{computeTextByAction:function(t){return"reward"===t?"投食":"like"===t?"喜欢":"mark"===t?"收藏":"操作"},toggleAction:function(t){var e=this;if(this.isGuest)this.$channel.$emit("sign-in");else if(this.isMine)this.$toast.info("不能".concat(this.computeTextByAction(t),"自己的内容"));else if("reward"===t){if(this.source.reward)return void this.$toast.info("已投食过");this.$confirm("向TA投食需要消耗你一个团子，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.submitAction("reward")}).catch(function(){})}else this.submitAction(t)},submitAction:function(){var t=i()(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("social/toggleAction",{type:this.type,id:this.id,action:e});case 2:(n=t.sent).success&&this.$emit("".concat(e,"-callback"),{result:n.result});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}}),a=(n(540),n(1)),o=Object(a.a)(r,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.source?n("div",{staticClass:"social-panel"},[n("div",{staticClass:"buttons"},[t.isCreator?n("el-button",{class:{"is-plain":t.source.reward},attrs:{loading:t.source.reward_loading,type:"warning",icon:"iconfont icon-fantuan",round:"",size:"mini"},on:{click:function(e){t.toggleAction("reward")}}},[t._v("\n      "+t._s(t.source.reward?"已投食":"投食")+t._s(t.source.reward_users.total?"  |  "+t.source.reward_users.total:"")+"\n    ")]):t._e(),t._v(" "),n("el-button",{class:{"is-plain":t.source.like},attrs:{loading:t.source.like_loading,type:"danger",icon:"iconfont icon-like",round:"",size:"mini"},on:{click:function(e){t.toggleAction("like")}}},[t._v("\n      "+t._s(t.source.like?"已喜欢":"喜欢")+t._s(t.source.like_users.total?"  |  "+t.source.like_users.total:"")+"\n    ")]),t._v(" "),n("el-button",{class:{"is-plain":t.source.mark},attrs:{loading:t.source.mark_loading,type:"success",icon:"iconfont icon--mark",round:"",size:"mini"},on:{click:function(e){t.toggleAction("mark")}}},[t._v("\n      "+t._s(t.source.mark?"已收藏":"收藏")+t._s(t.source.mark_users.total?"  |  "+t.source.mark_users.total:"")+"\n    ")])],1),t._v(" "),n("div",{staticClass:"users"},[n("ul",t._l(t.displayUsers,function(e){return n("li",{key:e.id,staticClass:"user-face"},[n("img",{attrs:{src:t.$resize(e.avatar,{width:60})}})])}),0)])]):t._e()},[],!1,null,null,null);o.options.__file="SocialPanel.vue";e.a=o.exports},559:function(t,e,n){"use strict";var s=n(517);n.n(s).a},560:function(t,e,n){"use strict";var s=n(518);n.n(s).a},561:function(t,e,n){"use strict";var s=n(519);n.n(s).a},562:function(t,e,n){"use strict";var s=n(520);n.n(s).a},563:function(t,e,n){"use strict";var s=n(521);n.n(s).a},570:function(t,e,n){"use strict";var s={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}},i=(n(559),n(1)),r=Object(i.a)(s,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"json-content-txt-parser"},[e("p",{domProps:{innerHTML:this._s(this.item.text)}})])},[],!1,null,null,null);r.options.__file="TxtParser.vue";var a=r.exports,o={name:"JsonContentImgParser",props:{item:{type:Object,required:!0}}},c=(n(560),Object(i.a)(o,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"json-content-img-parser"},[n("v-img",{attrs:{src:t.item.url,width:t.item.width,height:t.item.height,full:!0}}),t._v(" "),t.item.text?n("p",{staticClass:"img-tip",domProps:{textContent:t._s(t.item.text)}}):t._e()],1)},[],!1,null,null,null));c.options.__file="ImgParser.vue";var l=c.exports,u={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}},d=(n(561),Object(i.a)(u,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"json-content-txt-parser"},[e("blockquote",{domProps:{innerHTML:this._s(this.item.text)}})])},[],!1,null,null,null));d.options.__file="UseParser.vue";var m=d.exports,p=(n(24),n(29),{name:"JsonContentListParser",props:{item:{type:Object,required:!0}},computed:{list:function(){var t=this.item.text;if(!t)return[];for(;/\n\n/.test(t);)t=t.replace(/\n\n/g,"\n");return t.split("\n")}}}),f=(n(562),Object(i.a)(p,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"json-content-list-parser"},["1"===t.item.sort?n("ol",t._l(t.list,function(e,s){return n("li",{key:s,domProps:{textContent:t._s(e)}})}),0):n("ul",t._l(t.list,function(e,s){return n("li",{key:s,domProps:{textContent:t._s(e)}})}),0)])},[],!1,null,null,null));f.options.__file="ListParser.vue";var v=f.exports,_={name:"JsonContentTxtParser",props:{item:{type:Object,required:!0}}},h=(n(563),Object(i.a)(_,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"json-content-txt-parser"},[this.item.text?e("h3",{domProps:{textContent:this._s(this.item.text)}}):this._e()])},[],!1,null,null,null));h.options.__file="TitleParser.vue";var g={name:"JsonContent",components:{TxtParser:a,ImgParser:l,UseParser:m,ListParser:v,TitleParser:h.exports},props:{content:{required:!0,type:Array}}},b=Object(i.a)(g,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"json-content"},this._l(this.content,function(t,n){return e(t.type+"-parser",{key:n,tag:"component",attrs:{item:t}})}),1)},[],!1,null,null,null);b.options.__file="JsonContent.vue";e.a=b.exports},641:function(t,e,n){},809:function(t,e,n){"use strict";var s=n(641);n.n(s).a},938:function(t,e,n){"use strict";n.r(e);n(12);var s=n(2),i=n.n(s),r=(n(260),n(3),n(167)),a=n.n(r),o=(n(13),n(10),n(46),n(543)),c=n(570),l=n(547),u=n(526),d=n(523),m=Object.keys({lol:"笑点",cry:"泪点",fight:"燃点",moe:"萌点",sound:"音乐",vision:"画面",story:"情节",role:"人设",express:"内涵",style:"美感"}),p={name:"ScoreShow",asyncData:function(t){var e=t.app,n=t.store,s=t.params,i=t.query,r=t.error,a=s.id,o=i.hash,c=i.time;return function(t,e){var n=e.id,s=e.hash,i=e.time;return t.$axios.$get("score/".concat(n,"/show"),{params:{hash:s,time:i}})}(e,{id:a,hash:o,time:c}).then(function(t){var e={},s=t.bangumi;return Object.keys(t).forEach(function(n){var s=t[n];e[n]=-1!==m.indexOf(n)?+s:s}),n.commit("social/SET_STATE",{type:"score",id:a,data:{like:t.liked,reward:t.rewarded,mark:t.marked,like_users:t.like_users,mark_users:t.mark_users,reward_users:t.reward_users}}),n.commit("social/SET_STATE",{type:"bangumi",id:s.id,data:{follow:s.followed}}),{user:t.user,bangumi:s,info:e}}).catch(r)},head:function(){return{title:this.info.title,meta:[{hid:"description",name:"description",content:"写给《".concat(this.bangumi.name,"》的漫评")}]}},components:{CommentMain:o.a,JsonContent:c.a,SocialPanel:l.a,BangumiPanel:u.a,VPopover:d.a,"el-rate":a.a},data:function(){var t={lol:"笑点",cry:"泪点",fight:"燃点",moe:"萌点",sound:"音乐",vision:"画面",story:"情节",role:"人设",express:"内涵",style:"美感"};return{labelMap:t,columns:Object.keys(t),loadingToggleLike:!1}},computed:{currentUserId:function(){return this.$store.state.login?this.$store.state.user.id:0},isMine:function(){return this.currentUserId===this.user.id}},methods:{deleteScore:function(){var t=this;this.$confirm("删除后无法找回, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n={id:t.info.id},s=void 0,s=(void 0).id,n.$axios.$post("score/delete",{id:s});case 3:t.$toast.success("操作成功"),setTimeout(function(){window.location.reload()},1e3),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}var n,s},e,this,[[0,7]])}))).catch(function(){})}}},f=(n(809),n(1)),v=Object(f.a)(p,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"score-show"}},[t.info.banner?n("v-img",{attrs:{src:t.info.banner.url,width:t.info.banner.width,height:t.info.banner.height,full:!0,lazy:!1}}):t._e(),t._v(" "),n("div",{staticClass:"score-header container"},[n("h1",{staticClass:"title",domProps:{textContent:t._s(t.info.title)}}),t._v(" "),n("div",{staticClass:"author-info"},[n("div",{staticClass:"total"},[t._v(t._s(t.info.total)+"分")]),t._v(" "),n("div",{staticClass:"author"},[n("a",{attrs:{href:t.$alias.user(t.user.zone),target:"_blank"}},[n("div",{staticClass:"avatar"},[n("v-img",{attrs:{src:t.user.avatar,avatar:!0,width:25}})],1),t._v(" "),n("span",{staticClass:"name",domProps:{textContent:t._s(t.user.nickname)}})]),t._v("\n        ·\n        "),n("v-time",{model:{value:t.info.published_at,callback:function(e){t.$set(t.info,"published_at",e)},expression:"info.published_at"}}),t._v("\n        ·\n        "),n("v-popover",{attrs:{"report-id":t.info.id,"is-creator":t.info.is_creator,"report-type":"score"}},[n("button",{staticClass:"tool-btn"},[t._v("举报")])])],1)]),t._v(" "),n("div",{staticClass:"star-row"},t._l(t.columns,function(e,s){return n("div",{key:s,staticClass:"star-item"},[n("div",{staticClass:"label",domProps:{textContent:t._s(t.labelMap[e]+"："+2*t.info[e]+"分")}}),t._v(" "),n("el-rate",{attrs:{disabled:"","allow-half":""},model:{value:t.info[e],callback:function(n){t.$set(t.info,e,n)},expression:"info[item]"}})],1)}),0)]),t._v(" "),n("div",{staticClass:"score-body"},[n("json-content",{attrs:{content:t.info.content}})],1),t._v(" "),n("div",{staticClass:"score-footer"},[n("social-panel",{attrs:{id:t.info.id,"is-creator":t.info.is_creator,"is-mine":t.isMine,type:"score"}})],1),t._v(" "),t.isMine?n("div",{staticClass:"control container"},[n("button",{on:{click:t.deleteScore}},[t._v("删除")]),t._v(" "),n("a",{attrs:{href:t.$alias.editScore(t.info.id)}},[n("button",[t._v("编辑")])])]):t._e(),t._v(" "),n("div",{staticClass:"container"},[n("v-lazy",[n("comment-main",{attrs:{id:t.info.id,"master-id":t.user.id,type:"score"}})],1)],1),t._v(" "),n("div",{staticClass:"hr"}),t._v(" "),n("div",{staticClass:"container bangumi-panel"},[n("h3",{staticClass:"sub-title"},[t._v("所属番剧：")]),t._v(" "),n("bangumi-panel",{attrs:{id:t.bangumi.id,avatar:t.bangumi.avatar,name:t.bangumi.name}},[n("p",{staticClass:"summary",domProps:{textContent:t._s(t.bangumi.summary)}})])],1)],1)},[],!1,null,null,null);v.options.__file="_id.vue";e.default=v.exports}}]);
//# sourceMappingURL=_id.chunk.7c678781.js.map